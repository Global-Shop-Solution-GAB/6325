Program.Sub.ScreenSU.Start
Gui.frmMain..Create(BaseForm)
Gui.frmMain..Caption("System Change Audit")
Gui.frmMain..Size(896,716)
Gui.frmMain..MinX(0)
Gui.frmMain..MinY(0)
Gui.frmMain..Position(0,0)
Gui.frmMain..BackColor(-2147483633)
Gui.frmMain..MousePointer(0)
Gui.frmMain..Event(UnLoad,frmMain_UnLoad)
Gui.frmMain..AlwaysOnTop(False)
Gui.frmMain..FontName("Tahoma")
Gui.frmMain..FontSize(8.25)
Gui.frmMain..ControlBox(True)
Gui.frmMain..MaxButton(True)
Gui.frmMain..MinButton(True)
Gui.frmMain..Moveable(True)
Gui.frmMain..Sizeable(True)
Gui.frmMain..ShowInTaskBar(True)
Gui.frmMain..TitleBar(True)
Gui.frmMain.GsGcAudit.Create(GsGridControl)
Gui.frmMain.GsGcAudit.Size(877,585)
Gui.frmMain.GsGcAudit.Position(6,53)
Gui.frmMain.GsGcAudit.Anchor(15)
Gui.frmMain.GsGcAudit.Enabled(True)
Gui.frmMain.GsGcAudit.Visible(True)
Gui.frmMain.GsGcAudit.Zorder(0)
Gui.frmMain.dtpStart.Create(DatePicker)
Gui.frmMain.dtpStart.Size(129,19)
Gui.frmMain.dtpStart.Position(6,24)
Gui.frmMain.dtpStart.Enabled(True)
Gui.frmMain.dtpStart.Visible(True)
Gui.frmMain.dtpStart.Zorder(0)
Gui.frmMain.dtpStart.CheckBox(False)
Gui.frmMain.dtpStart.FontName("Tahoma")
Gui.frmMain.dtpStart.FontSize(8.25)
Gui.frmMain.dtpEnd.Create(DatePicker)
Gui.frmMain.dtpEnd.Size(129,19)
Gui.frmMain.dtpEnd.Position(142,24)
Gui.frmMain.dtpEnd.Enabled(True)
Gui.frmMain.dtpEnd.Visible(True)
Gui.frmMain.dtpEnd.Zorder(0)
Gui.frmMain.dtpEnd.CheckBox(False)
Gui.frmMain.dtpEnd.FontName("Tahoma")
Gui.frmMain.dtpEnd.FontSize(8.25)
Gui.frmMain.lblStart.Create(Label,"Start Date",True,129,17,0,6,10,True,0,"Arial",8,-2147483633,0,0)
Gui.frmMain.lblStart.BorderStyle(0)
Gui.frmMain.lblEnd.Create(Label,"End Date",True,129,17,0,141,10,True,0,"Arial",8,-2147483633,0,0)
Gui.frmMain.lblEnd.BorderStyle(0)
Gui.frmMain.cmdRef.Create(Button)
Gui.frmMain.cmdRef.Size(64,25)
Gui.frmMain.cmdRef.Position(278,22)
Gui.frmMain.cmdRef.Caption("REFRESH")
Gui.frmMain.cmdRef.Event(Click,cmdRef_Click)
Gui.frmMain.cmdRef.Enabled(True)
Gui.frmMain.cmdRef.Visible(True)
Gui.frmMain.cmdRef.Zorder(0)
Gui.frmMain.cmdRef.FontName("Tahoma")
Gui.frmMain.cmdRef.FontSize(8.25)
Gui.frmMain.cmdRef.FontStyle(True,False,False,False,False)
Gui.frmMain.cmdCrystal.Create(Button)
Gui.frmMain.cmdCrystal.Size(154,25)
Gui.frmMain.cmdCrystal.Position(729,22)
Gui.frmMain.cmdCrystal.Anchor(9)
Gui.frmMain.cmdCrystal.Caption("Export to Crystal Report")
Gui.frmMain.cmdCrystal.Event(Click,cmdCrystal_Click)
Gui.frmMain.cmdCrystal.Enabled(True)
Gui.frmMain.cmdCrystal.Visible(True)
Gui.frmMain.cmdCrystal.Zorder(0)
Gui.frmMain.cmdCrystal.FontName("Tahoma")
Gui.frmMain.cmdCrystal.FontSize(8.25)
Gui.frmMain.cmdCrystal.FontStyle(True,False,False,False,False)
Gui.frmMain.cmdPurge.Create(Button)
Gui.frmMain.cmdPurge.Enabled(True)
Gui.frmMain.cmdPurge.Visible(True)
Gui.frmMain.cmdPurge.Zorder(0)
Gui.frmMain.cmdPurge.Size(129,23)
Gui.frmMain.cmdPurge.Position(669,656)
Gui.frmMain.cmdPurge.Caption("Purge Data Prior To:")
Gui.frmMain.cmdPurge.FontName("Tahoma")
Gui.frmMain.cmdPurge.FontSize(8.25)
Gui.frmMain.cmdPurge.FontStyle(True,False,False,False,False)
Gui.frmMain.cmdPurge.Event(Click,cmdPurge_Click)
Gui.frmMain.dtpPurge.Create(DatePicker)
Gui.frmMain.dtpPurge.Enabled(True)
Gui.frmMain.dtpPurge.Visible(True)
Gui.frmMain.dtpPurge.Zorder(0)
Gui.frmMain.dtpPurge.Size(81,20)
Gui.frmMain.dtpPurge.Position(802,658)
Gui.frmMain.dtpPurge.CheckBox(False)
Gui.frmMain.dtpPurge.FontName("Tahoma")
Gui.frmMain.dtpPurge.FontSize(8.25)
Program.Sub.ScreenSU.End

Program.Sub.Preflight.Start
V.Global.sPath.Declare
V.Global.sMinorPath.Declare
Program.Sub.Preflight.End

Program.Sub.About.Start
'TJS, Apr 2021
'Customer: CDI Energy Products
'Quote # 12639
'Business Case: Customer requires a program to audit changes made to the following screens in Global Shop:

'Proposed Solution: We will create a before and after changes log using a combination of passed variables and direct table reads.

'Screens audited with hooks used:                                                                                                               Identifier passed variable:
'----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
'Customer Master Main (ARS002A1)     | Pre Save  |       | Post Save | 14385 | Cust Select | 14387 | Post Delete | 14386 |             |       | V.Passed.000002                                                |
'------------------------------------+-----------+-------+-----------+-------+-------------+-------+-------------+-------+-------------+-------------------------------------------------------------------------
'AR Cust Ship To Update (ARS002S)    | Populate  | 14410 | Post Save | 14443 | Exit        | 14445 |             |       |             |       | V.Passed.Global                                                |
'------------------------------------+-----------+-------+-----------+-------+-------------+-------+-------------+-------+-------------+-------------------------------------------------------------------------
'CM Taxes (GSSTAX)                   | Populate  | 56400 | Post Save | 56410 | Exit        | 56420 |             |       |             |       | V.Passed.Global - Set on main screen.  Commit to DB on Main Sv |
'------------------------------------+-----------+-------+-----------+-------+-------------+-------+-------------+-------+-------------+-------------------------------------------------------------------------
'Vendor Master  (APS002A)            | Load      | 14461 | Pre Exit  | 14468 | Post Save   | 14470 | Post Clear  | 14471 | Post Delete | 14475 | V.Passed.000002                                                |
'------------------------------------+-----------+-------+-----------+-------+-------------+-------+-------------+-------+-------------+-------------------------------------------------------------------------
'VM Options   (APS002O)              | Load      | 14501 | Post Save | 14508 | Exit        | 14503 |             |       |             |       | V.Passed.Global                                                |
'------------------------------------+-----------+-------+-----------+-------+-------------+-------+-------------+-------+-------------+-------------------------------------------------------------------------
'ACH  (APS002B)                      | Populate  | 42305 | Pre Save  | 42312 | Exit        | 42310 | Post Save   | 42314 |             |       | V.Passed.Global                                                |
'------------------------------------+-----------+-------+-----------+-------+-------------+-------+-------------+-------+-------------+-------------------------------------------------------------------------
'Inventory Master (INS010B)          | Load Part | 10125 | Post Save | 10185 | Exit        | 10180 |             |       |             |       | V.Passed.000007(PN),V.Passed.000008(Rev),V.Passed.000009(Loc)  |
'------------------------------------+-----------+-------+-----------+-------+-------------+-------+-------------+-------+-------------+-------------------------------------------------------------------------
'InvMstr XREF   (INVS01XR)           | Populate  | 13080 | Post Save |       | Pre Exit    | 13160 | HDR Pop     |       | Post Delete |       | V.Passed.000001(PN),V.Passed.000002(Rev),V.Passed.000003(Loc)  |
'------------------------------------+-----------+-------+-----------+-------+-------------+-------+-------------+-------+-------------+-------------------------------------------------------------------------
'InvMstr Options  (INS010C)          | Populate  | 13280 | OK        | 13290 | Exit        | 13301 |             |       |             |       | V.Passed.PART(PN),V.Passed.REV(Rev),V.Passed.LOC(Loc)          |
'------------------------------------+-----------+-------+-----------+-------+-------------+-------+-------------+-------+-------------+-------------------------------------------------------------------------
'InvMstr Usage (INS010D)             | Load      | 10234 | Post Save | 10238 | Post Exit   | 10239 |             |       |             |       | V.Passed.Global - Set on main screen.  Commit to DB on Main Sv |
'------------------------------------+-----------+-------+-----------+-------+-------------+-------+-------------+-------+-------------+-------------------------------------------------------------------------
'Item Master Main  (ITS014)          | Populate  | 15600 | Post Save | 15615 | Exit        | 15660 | Delete      | 15640 |             |       | V.Passed.000001(PN),V.Passed.000048(Rev),V.Passed.000003(Loc)  |
'------------------------------------+-----------+-------+-----------+-------+-------------+-------+-------------+-------+-------------+-------------------------------------------------------------------------
'ItMstr Lot/Bin User Fields (PUS103U)| Populate  | 44910 | Pre Save  | 44960 | Pre Exit    | 44950 |             |       |             |       |                                                                |
'------------------------------------+-----------+-------+-----------+-------+-------------+-------+-------------+-------+-------------+-------------------------------------------------------------------------
'User Security Maintenance           | Pre Save  | 33708 | Post Save | 33709 | Pre Delete  | 33730 |             |       |             |       |                                                                |
'------------------------------------+-----------+-------+-----------+-------+-------------+-------+-------------+-------+-------------+-------------------------------------------------------------------------
'USM New [Terminal] button           | Pre New   | 33732 | Post New  | 33733 |             |       |             |       |             |       |                                                                |
'------------------------------------+-----------+-------+-----------+-------+-------------+-------+-------------+-------+-------------+-------------------------------------------------------------------------
'USM System Groups                   | Pre Save  | 33724 | Post Save | 33725 |             |       |             |       |             |       | Same hooks for add or delete                                   |
'------------------------------------+-----------+-------+-----------+-------+-------------+-------+-------------+-------+-------------+-------------------------------------------------------------------------
'USM Link Security                   | Pre Save  | 33716 | Post Save | 33717 |             |       |             |       |             |       | V.Passed.UserInfo-txtID                                        |
'------------------------------------+-----------+-------+-----------+-------+-------------+-------+-------------+-------+-------------+-------------------------------------------------------------------------
'USM VMS Security                    | Pre Save  | 33720 | Post Save | 33721 |             |       |             |       |             |       | V.Passed.UserInfo-txtID                                        |
'------------------------------------+-----------+-------+-----------+-------+-------------+-------+-------------+-------+-------------+-------------------------------------------------------------------------
'USM Permissions                     | Pre Save  | 33714 | Post Save | 33715 |             |       |             |       |             |       |                                                                |
'------------------------------------+-----------+-------+-----------+-------+-------------+-------+-------------+-------+-------------+-------------------------------------------------------------------------
'USM Options                         | Populate  | 34110 | Save      | 34130 | Exit        | 34105 |             |       |             |       | V.Passed.000021(ID)                                            |
'------------------------------------+-----------+-------+-----------+-------+-------------+-------+-------------+-------+-------------+-------------------------------------------------------------------------
'SS > File > User Sec by Menu Item   | Pre Add   |       | Post Add  | 56761 | Pre Remove  |       | Post Remove | 56763 |             |       | V.Passed.USERID, V.Passed.MENUPATH                             |
'------------------------------------+-----------+-------+-----------+-------+-------------+-------+-------------+-------+-------------+-------------------------------------------------------------------------
'Group Security Maintenance          | Pre Save  | 33710 | Post Save | 33711 | Pre Delete  | 33728 | Post Delete | 33729 |             |       |                                                                |
'------------------------------------+-----------+-------+-----------+-------+-------------+-------+-------------+-------+-------------+-------------------------------------------------------------------------
'GSM Group Members                   | Pre Save  | 33726 | Post Save | 33727 |             |       |             |       |             |       | Same hooks for add or delete                                   |
'------------------------------------+-----------+-------+-----------+-------+-------------+-------+-------------+-------+-------------+-------------------------------------------------------------------------
'GSM Link Security                   | Pre Save  | 33718 | Post Save | 33719 |             |       |             |       |             |       |                                                                |
'------------------------------------+-----------+-------+-----------+-------+-------------+-------+-------------+-------+-------------+-------------------------------------------------------------------------
'GSM VMS                             | Pre Save  | 33722 | Post Save | 33723 |             |       |             |       |             |       |                                                                |
'----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
'GSM Permissions                     | Pre Save  | 33712 | Post Save | 33713 |             |       |             |       |             |       |                                                                |
'----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Program.Sub.About.End

Program.Sub.Main.Start
F.Intrinsic.Control.Try
Function.Intrinsic.UI.UsePixels ' Allows you to use Pixels instead of Twips throughout
'See Program.Sub.About for details
V.Local.sTemp.Declare
V.Local.sTemp1.Declare

Function.Global.General.GetMenuPathFromProg(V.Caller.Caller,V.Caller.Switches,V.Local.sTemp)

F.ODBC.Connection!conts.OpenCompanyConnection
F.Intrinsic.String.Build("Select JOB_STREAM_ID from MENU_JOB_STREAM where PROGRAM_APP = '{0}' and PROGRAM_FLAGS = '{1}'",V.Caller.Caller,V.Caller.Switches,V.Local.sTemp)
F.ODBC.Connection!conts.ExecuteAndReturn(V.Local.sTemp,V.Local.sTemp)

F.ODBC.Connection!conts.Close

F.Intrinsic.Control.If(V.Local.sTemp.Trim,<>,"")
	F.Global.General.GetMenuPathFromJobstreamID(V.Local.sTemp,V.Local.sTemp1)
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.SelectCase(V.Caller.Hook)
	'Load/Populate - Primary Screens
	F.Intrinsic.Control.CaseAny(14461,14387,10125,15600)
		F.Global.Registry.AddValue(V.Caller.User,V.Caller.CompanyCode,"GCG_6325_SYS_AUDIT",6325,5150,False,V.Caller.Switches,False,0,0.00,"1/1/1900","12:00:00 AM")
		F.Intrinsic.Control.CallSub(LoadPop)
	'Load/Populate - Minor Screens
	F.Intrinsic.Control.CaseAny(14410,14501,56400,42305,13080,13280,10234,44910)
		F.Intrinsic.Control.CallSub(LoadPop)
	'Exit and Clear - Primary Screens
	F.Intrinsic.Control.CaseAny(14468,14471,10180,15660)
		F.Intrinsic.Control.CallSub(SoftExit)
		F.Intrinsic.Control.CallSub(ExitClear)
	'Exit and Clear - Minor Screens
	F.Intrinsic.Control.CaseAny(14503,10239,44950)
		F.Intrinsic.Control.CallSub(ExitClear)
	'Soft Exit and Clear - Minor Screens
	F.Intrinsic.Control.CaseAny(13301,14445,56420,42310)
		F.Intrinsic.Control.CallSub(SoftExit)
	'Save and Delete - Primary Screens
	F.Intrinsic.Control.CaseAny(14475,14386,15615,15640)
		F.Intrinsic.Control.CallSub(SaveDel)
	'Soft Save - Primary Screens
		F.Intrinsic.Control.CaseAny(14385,14470,10185)
		F.Intrinsic.Control.CallSub(SoftSavePrime)
	'Save and Delete - Minor Screens
	F.Intrinsic.Control.CaseAny(10238,44960,13160)
		F.Intrinsic.Control.CallSub(SaveDel)
	'Soft Save screens - Minor
	F.Intrinsic.Control.CaseAny(13290,14443,14508,56410,42314)
		F.Intrinsic.Control.CallSub(SoftSave)	
	'USM Pre-save hooks
	F.Intrinsic.Control.CaseAny(33716,33720,33714,33724,34110,33708,33732,33730)
		F.Intrinsic.Control.CallSub(USM_IN)
	'USM Post-save hooks and User Security Maintenance and System Support > File > User Security by Menu Item
	F.Intrinsic.Control.CaseAny(33717,33721,33715,56761,56763,33725,34105,34130,33709,33733)
		F.Intrinsic.Control.CallSub(USM_OUT)
	'GSM Pre-save hooks
	F.Intrinsic.Control.CaseAny(33712,33718,33722,33726,33710,33728)
		F.Intrinsic.Control.CallSub(GSM_IN)
	'GSM Post-save hooks
	F.Intrinsic.Control.CaseAny(33713,33719,33723,33727,33711,33729)
		F.Intrinsic.Control.CallSub(GSM_OUT)
	'Dashboard 
	F.Intrinsic.Control.CaseElse
		F.Intrinsic.Control.If(V.Caller.Switches,=,"DB")
			Gui.frmMain..Show
		F.Intrinsic.Control.EndIf
F.Intrinsic.Control.EndSelect

F.Intrinsic.Control.Catch
	F.Intrinsic.Control.CallSub(Error,"SubRoutine",V.Ambient.CurrentSubroutine,"eNumber",V.Ambient.ErrorNumber,"eDescription",V.Ambient.ErrorDescription)
F.Intrinsic.Control.EndTry
Program.Sub.Main.End

Program.Sub.LoadPop.Start
F.Intrinsic.Control.Try
V.Local.bExists.Declare
V.Local.sIdentifier.Declare

F.Intrinsic.Control.SelectCase(V.Caller.Hook)
	'Primary
	F.Intrinsic.Control.CaseAny(14461,14387)
		V.Passed.Global.Set(V.Passed.000002)
	F.Intrinsic.Control.Case(15600)
		F.Intrinsic.String.Build("{0}-{1}-{2}",V.Passed.000001,V.Passed.000002,V.Passed.000003,V.Local.sIdentifier)
		V.Passed.Global.Set(V.Local.sIdentifier)
	F.Intrinsic.Control.Case(10125)
		F.Intrinsic.String.Build("{0}-{1}-{2}",V.Passed.000007,V.Passed.000008,V.Passed.000009,V.Local.sIdentifier)
		V.Passed.Global.Set(V.Local.sIdentifier)
	F.Intrinsic.Control.Case(34110)
		V.Passed.Global.Set(V.Passed.000021)
	'Minor
	F.Intrinsic.Control.CaseAny(13080)
		F.Intrinsic.String.Build("{0}-{1}-{2}",V.Passed.000001,V.Passed.000002,V.Passed.000003,V.Local.sIdentifier)
		V.Passed.Global.Set(V.Local.sIdentifier)
	F.Intrinsic.Control.Case(13280)
		F.Intrinsic.String.Build("{0}-{1}-{2}",V.Passed.PART,V.Passed.REV,V.Passed.LOC,V.Local.sIdentifier)
		V.Passed.Global.Set(V.Local.sIdentifier)
	F.Intrinsic.Control.Case(14410)
		V.Passed.Global.Set(V.Passed.000001)		
	F.Intrinsic.Control.Case(42305)
		V.Passed.Global.Set(V.Passed.VENDOR-NUMBER)
	F.Intrinsic.Control.CaseAny(56400,10234,44910)
	
F.Intrinsic.Control.EndSelect

F.Intrinsic.Control.CallSub(NameFile)
	
F.Intrinsic.File.Exists(V.Global.sPath,V.Local.bExists)
F.Intrinsic.Control.If(V.Local.bExists)
	F.Intrinsic.File.DeleteFile(V.Global.sPath)
F.Intrinsic.Control.EndIf

F.Intrinsic.File.Exists(V.Global.sMinorPath,V.Local.bExists)
F.Intrinsic.Control.If(V.Local.bExists)
	F.Intrinsic.File.DeleteFile(V.Global.sMinorPath)
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.SelectCase(V.Caller.Hook)
	'BDF Hooks
	F.Intrinsic.Control.Case(13080)
		F.Intrinsic.Control.CallSub(BDFIn)
	'Standard Hooks
	F.Intrinsic.Control.CaseElse
		F.Intrinsic.Control.CallSub(InitVal)
F.Intrinsic.Control.EndSelect

F.Intrinsic.Control.End

F.Intrinsic.Control.Catch
	F.Intrinsic.Control.CallSub(Error,"SubRoutine",V.Ambient.CurrentSubroutine,"eNumber",V.Ambient.ErrorNumber,"eDescription",V.Ambient.ErrorDescription)
F.Intrinsic.Control.EndTry
Program.Sub.LoadPop.End

Program.Sub.NameFile.Start
F.Intrinsic.Control.Try
V.Local.sScreen.Declare
V.Local.sCompPath.Declare
V.Local.sSoftPath.Declare
V.Local.bCompChk.Declare
V.Local.bSoftChk.Declare

F.ODBC.Connection!conts.OpenCompanyConnection
F.Intrinsic.String.Build("Select RTRIM(SCREEN) from HOOK_GLOBAL where Right(ID,5) = '{0}'",V.Caller.Hook,V.Local.sScreen)
F.ODBC.Connection!conts.ExecuteAndReturn(V.Local.sScreen,V.Local.sScreen)
F.ODBC.Connection!conts.Close

F.Intrinsic.Control.If(V.Local.sScreen.Trim,<>,"")
	F.Communication.Misc.EncodeToString(3,V.Local.sScreen,V.Local.sScreen)
	F.Intrinsic.String.Replace(V.Local.sScreen,"%a0","",V.Local.sScreen)
	F.Communication.Misc.DecodeToString(3,V.Local.sScreen,V.Local.sScreen)
F.Intrinsic.Control.Else
	V.Local.sScreen.Set(V.Caller.Hook)
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.SelectCase(V.Caller.Hook)
	F.Intrinsic.Control.CaseAny(14461,10125,15600,34110,14468,14471,14387,10180,15660,34105,14470,14475,14385,14386,10185,15615,15640)
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Global.sPath)
	F.Intrinsic.Control.CaseAny(14410,14501,56400,42305,13080,13280,10234,44910,14445,56420,14503,42310,42314,13160,13301,10239,44950,14508,42312,13290,10238,44960)
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Global.sMinorPath)
F.Intrinsic.Control.EndSelect

F.Intrinsic.Control.SelectCase(V.Caller.Hook)
	F.Intrinsic.Control.Case(14461)
		'ACH Screen
		F.Intrinsic.String.Build("{0}{1}_APS002B_compare.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sCompPath)
		F.Intrinsic.String.Build("{0}{1}_APS002B.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sSoftPath)
		
		F.Intrinsic.File.Exists(V.Local.sCompPath,V.Local.bCompChk)
		F.Intrinsic.File.Exists(V.Local.sSoftPath,V.Local.bSoftChk)
		
		F.Intrinsic.Control.If(V.Local.bCompChk,=,"True","AND",V.Local.bSoftChk,=,"True")
			F.Intrinsic.File.DeleteFile(V.Local.sCompPath)
			F.Intrinsic.File.DeleteFile(V.Local.sSoftPath)
		F.Intrinsic.Control.EndIf	
		
		'Options Screen
		F.Intrinsic.String.Build("{0}{1}_APS002O_compare.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sCompPath)
		F.Intrinsic.String.Build("{0}{1}_APS002O.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sSoftPath)
		
		F.Intrinsic.File.Exists(V.Local.sCompPath,V.Local.bCompChk)
		F.Intrinsic.File.Exists(V.Local.sSoftPath,V.Local.bSoftChk)
		
		F.Intrinsic.Control.If(V.Local.bCompChk,=,"True","AND",V.Local.bSoftChk,=,"True")
			F.Intrinsic.File.DeleteFile(V.Local.sCompPath)
			F.Intrinsic.File.DeleteFile(V.Local.sSoftPath)
		F.Intrinsic.Control.EndIf
F.Intrinsic.Control.EndSelect

F.Intrinsic.Control.Catch
	F.Intrinsic.Control.CallSub(Error,"SubRoutine",V.Ambient.CurrentSubroutine,"eNumber",V.Ambient.ErrorNumber,"eDescription",V.Ambient.ErrorDescription)
F.Intrinsic.Control.EndTry
Program.Sub.NameFile.End

Program.Sub.ExitClear.Start
F.Intrinsic.Control.Try
V.Local.bExists.Declare

F.Intrinsic.Control.CallSub(NameFile)

F.Intrinsic.File.Exists(V.Global.sPath,V.Local.bExists)
F.Intrinsic.Control.If(V.Local.bExists)
	F.Intrinsic.File.DeleteFile(V.Global.sPath)
F.Intrinsic.Control.EndIf

F.Intrinsic.File.Exists(V.Global.sMinorPath,V.Local.bExists)
F.Intrinsic.Control.If(V.Local.bExists)
	F.Intrinsic.File.DeleteFile(V.Global.sMinorPath)
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.End

F.Intrinsic.Control.Catch
	F.Intrinsic.Control.CallSub(Error,"SubRoutine",V.Ambient.CurrentSubroutine,"eNumber",V.Ambient.ErrorNumber,"eDescription",V.Ambient.ErrorDescription)
F.Intrinsic.Control.EndTry
Program.Sub.ExitClear.End

Program.Sub.SaveDel.Start
F.Intrinsic.Control.Try
V.Local.bExists.Declare
V.Local.sIdentifier.Declare
V.Local.sSwitches.Declare

V.Local.sSwitches.Set(V.Caller.Switches)

F.Intrinsic.Control.SelectCase(V.Caller.Hook)
	F.Intrinsic.Control.CaseAny(14385,14386,14470,14475)
		V.Passed.Global.Set(V.Passed.000002)
	F.Intrinsic.Control.CaseAny(15615,15640)
		F.Intrinsic.String.Build("{0}-{1}-{2}",V.Passed.000001,V.Passed.000002,V.Passed.000003,V.Local.sIdentifier)
		V.Passed.Global.Set(V.Local.sIdentifier)
		F.Global.Registry.ReadValue(V.Caller.User,V.Caller.CompanyCode,"GCG_6325_SYS_AUDIT",6325,5150,5,"",V.Local.sSwitches)
	F.Intrinsic.Control.Case(10185)
		F.Intrinsic.String.Build("{0}-{1}-{2}",V.Passed.000007,V.Passed.000008,V.Passed.000009,V.Local.sIdentifier)
		V.Passed.Global.Set(V.Local.sIdentifier)
	F.Intrinsic.Control.Case(13290)
		F.Intrinsic.String.Build("{0}-{1}-{2}",V.Passed.PART,V.Passed.REV,V.Passed.LOC,V.Local.sIdentifier)
		V.Passed.Global.Set(V.Local.sIdentifier)
	F.Intrinsic.Control.Case(42312)
		V.Passed.Global.Set(V.Passed.VENDOR-NUMBER)
	F.Intrinsic.Control.CaseAny(13160)
		F.Intrinsic.String.Build("{0}-{1}-{2}",V.Passed.000001,V.Passed.000002,V.Passed.000003,V.Local.sIdentifier)
		V.Passed.Global.Set(V.Local.sIdentifier)
F.Intrinsic.Control.EndSelect

F.Intrinsic.Control.CallSub(NameFile)
F.Intrinsic.Control.CallSub(Compare)

F.Intrinsic.File.Exists(V.Global.sPath,V.Local.bExists)
F.Intrinsic.Control.If(V.Local.bExists)
	F.Intrinsic.File.DeleteFile(V.Global.sPath)
F.Intrinsic.Control.EndIf

F.Intrinsic.File.Exists(V.Global.sMinorPath,V.Local.bExists)
F.Intrinsic.Control.If(V.Local.bExists)
	F.Intrinsic.File.DeleteFile(V.Global.sMinorPath)
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.If(V.Local.sSwitches.Trim,=,"O")
	F.Intrinsic.Control.CallSub(NameFile)
	F.Intrinsic.Control.CallSub(InitVal)
F.Intrinsic.Control.Else
	F.Intrinsic.Control.End
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.End

F.Intrinsic.Control.Catch
	F.Intrinsic.Control.CallSub(Error,"SubRoutine",V.Ambient.CurrentSubroutine,"eNumber",V.Ambient.ErrorNumber,"eDescription",V.Ambient.ErrorDescription)
F.Intrinsic.Control.EndTry
Program.Sub.SaveDel.End

Program.Sub.SoftSave.Start
F.Intrinsic.Control.Try
V.Local.sScreen.Declare
V.local.sRet.Declare
V.local.sKey.Declare
V.local.sVal.Declare
V.Local.sVarName.Declare
V.Local.iCnt.Declare
V.Local.sSoftPath.Declare
V.Local.sCompPath.Declare
V.Local.sIdent.Declare
V.Local.sBA_ENC.Declare
V.Local.sSQL.Declare

F.ODBC.Connection!conts.OpenCompanyConnection
F.Intrinsic.String.Build("Select RTRIM(SCREEN) from HOOK_GLOBAL where Right(ID,5) = '{0}'",V.Caller.Hook,V.Local.sScreen)
F.ODBC.Connection!conts.ExecuteAndReturn(V.Local.sScreen,V.Local.sScreen)
F.ODBC.Connection!conts.Close

F.Intrinsic.Control.If(V.Local.sScreen.Trim,<>,"")
	F.Communication.Misc.EncodeToString(3,V.Local.sScreen,V.Local.sScreen)
	F.Intrinsic.String.Replace(V.Local.sScreen,"%a0","",V.Local.sScreen)
	F.Communication.Misc.DecodeToString(3,V.Local.sScreen,V.Local.sScreen)
F.Intrinsic.Control.Else
	V.Local.sScreen.Set(V.Caller.Hook)
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.SelectCase(V.Caller.Hook)
	F.Intrinsic.Control.CaseAny(13290,14443,14508,56410,42312,42314)
		F.Intrinsic.String.Build("{0}{1}_{2}_compare.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sCompPath)
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sSoftPath)
F.Intrinsic.Control.EndSelect

F.Intrinsic.Control.If(V.DataTable.dtPassed.Exists)
	F.Data.DataTable.Close("dtPassed")
F.Intrinsic.Control.EndIf

F.Data.DataTable.Create("dtPassed",True)
F.Data.DataTable.AddColumn("dtPassed","Identifier","String")
F.Data.DataTable.AddColumn("dtPassed","PassedVar","String")
F.Data.DataTable.AddColumn("dtPassed","VarName","String")
F.Data.DataTable.AddColumn("dtPassed","VarVal","String")

F.Intrinsic.Variable.ListCallerVars(False,V.local.sRet)
F.Intrinsic.String.Split(V.Local.sRet,"*!*",V.Local.sRet)

F.Intrinsic.Control.If(V.Caller.Hook,=,14443)
	F.Intrinsic.String.Build("{0}-{1}",V.Passed.GLOBAL.Trim,V.Passed.000003.Trim,V.Local.sIdent)
F.Intrinsic.Control.Else
	V.Local.sIdent.Set(V.Passed.GLOBAL.Trim)
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.For(V.Local.iCnt,V.Local.sRet.LBound,V.Local.sRet.UBound,1)
	V.Local.sKey.Set(V.Local.sRet(V.Local.iCnt))
	V.local.sVal.Set(V.Passed.[V.Local.sKey].CurrentVal)
	V.Local.sVarName.Set(V.Passed.[V.Local.sKey].Name)
	
	F.Data.DataTable.AddRow("dtPassed","Identifier",V.Local.sIdent.Trim,"PassedVar",V.Local.sKey,"VarName",V.Local.sVarName,"VarVal",V.Local.sVal)
F.Intrinsic.Control.Next(V.Local.iCnt)

F.Data.DataTable.SaveToXML("dtPassed",0,True,V.Local.sCompPath)

F.Intrinsic.Control.SelectCase(V.Caller.Hook)
	F.Intrinsic.Control.CaseAny(14508,42314)
		F.Intrinsic.Control.End
F.Intrinsic.Control.EndSelect

F.Intrinsic.Control.CallSub(SoftCompare,"CompPath",V.Local.sCompPath,"SoftPath",V.Local.sSoftPath,"sScreen",V.Local.sScreen)

F.Intrinsic.Control.Catch
	F.Intrinsic.Control.CallSub(Error,"SubRoutine",V.Ambient.CurrentSubroutine,"eNumber",V.Ambient.ErrorNumber,"eDescription",V.Ambient.ErrorDescription)
F.Intrinsic.Control.EndTry
Program.Sub.SoftSave.End

Program.Sub.SoftSavePrime.Start
F.Intrinsic.Control.Try
V.Local.bCompChk.Declare
V.Local.bSoftChk.Declare
V.Local.sCompPath.Declare
V.Local.sSoftPath.Declare

F.Intrinsic.Control.SelectCase(V.Caller.Hook)
	F.Intrinsic.Control.Case(14385)
		'Looking for Additional Ship-to before and after screen data
		F.Intrinsic.String.Build("{0}{1}_ARS002S_compare.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sCompPath)
		F.Intrinsic.String.Build("{0}{1}_ARS002S.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sSoftPath)
		
		F.Intrinsic.File.Exists(V.Local.sCompPath,V.Local.bCompChk)
		F.Intrinsic.File.Exists(V.Local.sSoftPath,V.Local.bSoftChk)
		
		F.Intrinsic.Control.If(V.Local.bCompChk,=,"True","AND",V.Local.bSoftChk,=,"True")
			F.Intrinsic.Control.CallSub(SoftCompare,"CompPath",V.Local.sCompPath,"SoftPath",V.Local.sSoftPath,"sScreen","ARS002S")
			F.Intrinsic.File.DeleteFile(V.Local.sCompPath)
			F.Intrinsic.File.DeleteFile(V.Local.sSoftPath)
		F.Intrinsic.Control.EndIf
		
		'GSTAX screen before and after
		F.Intrinsic.String.Build("{0}{1}_GSSTAX_compare.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sCompPath)
		F.Intrinsic.String.Build("{0}{1}_GSSTAX.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sSoftPath)
		
		F.Intrinsic.File.Exists(V.Local.sCompPath,V.Local.bCompChk)
		F.Intrinsic.File.Exists(V.Local.sSoftPath,V.Local.bSoftChk)
		
		F.Intrinsic.Control.If(V.Local.bCompChk,=,"True","AND",V.Local.bSoftChk,=,"True")
			F.Intrinsic.Control.CallSub(SoftCompare,"CompPath",V.Local.sCompPath,"SoftPath",V.Local.sSoftPath,"sScreen","GSSTAX")
			F.Intrinsic.File.DeleteFile(V.Local.sCompPath)
			F.Intrinsic.File.DeleteFile(V.Local.sSoftPath)
		F.Intrinsic.Control.EndIf
		
	F.Intrinsic.Control.Case(14470)
		'ACH Screen
		F.Intrinsic.String.Build("{0}{1}_APS002B_compare.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sCompPath)
		F.Intrinsic.String.Build("{0}{1}_APS002B.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sSoftPath)
		
		F.Intrinsic.File.Exists(V.Local.sCompPath,V.Local.bCompChk)
		F.Intrinsic.File.Exists(V.Local.sSoftPath,V.Local.bSoftChk)
		
		F.Intrinsic.Control.If(V.Local.bCompChk,=,"True","AND",V.Local.bSoftChk,=,"True")
			F.Intrinsic.Control.CallSub(SoftCompare,"CompPath",V.Local.sCompPath,"SoftPath",V.Local.sSoftPath,"sScreen","APS002B")
			F.Intrinsic.File.DeleteFile(V.Local.sCompPath)
			F.Intrinsic.File.DeleteFile(V.Local.sSoftPath)
		F.Intrinsic.Control.EndIf	
		
		'Options Screen
		F.Intrinsic.String.Build("{0}{1}_APS002O_compare.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sCompPath)
		F.Intrinsic.String.Build("{0}{1}_APS002O.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sSoftPath)
		
		F.Intrinsic.File.Exists(V.Local.sCompPath,V.Local.bCompChk)
		F.Intrinsic.File.Exists(V.Local.sSoftPath,V.Local.bSoftChk)
		
		F.Intrinsic.Control.If(V.Local.bCompChk,=,"True","AND",V.Local.bSoftChk,=,"True")
			F.Intrinsic.Control.CallSub(SoftCompare,"CompPath",V.Local.sCompPath,"SoftPath",V.Local.sSoftPath,"sScreen","APS002O")
			F.Intrinsic.File.DeleteFile(V.Local.sCompPath)
			F.Intrinsic.File.DeleteFile(V.Local.sSoftPath)
		F.Intrinsic.Control.EndIf
		
	F.Intrinsic.Control.Case(10185)
		'Inventory Master Options
		F.Intrinsic.String.Build("{0}{1}_INS010C_compare.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sCompPath)
		F.Intrinsic.String.Build("{0}{1}_INS010C.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sSoftPath)
		
		F.Intrinsic.File.Exists(V.Local.sCompPath,V.Local.bCompChk)
		F.Intrinsic.File.Exists(V.Local.sSoftPath,V.Local.bSoftChk)
		
		F.Intrinsic.Control.If(V.Local.bCompChk,=,"True","AND",V.Local.bSoftChk,=,"True")
			F.Intrinsic.Control.CallSub(SoftCompare,"CompPath",V.Local.sCompPath,"SoftPath",V.Local.sSoftPath,"sScreen","INS010C")
			F.Intrinsic.File.DeleteFile(V.Local.sCompPath)
			F.Intrinsic.File.DeleteFile(V.Local.sSoftPath)
		F.Intrinsic.Control.EndIf	
	
F.Intrinsic.Control.EndSelect

F.Intrinsic.Control.CallSub(SaveDel)

F.Intrinsic.Control.Catch
	F.Intrinsic.Control.CallSub(Error,"SubRoutine",V.Ambient.CurrentSubroutine,"eNumber",V.Ambient.ErrorNumber,"eDescription",V.Ambient.ErrorDescription)
F.Intrinsic.Control.EndTry
Program.Sub.SoftSavePrime.End

Program.Sub.SoftCompare.Start
F.Intrinsic.Control.Try
V.Local.sCompPath.Declare
V.Local.sSoftPath.Declare
V.Local.sScreen.Declare
V.Local.sMenuRef.Declare
V.Local.sChgDate.Declare
V.Local.sChgTime.Declare
V.Local.iCnt.Declare
V.Local.sSQL.Declare
V.Local.sSwitches.Declare
V.Local.sBA_ENC.Declare

V.Local.sCompPath.Set(V.Args.CompPath)
V.Local.sSoftPath.Set(V.Args.SoftPath)

F.Intrinsic.String.Format(V.Ambient.Date,"MM/DD/YYYY",V.Local.sChgDate)
F.Intrinsic.String.Format(V.Ambient.Time,"ttttt",V.Local.sChgTime)

F.Intrinsic.Control.If(V.DataTable.dtSoftPassed.Exists)
	F.Data.DataTable.Close("dtSoftPassed")
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.If(V.DataTable.dtPrevVal.Exists)
	F.Data.DataTable.Close("dtPrevVal")
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.If(V.DataTable.dtSoftAudit.Exists)
	F.Data.DataTable.Close("dtSoftAudit")
F.Intrinsic.Control.EndIf

F.Data.DataTable.CreateFromXML("dtSoftPassed",V.Local.sCompPath,True)
F.Data.DataTable.AddColumn("dtSoftPassed","PrevValue","String")

F.Intrinsic.Control.If(V.Caller.Hook,=,"14470","AND",V.Args.sScreen,=,"APS002B")
	F.Intrinsic.Control.For(V.Local.iCnt,0,V.DataTable.dtSoftPassed.RowCount--,1)

		F.Intrinsic.Control.If(V.DataTable.dtSoftPassed(V.Local.iCnt).PassedVar!FieldValTrim,=,"000006")
			F.Intrinsic.String.Build("select BANK_ACCT_ENC from VENDOR_ENCRYPT where VENDOR_ID = '{0}'",V.Passed.GLOBAL.Trim,V.Local.sSQL)
			F.ODBC.Connection!conts.OpenCompanyConnection
				F.ODBC.Connection!conts.OpenLocalRecordsetRO("rst",V.Local.sSQL)
				F.Global.Encryption.Decrypt(V.ODBC.conts!rst.FieldVal!BANK_ACCT_ENC,V.Local.sBA_ENC)
				F.ODBC.conts!rst.Close
			F.ODBC.Connection!conts.Close
			F.Intrinsic.Control.If(V.Local.sBA_ENC.Trim,<>,"")
				F.Intrinsic.String.WeakEncryption(V.Local.sBA_ENC.Trim,V.Local.sBA_ENC)
				F.Data.DataTable.SetValue("dtSoftPassed",V.Local.iCnt,"VarVal",V.Local.sBA_ENC)
			F.Intrinsic.Control.Else
				F.Data.DataTable.SetValue("dtSoftPassed",V.Local.iCnt,"VarVal","")
			F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.EndIf

	F.Intrinsic.Control.Next(V.Local.iCnt)
F.Intrinsic.Control.EndIf

F.Data.DataTable.CreateFromXML("dtPrevVal",V.Local.sSoftPath,True)

F.Data.Dictionary.CreateFromDataTable("dictPrevVal","dtPrevVal","PassedVar","VarVal")
F.Data.Dictionary.SetDefaultReturn("dictPrevVal","")
F.Data.DataTable.FillFromDictionary("dtSoftPassed","dictPrevVal","PassedVar","PrevValue")
F.Data.Dictionary.Close("dictPrevVal")
F.Data.DataTable.AddExpressionColumn("dtSoftPassed","Changed","Boolean","IIf(VarVal<>PrevValue,True,False)")

F.Data.DataView.Create("dtSoftPassed","dvPassed",22,"Changed=True","")

F.Data.DataView.ToDataTable("dtSoftPassed","dvPassed","dtSoftAudit")

F.Intrinsic.Control.If(V.Caller.Hook,=,14443)
	F.Global.Registry.ReadValue(V.Caller.User,V.Caller.CompanyCode,"GCG_6325_SYS_AUDIT",6325,5150,5,"",V.Local.sSwitches)
	F.Intrinsic.Control.If(V.Local.sSwitches,=,"A")
		F.Global.Registry.AddValue(V.Caller.User,V.Caller.CompanyCode,"GCG_6325_SYS_AUDIT",6325,5150,False,"",False,0,0.00,"1/1/1900","12:00:00 AM")
		F.Data.DataTable.DeleteRow("dtSoftAudit",-1)
		F.Data.DataTable.AddRow("dtSoftAudit","Identifier",V.DataView.dtSoftPassed!dvPassed(0).Identifier!FieldValTrim,"PassedVar","000000","VarName","Addl Ship To","VarVal","ID Added","PrevValue","","Changed",1)		
	F.Intrinsic.Control.Else
		F.ODBC.Connection!conts.OpenCompanyConnection
		F.Intrinsic.String.Build("Select SHIP_SEQ from V_OE_MULTI_SHIP where CUSTOMER = '{0}' and SHIP_SEQ = '{1}'",V.Passed.000001.Trim,V.Passed.000003.Trim,V.Local.sSQL)
		F.ODBC.Connection!conts.ExecuteAndReturn(V.Local.sSQL,V.Local.sSQL)
		F.ODBC.Connection!conts.Close
		
		F.Intrinsic.Control.If(V.Ambient.ExecuteAndReturnEOF)
			F.Data.DataTable.DeleteRow("dtSoftAudit",-1)
			F.Data.DataTable.AddRow("dtSoftAudit","Identifier",V.DataView.dtSoftPassed!dvPassed(0).Identifier!FieldValTrim,"PassedVar","000000","VarName","Addl Ship To","VarVal","","PrevValue","ID Deleted","Changed",1)
		F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.EndIf
F.Intrinsic.Control.EndIf

F.Data.DataTable.AddColumn("dtSoftAudit","CHG_PGM","String",V.Caller.Caller)
F.Data.Datatable.AddColumn("dtSoftAudit","SCREEN","String")
F.Data.Datatable.AddColumn("dtSoftAudit","MENU_REF","String")
F.Data.DataTable.AddColumn("dtSoftAudit","CHG_USER","String",V.Caller.User)
F.Data.DataTable.AddColumn("dtSoftAudit","CHG_DATE","String",V.Local.sChgDate)
F.Data.DataTable.AddColumn("dtSoftAudit","CHG_TIME","String",V.Local.sChgTime)

F.ODBC.Connection!conts.OpenCompanyConnection

F.Intrinsic.Control.SelectCase(V.Args.sScreen)
	F.Intrinsic.Control.Case("ARS002S")
		V.Local.sScreen.Set("ARS002S")
		V.Local.sMenuRef.Set("Accounts Receivable > File > Customers > Open > Additional Ship To Button")
	F.Intrinsic.Control.Case("GSSTAX")
		V.Local.sScreen.Set("GSSTAX")
		V.Local.sMenuRef.Set("Accounts Receivable > File > Customers > Open > Taxes")
	F.Intrinsic.Control.Case("APS002B")
		V.Local.sScreen.Set("APS002B")
		V.Local.sMenuRef.Set("Accounts Payable > File > Vendors > ACH")
	F.Intrinsic.Control.Case("APS002O")
		V.Local.sScreen.Set("APS002O")
		V.Local.sMenuRef.Set("Accounts Payable > File > Vendors > Options")
	F.Intrinsic.Control.Case("INS010C")
		V.Local.sScreen.Set("INS010C")
		V.Local.sMenuRef.Set("Inventory > File > Inventory Parts > Open > Options")
F.Intrinsic.Control.EndSelect

F.Data.Datatable.SetValue("dtSoftAudit",-1,"SCREEN",V.Local.sScreen,"MENU_REF",V.Local.sMenuRef)

F.Intrinsic.Control.For(V.Local.iCnt,V.DataTable.dtSoftAudit.RowCount--,0,-1)
	F.Intrinsic.Control.If(V.DataTable.dtSoftAudit(V.Local.iCnt).VarName!FieldValTrim,=,"VERSION-77","OR",V.DataTable.dtSoftAudit(V.Local.iCnt).VarName!FieldValTrim,=,"ADDITIONAL-DATA")
		F.Data.DataTable.DeleteRow("dtSoftAudit",V.Local.iCnt)
	F.Intrinsic.Control.EndIf
F.Intrinsic.Control.Next(V.Local.iCnt)

F.Intrinsic.Control.For(V.Local.iCnt,V.DataTable.dtSoftAudit.RowCount--,0,-1)
	F.Intrinsic.Control.If(V.DataTable.dtSoftAudit(V.Local.iCnt).PassedVar!FieldValTrim,=,"000006","AND",V.Caller.Hook,=,"14470")
		F.Data.DataTable.SetValue("dtSoftAudit",V.Local.iCnt,"VarVal","Bank Acct Number Changed","PrevValue","Protected")
	F.Intrinsic.Control.EndIf
F.Intrinsic.Control.Next(V.Local.iCnt)

F.Data.DataTable.SaveToDB("dtSoftAudit","conts","GCG_6325_SYS_AUDIT","",128,"Identifier@!@Identifier*!*VarName@!@FIELD_NAME*!*PrevValue@!@OLD_VALUE*!*VarVal@!@NEW_VALUE*!*CHG_PGM@!@CHG_PGM*!*SCREEN@!@SCREEN*!*MENU_REF@!@MENU_REF*!*CHG_USER@!@CHG_USER*!*CHG_DATE@!@CHG_DATE*!*CHG_TIME@!@CHG_TIME")

F.ODBC.Connection!conts.Close
F.Intrinsic.Control.SelectCase(V.Caller.Hook)
	F.Intrinsic.Control.Case(56410)
		F.Global.General.FireHook(56420)
F.Intrinsic.Control.EndSelect

F.Intrinsic.Control.Catch
	F.Intrinsic.Control.CallSub(Error,"SubRoutine",V.Ambient.CurrentSubroutine,"eNumber",V.Ambient.ErrorNumber,"eDescription",V.Ambient.ErrorDescription)
F.Intrinsic.Control.EndTry
Program.Sub.SoftCompare.End

Program.Sub.SoftExit.Start
F.Intrinsic.Control.Try
V.Local.sSoftPath.Declare
V.Local.sCompPath.Declare
V.Local.bChk.Declare

F.Intrinsic.Control.SelectCase(V.Caller.Hook)
	F.Intrinsic.Control.CaseAny(14445)
		F.Global.Registry.AddValue(V.Caller.User,V.Caller.CompanyCode,"GCG_6325_SYS_AUDIT",6325,5150,False,"",False,0,0.00,"1/1/1900","12:00:00 AM")
		F.Intrinsic.String.Build("{0}{1}_ARS002S_compare.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sCompPath)
		F.Intrinsic.String.Build("{0}{1}_ARS002S.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sSoftPath)
	F.Intrinsic.Control.CaseAny(56420)
		F.Intrinsic.String.Build("{0}{1}_GSSTAX_compare.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sCompPath)
		F.Intrinsic.String.Build("{0}{1}_GSSTAX.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sSoftPath)
	F.Intrinsic.Control.CaseAny(42310)
		F.Intrinsic.String.Build("{0}{1}_APS002B_compare.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sCompPath)
		F.Intrinsic.String.Build("{0}{1}_APS002B.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sSoftPath)
	F.Intrinsic.Control.CaseAny(10180,13301)
		F.Intrinsic.String.Build("{0}{1}_INS010C_compare.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sCompPath)
		F.Intrinsic.String.Build("{0}{1}_INS010C.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sSoftPath)
F.Intrinsic.Control.EndSelect

F.Intrinsic.File.Exists(V.Local.sSoftPath,V.Local.bChk)

F.Intrinsic.Control.If(V.Local.bChk)
	F.Intrinsic.File.DeleteFile(V.Local.sSoftPath)
F.Intrinsic.Control.EndIf

F.Intrinsic.File.Exists(V.Local.sCompPath,V.Local.bChk)

F.Intrinsic.Control.If(V.Local.bChk)
	F.Intrinsic.File.DeleteFile(V.Local.sCompPath)
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.Catch
	F.Intrinsic.Control.CallSub(Error,"SubRoutine",V.Ambient.CurrentSubroutine,"eNumber",V.Ambient.ErrorNumber,"eDescription",V.Ambient.ErrorDescription)
F.Intrinsic.Control.EndTry
Program.Sub.SoftExit.End

Program.Sub.InitVal.Start
F.Intrinsic.Control.Try
V.local.sRet.Declare
V.local.sKey.Declare
V.local.sVal.Declare
V.Local.sVarName.Declare
V.Local.iCnt.Declare
V.Local.sSQL.Declare
V.Local.sSwitches.Declare
V.Local.baBnkEnc.Declare(ByteArray)
V.Local.sBA_ENC.Declare

F.Intrinsic.Control.If(V.DataTable.dtPassed.Exists)
	F.Data.DataTable.Close("dtPassed")
F.Intrinsic.Control.EndIf

F.Data.DataTable.Create("dtPassed",True)
F.Data.DataTable.AddColumn("dtPassed","Identifier","String")
F.Data.DataTable.AddColumn("dtPassed","PassedVar","String")
F.Data.DataTable.AddColumn("dtPassed","VarName","String")
F.Data.DataTable.AddColumn("dtPassed","VarVal","String")

F.Intrinsic.Variable.ListCallerVars(False,V.local.sRet)
F.Intrinsic.String.Split(V.Local.sRet,"*!*",V.Local.sRet)

F.Intrinsic.Control.For(V.Local.iCnt,V.Local.sRet.LBound,V.Local.sRet.UBound,1)
	V.Local.sKey.Set(V.Local.sRet(V.Local.iCnt))
	V.local.sVal.Set(V.Passed.[V.Local.sKey].CurrentVal)
	V.Local.sVarName.Set(V.Passed.[V.Local.sKey].Name)
	
	F.Intrinsic.String.LTrim(V.Local.sVal,V.Local.sVal)
	F.Intrinsic.String.RTrim(V.Local.sVal,V.Local.sVal)
	F.Intrinsic.String.LTrim(V.Local.sVarName,V.Local.sVarName)
	F.Intrinsic.String.RTrim(V.Local.sVarName,V.Local.sVarName)
	
	F.Intrinsic.Control.If(V.Caller.Hook,=,"42305")
		F.Intrinsic.Control.If(V.Local.sKey,=,"000006")
			F.Intrinsic.String.Build("select BANK_ACCT_ENC from VENDOR_ENCRYPT where VENDOR_ID = '{0}'",V.Passed.GLOBAL.Trim,V.Local.sSQL)
			F.ODBC.Connection!conts.OpenCompanyConnection
				F.ODBC.Connection!conts.OpenLocalRecordsetRO("rst",V.Local.sSQL)
				F.Global.Encryption.Decrypt(V.ODBC.conts!rst.FieldVal!BANK_ACCT_ENC,V.Local.sBA_ENC)
				F.ODBC.conts!rst.Close
			F.ODBC.Connection!conts.Close
			F.Intrinsic.Control.If(V.Local.sBA_ENC.Trim,<>,"")
				F.Intrinsic.String.WeakEncryption(V.Local.sBA_ENC.Trim,V.Local.sBA_ENC)
				F.Data.DataTable.AddRow("dtPassed","Identifier",V.Passed.GLOBAL.Trim,"PassedVar",V.Local.sKey,"VarName",V.Local.sVarName,"VarVal",V.Local.sBA_ENC)
			F.Intrinsic.Control.Else
				F.Data.DataTable.AddRow("dtPassed","Identifier",V.Passed.GLOBAL.Trim,"PassedVar",V.Local.sKey,"VarName",V.Local.sVarName,"VarVal","")
			F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.Else
			F.Data.DataTable.AddRow("dtPassed","Identifier",V.Passed.GLOBAL.Trim,"PassedVar",V.Local.sKey,"VarName",V.Local.sVarName,"VarVal",V.Local.sVal)
		F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.Else
		F.Data.DataTable.AddRow("dtPassed","Identifier",V.Passed.GLOBAL.Trim,"PassedVar",V.Local.sKey,"VarName",V.Local.sVarName,"VarVal",V.Local.sVal)
	F.Intrinsic.Control.EndIf	
	
F.Intrinsic.Control.Next(V.Local.iCnt)

F.Intrinsic.Control.SelectCase(V.Caller.Hook)
	F.Intrinsic.Control.CaseAny(10185,14385,14387,14461,10125,15600,34110,14470)
		F.Data.DataTable.SaveToXML("dtPassed",0,True,V.Global.sPath)
	F.Intrinsic.Control.CaseAny(14410,14501,56400,42305,13280,10234,44910)
		F.Intrinsic.Control.If(V.Caller.Hook,=,"14410")
			F.ODBC.Connection!conts.OpenCompanyConnection
			F.Intrinsic.String.Build("Select SHIP_SEQ from V_OE_MULTI_SHIP where CUSTOMER = '{0}' and SHIP_SEQ = '{1}'",V.Passed.000001.Trim,V.Passed.000003.Trim,V.Local.sSQL)
			F.ODBC.Connection!conts.ExecuteAndReturn(V.Local.sSQL,V.Local.sSQL)
			F.ODBC.Connection!conts.Close
			
			F.Intrinsic.Control.If(V.Ambient.ExecuteAndReturnEOF)
				V.Local.sSwitches.Set("A")				
			F.Intrinsic.Control.Else
				V.Local.sSwitches.Set("")
			F.Intrinsic.Control.EndIf
			F.Global.Registry.AddValue(V.Caller.User,V.Caller.CompanyCode,"GCG_6325_SYS_AUDIT",6325,5150,False,V.Local.sSwitches,False,0,0.00,"1/1/1900","12:00:00 AM")
		F.Intrinsic.Control.EndIf
		F.Data.DataTable.SaveToXML("dtPassed",0,True,V.Global.sMinorPath)
	F.Intrinsic.Control.CaseAny(13080)
		F.Data.DataView.Create("dtPassed","dvPassed",22,"PassedVar in ('AUX001','GRID-ROW-SEL','GRID-COL-SEL')","")
		F.Intrinsic.Control.For(V.Local.iCnt,V.DataView.dtPassed!dvPassed.RowCount--,0,-1)
			F.Data.DataView.DeleteRow("dtPassed","dvPassed",V.Local.iCnt)
		F.Intrinsic.Control.Next(V.Local.iCnt)
		
		F.Data.DataView.Close("dtPassed","dvPassed")
		F.Data.DataTable.SaveToXML("dtPassed",0,True,V.Global.sMinorPath)
F.Intrinsic.Control.EndSelect

F.Intrinsic.Control.Catch
	F.Intrinsic.Control.CallSub(Error,"SubRoutine",V.Ambient.CurrentSubroutine,"eNumber",V.Ambient.ErrorNumber,"eDescription",V.Ambient.ErrorDescription)
F.Intrinsic.Control.EndTry
Program.Sub.InitVal.End

Program.Sub.BDFIn.Start
F.Intrinsic.Control.Try
V.Local.sTitle.Declare
V.Local.sData.Declare
V.Local.sDataType.Declare
V.Local.iBDFRowCnt.Declare
V.Local.iCnt.Declare
V.Local.sFullData.Declare

F.Intrinsic.BDF.Load("BDF","AUX001")
F.Intrinsic.BDF.ReadRowCount("BDF",V.Local.iBDFRowCnt)
F.Intrinsic.Math.Sub(V.Local.iBDFRowCnt,1,V.Local.iBDFRowCnt)
F.Intrinsic.BDF.ReadColumnTitle("BDF",V.Local.sTitle)

F.Intrinsic.Control.For(V.Local.iCnt,0,V.Local.iBDFRowCnt,1)
	F.Intrinsic.BDF.ReadRow("BDF",V.Local.iCnt,V.Local.sData)
	F.Intrinsic.String.Replace(V.Local.sData,"|~|","*!*",V.Local.sData)
	F.Intrinsic.Control.If(V.Local.sFullData.Trim,=,"")
		F.Intrinsic.String.Build("{0}",V.Local.sData,V.Local.sFullData)
	F.Intrinsic.Control.Else
		F.Intrinsic.String.Build("{0}{1}{2}",V.Local.sFullData,V.Ambient.NewLine,V.Local.sData,V.Local.sFullData)
	F.Intrinsic.Control.EndIf
F.Intrinsic.Control.Next(V.Local.iCnt)

F.Intrinsic.BDF.ReadColumnDataType("BDF",V.Local.sDataType)

F.Data.DataTable.CreateFromString("dtBDF",V.Local.sFullData,V.Local.sTitle,V.Local.sDataType,"*!*",V.Ambient.NewLine)

F.Data.DataTable.SaveToXML("dtBDF",0,True,V.Global.sMinorPath)

F.Data.DataTable.Close("dtBDF")

F.Intrinsic.Control.Catch
	F.Intrinsic.Control.CallSub(Error,"SubRoutine",V.Ambient.CurrentSubroutine,"eNumber",V.Ambient.ErrorNumber,"eDescription",V.Ambient.ErrorDescription)
F.Intrinsic.Control.EndTry
Program.Sub.BDFIn.End

Program.Sub.BDFOut.Start
F.Intrinsic.Control.Try
V.Local.sTitle.Declare
V.Local.sData.Declare
V.Local.sDataType.Declare
V.Local.iBDFRowCnt.Declare
V.Local.iCnt.Declare
V.Local.sFullData.Declare

F.Intrinsic.Control.If(V.DataTable.dtBDF.Exists)
	F.Data.DataTable.Close("dtBDF")
F.Intrinsic.Control.EndIf

F.Intrinsic.BDF.Load("BDF","AUX001")
F.Intrinsic.BDF.ReadRowCount("BDF",V.Local.iBDFRowCnt)
F.Intrinsic.Math.Sub(V.Local.iBDFRowCnt,1,V.Local.iBDFRowCnt)
F.Intrinsic.BDF.ReadColumnTitle("BDF",V.Local.sTitle)

F.Intrinsic.Control.For(V.Local.iCnt,0,V.Local.iBDFRowCnt,1)
	F.Intrinsic.BDF.ReadRow("BDF",V.Local.iCnt,V.Local.sData)
	F.Intrinsic.String.Replace(V.Local.sData,"|~|","*!*",V.Local.sData)
	F.Intrinsic.Control.If(V.Local.sFullData.Trim,=,"")
		F.Intrinsic.String.Build("{0}",V.Local.sData,V.Local.sFullData)
	F.Intrinsic.Control.Else
		F.Intrinsic.String.Build("{0}{1}{2}",V.Local.sFullData,V.Ambient.NewLine,V.Local.sData,V.Local.sFullData)
	F.Intrinsic.Control.EndIf
F.Intrinsic.Control.Next(V.Local.iCnt)

F.Intrinsic.BDF.ReadColumnDataType("BDF",V.Local.sDataType)

F.Data.DataTable.CreateFromString("dtBDF",V.Local.sFullData,V.Local.sTitle,V.Local.sDataType,"*!*",V.Ambient.NewLine,True)

F.Intrinsic.Control.Catch
	F.Intrinsic.Control.CallSub(Error,"SubRoutine",V.Ambient.CurrentSubroutine,"eNumber",V.Ambient.ErrorNumber,"eDescription",V.Ambient.ErrorDescription)
F.Intrinsic.Control.EndTry
Program.Sub.BDFOut.End

Program.Sub.Compare.Start
F.Intrinsic.Control.Try
V.local.sRet.Declare
V.local.sKey.Declare
V.local.sVal.Declare
V.Local.sVarName.Declare
V.Local.iCnt.Declare
V.Local.iCnt2.Declare
V.Local.sChgDate.Declare
V.Local.sChgTime.Declare
V.Local.sHook.Declare
V.Local.sScreen.Declare
V.Local.sMenuRef.Declare
V.Local.sSQL.Declare
V.Local.sSwitches.Declare
V.Local.sCurVal.Declare
V.Local.sFilter.Declare

F.Intrinsic.String.Format(V.Ambient.Date,"MM/DD/YYYY",V.Local.sChgDate)
F.Intrinsic.String.Format(V.Ambient.Time,"ttttt",V.Local.sChgTime)

F.Intrinsic.Control.If(V.DataTable.dtNewVal.Exists)
	F.Data.DataTable.Close("dtNewVal")
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.If(V.DataTable.dtBDFPrevVal.Exists)
	F.Data.DataTable.Close("dtBDFPrevVal")
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.If(V.DataTable.dtPrevVal.Exists)
	F.Data.DataTable.Close("dtPrevVal")
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.If(V.DataTable.dtAudit.Exists)
	F.Data.DataTable.Close("dtAudit")
F.Intrinsic.Control.EndIf

F.Data.DataTable.Create("dtNewVal",True)
F.Data.DataTable.AddColumn("dtNewVal","Identifier","String")
F.Data.DataTable.AddColumn("dtNewVal","PassedVar","String")
F.Data.DataTable.AddColumn("dtNewVal","VarName","String")
F.Data.DataTable.AddColumn("dtNewVal","VarVal","String")
F.Data.DataTable.AddColumn("dtNewVal","PrevValue","String")

F.Intrinsic.Control.SelectCase(V.Caller.Hook)
	F.Intrinsic.Control.CaseAny(13160)
		F.Intrinsic.Control.CallSub(BDFOut)
		V.Local.sRet.Set(V.DataTable.dtBDF.FieldNames)
		
		F.Intrinsic.String.Split(V.Local.sRet,"*!*",V.Local.sRet)

		F.Intrinsic.Control.For(V.Local.iCnt,0,V.DataTable.dtBDF.RowCount--,1)			
			F.Intrinsic.Control.For(V.Local.iCnt2,V.Local.sRet.LBound,V.Local.sRet.UBound,1)
				F.Intrinsic.Control.If(V.DataTable.dtBDF(V.Local.iCnt).Customer!FieldValTrim,=,"")
					F.Intrinsic.String.Build("{0}-{1}",V.Local.sRet(V.Local.iCnt2),V.DataTable.dtBDF(V.Local.iCnt).Vendor!FieldValTrim,V.Local.sKey)
				F.Intrinsic.Control.Else
					F.Intrinsic.String.Build("{0}-{1}",V.Local.sRet(V.Local.iCnt2),V.DataTable.dtBDF(V.Local.iCnt).Customer!FieldValTrim,V.Local.sKey)
				F.Intrinsic.Control.EndIf
				
				V.Local.sVarName.Set(V.Local.sRet(V.Local.iCnt2))				
				V.local.sVal.Set(V.DataTable.dtBDF(V.Local.iCnt).[V.Local.sVarName]!FieldVal)
				
				F.Intrinsic.String.LTrim(V.Local.sVal,V.Local.sVal)
				F.Intrinsic.String.RTrim(V.Local.sVal,V.Local.sVal)
				F.Intrinsic.String.LTrim(V.Local.sVarName,V.Local.sVarName)
				F.Intrinsic.String.RTrim(V.Local.sVarName,V.Local.sVarName)
				F.Data.DataTable.AddRow("dtNewVal","Identifier",V.Passed.GLOBAL.Trim,"PassedVar",V.Local.sKey,"VarName",V.Local.sVarName,"VarVal",V.Local.sVal)
			F.Intrinsic.Control.Next(V.Local.iCnt2)				
		F.Intrinsic.Control.Next(V.Local.iCnt)
	
	F.Intrinsic.Control.CaseElse
		F.Intrinsic.Variable.ListCallerVars(False,V.local.sRet)
		F.Intrinsic.String.Split(V.Local.sRet,"*!*",V.Local.sRet)

		F.Intrinsic.Control.For(V.Local.iCnt,V.Local.sRet.LBound,V.Local.sRet.UBound,1)
			V.Local.sKey.Set(V.Local.sRet(V.Local.iCnt))
			V.local.sVal.Set(V.Passed.[V.Local.sKey].CurrentVal)
			V.Local.sVarName.Set(V.Passed.[V.Local.sKey].Name)
			
			F.Intrinsic.String.LTrim(V.Local.sVal,V.Local.sVal)
			F.Intrinsic.String.RTrim(V.Local.sVal,V.Local.sVal)
			F.Intrinsic.String.LTrim(V.Local.sVarName,V.Local.sVarName)
			F.Intrinsic.String.RTrim(V.Local.sVarName,V.Local.sVarName)
			F.Data.DataTable.AddRow("dtNewVal","Identifier",V.Passed.GLOBAL.Trim,"PassedVar",V.Local.sKey,"VarName",V.Local.sVarName,"VarVal",V.Local.sVal)
		F.Intrinsic.Control.Next(V.Local.iCnt)
F.Intrinsic.Control.EndSelect

F.Intrinsic.Control.SelectCase(V.Caller.Hook)
	F.Intrinsic.Control.CaseAny(15615,44960,33709)
		V.Local.sSwitches.Set("O")
	F.Intrinsic.Control.Case(15640)
		V.Local.sSwitches.Set("D")
	F.Intrinsic.Control.CaseAny(14461,10125,15600,34110,14468,14471,10180,15660,34105,14470,14475,14385,14386,10185)
		V.Local.sSwitches.Set(V.Caller.Switches)
	F.Intrinsic.Control.CaseAny(56400,42305,13280,10234,44910,14445,56420,14503,42314,13301,10239,44950,42312,13290,10238)
		F.Global.Registry.ReadValue(V.Caller.User,V.Caller.CompanyCode,"GCG_6325_SYS_AUDIT",6325,5150,5,"",V.Local.sSwitches)
F.Intrinsic.Control.EndSelect

F.Intrinsic.Control.SelectCase(V.Local.sSwitches.Trim)
	F.Intrinsic.Control.Case("D")
		F.Data.DataTable.AddColumn("dtNewVal","Changed","Boolean")
		F.Data.DataTable.Select("dtNewVal","PassedVar = 'GLOBAL'",V.Local.sRet)
		F.Data.DataTable.SetValue("dtNewVal",V.Local.sRet,"PrevValue","Identifier deleted","Changed",True)
	
		F.Data.DataTable.Create("dtPrevVal",True)
		F.Data.DataTable.AddColumn("dtPrevVal","Identifier","String")
		F.Data.DataTable.AddColumn("dtPrevVal","PassedVar","String")
		F.Data.DataTable.AddColumn("dtPrevVal","VarName","String")
		F.Data.DataTable.AddColumn("dtPrevVal","VarVal","String")
		F.Data.DataTable.AddColumn("dtPrevVal","PrevValue","String")
		
		F.Data.DataTable.Merge("dtNewVal","dtPrevVal",True,1)
		F.Data.DataTable.DeleteRow("dtNewVal")
	F.Intrinsic.Control.CaseAny("C","N")
		F.Data.DataTable.AddColumn("dtNewVal","Changed","Boolean")
		F.Data.DataTable.Select("dtNewVal","PassedVar = 'GLOBAL'",V.Local.sRet)
		F.Data.DataTable.SetValue("dtNewVal",V.Local.sRet,"PrevValue","Identifier added","Changed",True)
		
		F.Data.DataTable.Create("dtPrevVal",True)
		F.Data.DataTable.AddColumn("dtPrevVal","Identifier","String")
		F.Data.DataTable.AddColumn("dtPrevVal","PassedVar","String")
		F.Data.DataTable.AddColumn("dtPrevVal","VarName","String")
		F.Data.DataTable.AddColumn("dtPrevVal","VarVal","String")
		F.Data.DataTable.AddColumn("dtPrevVal","PrevValue","String")
	F.Intrinsic.Control.Case("O")
		F.Intrinsic.Control.SelectCase(V.Caller.Hook)
			F.Intrinsic.Control.CaseAny(14387,14461,10125,15600,34110,14468,14471,10180,15660,34105,14470,14475,14385,14386,10185,15615,15640,33709)
				F.Data.DataTable.CreateFromXML("dtPrevVal",V.Global.sPath,True)
				F.Data.DataTable.AddColumn("dtPrevVal","PrevValue","String")
				F.Intrinsic.Control.For(V.Local.iCnt,0,V.DataTable.dtPrevVal.RowCount--,1)
					V.Local.sCurVal.Set(V.DataTable.dtPrevVal(V.Local.iCnt).VarVal!FieldValTrim)
					F.Data.DataTable.SetValue("dtPrevVal",V.Local.iCnt,"PrevValue",V.Local.sCurVal)
					F.Data.DataTable.SetValue("dtPrevVal",V.Local.iCnt,"VarVal","")
				F.Intrinsic.Control.Next(V.Local.iCnt)
			F.Intrinsic.Control.CaseAny(14410,56400,42305,13280,10234,44910,14445,56420,14503,42314,13301,10239,44950,42312,13290,10238,44960)
				F.Data.DataTable.CreateFromXML("dtPrevVal",V.Global.sMinorPath,True)
				F.Data.DataTable.AddColumn("dtPrevVal","PrevValue","String")
				F.Intrinsic.Control.For(V.Local.iCnt,0,V.DataTable.dtPrevVal.RowCount--,1)
					V.Local.sCurVal.Set(V.DataTable.dtPrevVal(V.Local.iCnt).VarVal!FieldValTrim)
					F.Data.DataTable.SetValue("dtPrevVal",V.Local.iCnt,"PrevValue",V.Local.sCurVal)
					F.Data.DataTable.SetValue("dtPrevVal",V.Local.iCnt,"VarVal","")
				F.Intrinsic.Control.Next(V.Local.iCnt)
		F.Intrinsic.Control.EndSelect

	F.Intrinsic.Control.Case("")
		F.Intrinsic.Control.SelectCase(V.Caller.Hook)
			F.Intrinsic.Control.CaseAny(13160)
				F.Data.DataTable.Clone("dtNewVal","dtPrevVal",True)

				F.Data.DataTable.CreateFromXML("dtBDFPrevVal",V.Global.sMinorPath,True)
				V.Local.sRet.Set(V.DataTable.dtBDFPrevVal.FieldNames)
		
				F.Intrinsic.String.Split(V.Local.sRet,"*!*",V.Local.sRet)
	
				F.Intrinsic.Control.For(V.Local.iCnt,0,V.DataTable.dtBDFPrevVal.RowCount--,1)			
					F.Intrinsic.Control.For(V.Local.iCnt2,V.Local.sRet.LBound,V.Local.sRet.UBound,1)
						F.Intrinsic.Control.If(V.DataTable.dtBDFPrevVal(V.Local.iCnt).Customer!FieldValTrim,=,"")
							F.Intrinsic.String.Build("{0}-{1}",V.Local.sRet(V.Local.iCnt2),V.DataTable.dtBDFPrevVal(V.Local.iCnt).Vendor!FieldValTrim,V.Local.sKey)
						F.Intrinsic.Control.Else
							F.Intrinsic.String.Build("{0}-{1}",V.Local.sRet(V.Local.iCnt2),V.DataTable.dtBDFPrevVal(V.Local.iCnt).Customer!FieldValTrim,V.Local.sKey)
						F.Intrinsic.Control.EndIf
						V.Local.sVarName.Set(V.Local.sRet(V.Local.iCnt2))				
						V.local.sVal.Set(V.DataTable.dtBDFPrevVal(V.Local.iCnt).[V.Local.sVarName]!FieldVal)
						F.Data.DataTable.AddRow("dtPrevVal","Identifier",V.Passed.GLOBAL.Trim,"PassedVar",V.Local.sKey,"VarName",V.Local.sVarName,"PrevValue",V.Local.sVal)
					F.Intrinsic.Control.Next(V.Local.iCnt2)			
				F.Intrinsic.Control.Next(V.Local.iCnt)
				
				F.Data.DataTable.Close("dtBDFPrevVal")

		F.Intrinsic.Control.EndSelect		
F.Intrinsic.Control.EndSelect

F.Intrinsic.Control.If(V.Caller.Hook,=,"13160")
	F.Data.DataTable.AddColumn("dtNewVal","DT","String","NEW")
	F.Data.DataTable.AddColumn("dtPrevVal","DT","String","OLD")
	
	F.Data.DataTable.Clone("dtPrevVal","dtPassed1",True)
	F.Data.DataTable.Merge("dtNewVal","dtPassed1",True,2)
	F.Data.DataTable.Merge("dtPrevVal","dtPassed1",True,2)
	
	F.Data.DataTable.AddColumn("dtPassed1","DEL_ROW","Boolean",False)
	
	F.Intrinsic.Control.For(V.Local.iCnt,0,V.DataTable.dtPassed1.RowCount--,1)
		F.Intrinsic.String.Build("PassedVar = '{0}'",V.DataTable.dtPassed1(V.Local.iCnt).PassedVar!FieldValStringPSQLFriendly,V.Local.sFilter)
		F.Data.DataView.Create("dtPassed1","dvPassed",22,V.Local.sFilter,"")
		
		F.Intrinsic.Control.If(V.DataView.dtPassed1!dvPassed.RowCount,=,1)
			F.Intrinsic.Control.If(V.DataView.dtPassed1!dvPassed(0).DT!FieldVal,=,"NEW")
				F.Intrinsic.Control.If(V.DataView.dtPassed1!dvPassed(0).VarVal!FieldValTrim,=,"")
					F.Data.DataView.SetValue("dtPassed1","dvPassed",0,"DEL_ROW",True)
				F.Intrinsic.Control.Else
					F.Data.DataView.SetValue("dtPassed1","dvPassed",0,"PrevValue","Added")
				F.Intrinsic.Control.EndIf				
			F.Intrinsic.Control.Else
				F.Intrinsic.Control.If(V.DataView.dtPassed1!dvPassed(0).PrevValue!FieldValTrim,=,"")
					F.Data.DataView.SetValue("dtPassed1","dvPassed",0,"DEL_ROW",True)
				F.Intrinsic.Control.Else
					F.Data.DataView.SetValue("dtPassed1","dvPassed",0,"VarVal","Deleted")
				F.Intrinsic.Control.EndIf				
			F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.ElseIf(V.DataView.dtPassed1!dvPassed.RowCount,>,1)
			F.Intrinsic.Control.If(V.DataView.dtPassed1!dvPassed(0).DT!FieldVal,=,"NEW")
				F.Data.DataView.SetValue("dtPassed1","dvPassed",0,"PrevValue",V.DataView.dtPassed1!dvPassed(1).PrevValue!FieldValTrim)
			F.Intrinsic.Control.Else
				F.Data.DataView.SetValue("dtPassed1","dvPassed",0,"VarVal",V.DataView.dtPassed1!dvPassed(1).VarValue!FieldValTrim)
			F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.EndIf
		F.Data.DataView.Close("dtPassed1","dvPassed")
	F.Intrinsic.Control.Next(V.Local.iCnt)

	F.Data.DataTable.RemoveColumn("dtPassed1","DT")
	F.Data.DataView.Create("dtPassed1","dvPassed",22,"DEL_ROW = False","")	
	F.Data.DataView.ToDataTable("dtPassed1","dvPassed","dtPassed")
	F.Data.DataView.Close("dtPassed1","dvPassed")
	F.Data.DataTable.Close("dtPassed1")
	
	F.Data.DataTable.RemoveColumn("dtPassed","DEL_ROW")
	
F.Intrinsic.Control.Else
	F.Intrinsic.Control.If(V.DataTable.dtPrevVal.RowCount,>=,V.DataTable.dtNewVal.RowCount)
		'Passed variables all match. For BDFs, this would potentially mean that records were deleted.
		F.Data.DataTable.Clone("dtPrevVal","dtPassed",True)
		F.Data.DataTable.Merge("dtPrevVal","dtPassed",True,2)
		F.Data.Dictionary.CreateFromDataTable("dictChgVal","dtNewVal","PassedVar","VarVal")
		F.Data.Dictionary.SetDefaultReturn("dictChgVal","Deleted")
		F.Data.DataTable.FillFromDictionary("dtPassed","dictChgVal","PassedVar","VarVal")
	F.Intrinsic.Control.Else
		'For BDFs, this would potentially mean that records were added.
		F.Data.DataTable.Clone("dtNewVal","dtPassed",True)
		F.Data.DataTable.Merge("dtNewVal","dtPassed",True,2)
		F.Data.Dictionary.CreateFromDataTable("dictChgVal","dtPrevVal","PassedVar","PrevValue")
		F.Data.Dictionary.SetDefaultReturn("dictChgVal","Added")
		F.Data.DataTable.FillFromDictionary("dtPassed","dictChgVal","PassedVar","PrevValue")
	F.Intrinsic.Control.EndIf
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.SelectCase(V.Local.sSwitches.Trim)
	F.Intrinsic.Control.CaseAny("","O")
		F.Data.DataTable.AddExpressionColumn("dtPassed","Changed","Boolean","IIf(VarVal<>PrevValue,True,False)")
	F.Intrinsic.Control.CaseElse		
F.Intrinsic.Control.EndSelect

F.Data.DataTable.Close("dtPrevVal")
F.Data.DataTable.Close("dtNewVal")

F.Data.DataView.Create("dtPassed","dvChanges",22,"Changed=True","")
F.Data.DataView.ToDataTable("dtPassed","dvChanges","dtAudit")
F.Data.DataView.Close("dtPassed","dvChanges")
F.Data.DataTable.Close("dtPassed")

F.Data.DataTable.RemoveColumn("dtAudit","Changed")

F.Data.DataTable.AddColumn("dtAudit","CHG_PGM","String",V.Caller.Caller)
F.Data.Datatable.AddColumn("dtAudit","SCREEN","String")
F.Data.Datatable.AddColumn("dtAudit","MENU_REF","String")
F.Data.DataTable.AddColumn("dtAudit","CHG_USER","String",V.Caller.User)
F.Data.DataTable.AddColumn("dtAudit","CHG_DATE","String",V.Local.sChgDate)
F.Data.DataTable.AddColumn("dtAudit","CHG_TIME","String",V.Local.sChgTime)

F.Intrinsic.Control.For(V.Local.iCnt,0,V.DataTable.dtAudit.RowCount--,1)
	F.Intrinsic.Control.If(V.DataTable.dtAudit(V.Local.iCnt).VarName!FieldValTrim,=,"GLOBAL-VARIABLE")
		F.Data.DataTable.SetValue("dtAudit",V.Local.iCnt,"VarName","Identifier")
	F.Intrinsic.Control.EndIf
F.Intrinsic.Control.Next(V.Local.iCnt)

F.ODBC.Connection!conts.OpenCompanyConnection

F.Intrinsic.String.LPad(V.Caller.Hook,"0",9,V.Local.sHook)

F.Intrinsic.String.Build("Select SCREEN,MENU_REF from HOOK_GLOBAL where ID = '{0}'",V.Local.sHook,V.Local.sSQL)
F.ODBC.Connection!conts.ExecuteAndReturn(V.Local.sSQL,V.Local.sSQL)

F.Intrinsic.String.Split(V.Local.sSQL,"*!*",V.Local.sSQL)

V.Local.sScreen.Set(V.Local.sSQL(0))
V.Local.sMenuRef.Set(V.Local.sSQL(1))

F.Intrinsic.Control.SelectCase(V.Caller.Hook)
	F.Intrinsic.Control.Case(10185)
		F.Intrinsic.Control.If(V.Caller.Switches,=,"O")
			V.Local.sMenuRef.Set("Inventory > File > Inventory Parts > Open")
		F.Intrinsic.Control.ElseIf(V.Caller.Switches,=,"N")
			V.Local.sMenuRef.Set("Inventory > File > Inventory Parts > New")
		F.Intrinsic.Control.Else
			V.Local.sMenuRef.Set("Inventory > File > Inventory Parts > Delete")
		F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.Case(10238)
		V.Local.sMenuRef.Set("Inventory > File > Inventory Parts > Open > Usage")
	F.Intrinsic.Control.Case(15640)
		V.Local.sMenuRef.Set("Inventory > File > Item Masters (Lot/Bin) > Delete")
F.Intrinsic.Control.EndSelect

F.Intrinsic.Control.For(V.Local.iCnt,0,V.DataTable.dtAudit.RowCount--,1)
	F.Intrinsic.Control.If(V.DataTable.dtAudit(V.Local.iCnt).VarName!FieldValTrim,=,"VERSION-77","OR",V.DataTable.dtAudit(V.Local.iCnt).VarName!FieldValTrim,=,"ADDITIONAL-DATA")
		F.Data.DataTable.DeleteRow("dtAudit",V.Local.iCnt)
	F.Intrinsic.Control.ElseIf(V.DataTable.dtAudit(V.Local.iCnt).VarName!FieldValTrim,=,"VERSION")
		F.Data.DataTable.DeleteRow("dtAudit",V.Local.iCnt)
	F.Intrinsic.Control.EndIf
F.Intrinsic.Control.Next(V.Local.iCnt)

F.Data.Datatable.SetValue("dtAudit",-1,"SCREEN",V.Local.sScreen,"MENU_REF",V.Local.sMenuRef)

F.Data.DataTable.SaveToDB("dtAudit","conts","GCG_6325_SYS_AUDIT","",128,"Identifier@!@IDENTIFIER*!*VarName@!@FIELD_NAME*!*PrevValue@!@OLD_VALUE*!*VarVal@!@NEW_VALUE*!*CHG_PGM@!@CHG_PGM*!*SCREEN@!@SCREEN*!*MENU_REF@!@MENU_REF*!*CHG_USER@!@CHG_USER*!*CHG_DATE@!@CHG_DATE*!*CHG_TIME@!@CHG_TIME")

F.Data.DataTable.Close("dtAudit")

F.ODBC.Connection!conts.Close

F.Intrinsic.Control.Catch
	F.Intrinsic.Control.CallSub(Error,"SubRoutine",V.Ambient.CurrentSubroutine,"eNumber",V.Ambient.ErrorNumber,"eDescription",V.Ambient.ErrorDescription)
F.Intrinsic.Control.EndTry
Program.Sub.Compare.End

Program.Sub.USM_IN.Start
F.Intrinsic.Control.Try
V.Local.sSQL.Declare
V.Local.iCnt.Declare
V.Local.sUniqueID.Declare
V.Local.sExpression.Declare
V.Local.sValues.Declare
V.Local.sTempValue.Declare
V.Local.sScreen.Declare
V.Local.sXMLPath.Declare
V.Local.sLinkType.Declare
V.Local.sFileType.Declare
V.Local.iUserId.Declare
V.Local.sIdentifier.Declare
V.Local.sChgDate.Declare
V.Local.sChgTime.Declare
V.Local.sDocCont.Declare
V.Local.sVarName.Declare

F.Intrinsic.String.Format(V.Ambient.Date,"MM/DD/YYYY",V.Local.sChgDate)
F.Intrinsic.String.Format(V.Ambient.Time,"ttttt",V.Local.sChgTime)

F.Intrinsic.Control.If(V.DataTable.dtInitVal.Exists)
	F.Data.DataTable.Close("dtInitVal")
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.SelectCase(V.Caller.Hook)
	'USM Main Screen - Save
	F.Intrinsic.Control.Case(33708)
#Region "33708"
		F.Global.General.FireHook(33714)

		F.Data.DataTable.Create("dtInitVal",True)
		F.Data.DataTable.AddColumn("dtInitVal","IDENTIFIER","String")
		F.Data.DataTable.AddColumn("dtInitVal","VarName","String")
		F.Data.DataTable.AddColumn("dtInitVal","PrevVarVal","String")
		F.Data.DataTable.AddColumn("dtInitVal","MENU_ITEM_PATH","String")
		
		V.Local.sScreen.Set("F_USERINFO")
		
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sXMLPath)
		
		F.Intrinsic.String.Build("Select Cast(A.USER_ID as LongVarChar)+'-'+A.GS_USER as Identifier,A.FIRST_NAME,A.MIDDLE_NAME,A.LAST_NAME,A.EMAIL,A.GS_LANGUAGE_CODE1,A.GS_LANGUAGE_CODE2,A.GS_TERMINAL,A.ENABLED,A.COMPANY,A.COMPANY_SPECIFIC,Cast(A.MENU_TYPE as LongVarChar) as MENU_TYPE,A.AUTO_TRACE,B.GS_CYCLE_START,B.GS_PASSWORD_CYCLE,B.GS_EXPIRATION_DATE,B.GS_EDIT_MENU,Cast(B.USE_WINDOW_LOGON as LongVarChar) as USE_WINDOW_LOGON,B.WINDOW_USER,B.WINDOW_DOMAIN,B.WINDOW_PASSWORD,B.GS_IM,B.GS_CROSS_COMP,B.GS_FORCE_PASS,B.QUERY_BUILDER,C.PASSWORD_HASH from USER_INFORMATION A left join USER_SECURITY B on A.USER_ID = B.USER_ID left join USER_SECURITY_PASS C on A.USER_ID = C.USER_ID where A.GS_USER = '{0}'",V.Passed.UserInfo-txtID,V.Local.sSQL)
		F.ODBC.Connection!comm.OpenCommonConnection
				
		F.Data.DataTable.CreateFromSQL("dtUserSec","comm",V.Local.sSQL)
		F.Data.DataTable.AddColumn("dtUserSec","MENU_ITEM_PATH","String","System Support > File > User Security Maintenance")
		
		F.Data.Dictionary.Create("dictLanguage")
		F.Data.Dictionary.AddItem("dictLanguage","0","000-English")
		F.Data.Dictionary.AddItem("dictLanguage","100","100-Spanish")
		F.Data.Dictionary.AddItem("dictLanguage","200","200-French Canadian")
		F.Data.Dictionary.AddItem("dictLanguage","800","800-Simple Chinese")
		F.Data.Dictionary.AddItem("dictLanguage","899","899-Test Language")
		F.Data.Dictionary.AddItem("dictLanguage","900","900-Bosnian")
		F.Data.Dictionary.AddItem("dictLanguage","901","901-Polish")
		
		F.Data.DataTable.FillFromDictionary("dtUserSec","dictLanguage","GS_LANGUAGE_CODE1")
		
		F.Data.DataTable.FillFromDictionary("dtUserSec","dictLanguage","GS_LANGUAGE_CODE2")
		F.Data.Dictionary.Close("dictLanguage")
		
		F.Data.Dictionary.Create("dictMenuType")
		F.Data.Dictionary.AddItem("dictMenuType","0","Standard")
		F.Data.Dictionary.AddItem("dictMenuType","3","Online Update")
		F.Data.Dictionary.AddItem("dictMenuType","4","Administrator")
		F.Data.Dictionary.AddItem("dictMenuType","5","WirePoll")
		F.Data.Dictionary.AddItem("dictMenuType","6","Polltask")
		F.Data.Dictionary.AddItem("dictMenuType","200","App WCF Client")
		F.Data.Dictionary.AddItem("dictMenuType","250","Data Exporter")
		
		F.Data.DataTable.FillFromDictionary("dtUserSec","dictMenuType","MENU_TYPE")
		F.Data.Dictionary.Close("dictMenuType")
		
		F.Data.Dictionary.Create("dictWindowsLogon")
		F.Data.Dictionary.AddItem("dictWindowsLogon","0","0-Disabled")
		F.Data.Dictionary.AddItem("dictWindowsLogon","1","1-No Password Authentication")
		F.Data.Dictionary.AddItem("dictWindowsLogon","2","2-Validate Windows Password")
		F.Data.Dictionary.AddItem("dictWindowsLogon","3","3-Validate Windows and GSS Password")
		F.Data.Dictionary.AddItem("dictWindowsLogon","4","4-Validate Windows Password (with Username)")
		
		F.Data.DataTable.FillFromDictionary("dtUserSec","dictWindowsLogon","USE_WINDOW_LOGON")
		F.Data.Dictionary.Close("dictWindowsLogon")
		
		V.Local.sValues.Set("FIRST_NAME*!*MIDDLE_NAME*!*LAST_NAME*!*EMAIL*!*GS_LANGUAGE_CODE1*!*GS_LANGUAGE_CODE2*!*GS_TERMINAL*!*ENABLED*!*COMPANY*!*COMPANY_SPECIFIC*!*MENU_TYPE*!*AUTO_TRACE*!*GS_CYCLE_START*!*GS_PASSWORD_CYCLE*!*GS_EXPIRATION_DATE*!*GS_EDIT_MENU*!*USE_WINDOW_LOGON*!*WINDOW_USER*!*WINDOW_DOMAIN*!*WINDOW_PASSWORD*!*GS_IM*!*GS_CROSS_COMP*!*GS_FORCE_PASS*!*QUERY_BUILDER*!*PASSWORD_HASH")

		F.Intrinsic.String.Split(V.Local.sValues, "*!*", V.Local.sValues)
		F.Data.DataView.Create("dtUserSec", "dvUserSec", 22)
		F.Intrinsic.Control.For(V.Local.iCnt, 0, V.Local.sValues.UBound, 1)
		    'get the current value
		    V.Local.sTempValue.Set(V.Local.sValues(V.Local.iCnt))
		    F.Intrinsic.String.Build("Convert([{0}],'System.String')",V.Local.sTempValue,V.Local.sExpression)
		    F.Data.DataTable.AddExpressionColumn("dtUserSec", "PrevVarVal", "String", V.Local.sExpression)
		    'make a seperate datatable with just that data
		    F.Data.DataView.ToDataTableDistinct("dtUserSec", "dvUserSec", "dtTemp", "IDENTIFIER*!*PrevVarVal*!*MENU_ITEM_PATH")
		    F.Data.DataTable.AddColumn("dtTemp", "VarName","String", V.Local.sTempValue)
		    F.Data.DataTable.Merge("dtTemp", "dtInitVal", False, 2)
		    F.Data.DataTable.Close("dtTemp")
		    F.Data.DataTable.RemoveColumn("dtUserSec", "PrevVarVal")
		F.Intrinsic.Control.Next(V.Local.iCnt)
		
		F.ODBC.Connection!comm.Close

		F.ODBC.Connection!conts.OpenCompanyConnection
			F.Intrinsic.String.Build("Select B.GRP_NAME,A.PERMISSION from ATG_DOC_SEC A left join ATG_DOC_GRP B on A.GRP_ID = B.GRP_ID where A.SEC_TYPE = 'U' and A.USR_GRP = '{0}';",V.Passed.UserInfo-txtID,V.Local.sSQL)
			F.ODBC.Connection!conts.ExecuteAndReturn(V.Local.sSQL,V.Local.sSQL)
		F.ODBC.Connection!conts.Close
		
		F.Intrinsic.Control.If(V.Local.sSQL.Trim,<>,"")
			F.Intrinsic.String.Split(V.Local.sSQL,"#$#",V.Local.sSQL)
			F.Intrinsic.Control.For(V.Local.iCnt,V.Local.sSQL.LBound,V.Local.sSQL.UBound,1)
				F.Intrinsic.String.Split(V.Local.sSQL(V.Local.iCnt),"*!*",V.Local.sDocCont)
				F.Intrinsic.String.Build("GRP_NAME_{0}",V.Local.iCnt,V.Local.sVarName)
				F.Intrinsic.String.Build("{0}-DCG-{1}",V.DataTable.dtInitVal(0).IDENTIFIER!FieldValTrim,V.Local.sDocCont(0),V.Local.sUniqueID)
				F.Data.DataTable.AddRow("dtInitVal","IDENTIFIER",V.Local.sUniqueID,"VarName",V.Local.sVarName,"PrevVarVal",V.Local.sDocCont(0),"MENU_ITEM_PATH","System Support > File > User Security Maintenance > Doc Ctrl Grps")
				F.Intrinsic.String.Build("GRP_PERM_{0}",V.Local.iCnt,V.Local.sVarName)
				F.Data.DataTable.AddRow("dtInitVal","IDENTIFIER",V.Local.sUniqueID,"VarName",V.Local.sVarName,"PrevVarVal",V.Local.sDocCont(1),"MENU_ITEM_PATH","System Support > File > User Security Maintenance > Doc Ctrl Grps")
			F.Intrinsic.Control.Next(V.Local.iCnt)
		F.Intrinsic.Control.EndIf
		
		F.Data.DataView.Close("dtUserSec","dvUserSec")
		
		F.Data.DataTable.Close("dtUserSec")
		
		F.Data.DataTable.AddExpressionColumn("dtInitVal","KEY","String","IDENTIFIER+VARNAME")
		
		F.Data.DataTable.SaveToXML("dtInitVal",0,True,V.Local.sXMLPath)
		
		F.Data.DataTable.Close("dtInitVal")
		
		F.Intrinsic.Control.End

#End Region ' 33708
	
	'USM - Permissions
	F.Intrinsic.Control.Case(33714)
#Region "33714"
		F.Data.DataTable.Create("dtInitVal",True)
		F.Data.DataTable.AddColumn("dtInitVal","IDENTIFIER","String")
		F.Data.DataTable.AddColumn("dtInitVal","VarName","String")
		F.Data.DataTable.AddColumn("dtInitVal","PrevVarVal","String")
		F.Data.DataTable.AddColumn("dtInitVal","MENU_ITEM_PATH","String")
		
		V.Local.sScreen.Set("USER_PERMISSIONS")
		
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sXMLPath)
		
		F.ODBC.Connection!conts.OpenCompanyConnection
		F.Intrinsic.String.Build("Select CONVERT(MS.ACCESS_ID, SQL_CHAR)+'-'+UI.GS_USER as IDENTIFIER,MS.ENABLED,MS.RESTRICTED_ACCESS,MS.LEVEL_ID,MS.LEVEL_SEQ from MENU_SECURITY MS left join GLOBALCOMMON.USER_INFORMATION UI on UI.USER_ID = MS.ACCESS_ID where UI.GS_USER = '{0}' and LEVEL_TYPE = '2' order by LEVEL_ID,LEVEL_SEQ;",V.Passed.UserInfo-txtID,V.Local.sSQL)		
		F.Data.DataTable.CreateFromSQL("dtPermissions","conts",V.Local.sSQL)
		F.Data.DataTable.AddExpressionColumn("dtPermissions","NEWKEY","String","LEVEL_ID+'-'+LEVEL_SEQ")
		F.Data.DataTable.AddColumn("dtPermissions","MENU_ITEM_PATH","String")
		
		F.Data.DataTable.CreateFromSQL("dtMenuSelections","conts","Select MSEL.SELECTION_ID,MM.MODULE_ID,MH.HEADER_ID,MSEL.SEQUENCE,MM.MODULE_TITLE,MH.HEADER_TITLE,MSEL.TITLE from MENU_SELECTIONS MSEL left join MENU_HEADERS MH on MSEL.HEADER_ID = MH.HEADER_ID left join MENU_MODULE MM on MH.MODULE_ID = MM.MODULE_ID order by MM.MODULE_ID,MSEL.SELECTION_ID,MSEL.SEQUENCE")

		F.Data.DataTable.AddExpressionColumn("dtMenuSelections","KEY","String","SELECTION_ID+'-'+MODULE_ID+'-'+HEADER_ID")
		F.Data.DataTable.AddColumn("dtMenuSelections","H_TITLE","String")
		F.Data.DataTable.AddExpressionColumn("dtMenuSelections","MENU_PATH","String","IIF(SEQUENCE = 0,MODULE_TITLE+' > '+HEADER_TITLE+' > '+TITLE,MODULE_TITLE+' > '+HEADER_TITLE+' > '+H_TITLE+' > '+TITLE)")
		
		F.Data.DataView.Create("dtMenuSelections","dvMenuHeader",22,"SEQUENCE = 0","")
		F.Data.DataView.ToDataTable("dtMenuSelections","dvMenuHeader","dtMHeader")
		
		F.Data.DataView.Close("dtMenuSelections","dvMenuHeader")
		
		F.Data.Dictionary.CreateFromDataTable("dictMHeader","dtMHeader","KEY","TITLE")
		F.Data.Dictionary.SetDefaultReturn("dictMHeader","")
		F.Data.DataTable.Close("dtMHeader")
		
		F.Data.DataTable.FillFromDictionary("dtMenuSelections","dictMHeader","KEY","H_TITLE")
		F.Data.Dictionary.Close("dictMHeader")
		
		F.Data.Datatable.AddExpressionColumn("dtMenuSelections","NEWKEY","String","SELECTION_ID+'-'+SEQUENCE")
		
		F.Data.Dictionary.CreateFromDataTable("dictFullMenuPath","dtMenuSelections","NEWKEY","MENU_PATH")
		F.Data.DataTable.Close("dtMenuSelections")
		F.Data.Dictionary.SetDefaultReturn("dictFullMenuPath","")
		
		F.Data.DataTable.FillFromDictionary("dtPermissions","dictFullMenuPath","NEWKEY","MENU_ITEM_PATH")
		
		F.ODBC.Connection!conts.Close
		V.Local.sValues.Set("ENABLED*!*RESTRICTED_ACCESS")

		F.Intrinsic.String.Split(V.Local.sValues, "*!*", V.Local.sValues)
		F.Data.DataView.Create("dtPermissions", "dvPermission", 22)
		F.Intrinsic.Control.For(V.Local.iCnt, 0, V.Local.sValues.UBound, 1)
		    'get the current value
		    V.Local.sTempValue.Set(V.Local.sValues(V.Local.iCnt))
		    F.Intrinsic.String.Build("Convert([{0}],'System.String')",V.Local.sTempValue,V.Local.sExpression)
		    F.Data.DataTable.AddExpressionColumn("dtPermissions", "PrevVarVal", "String", V.Local.sExpression)
		    'make a seperate datatable with just that data
		    F.Data.DataView.ToDataTableDistinct("dtPermissions", "dvPermission", "dtTemp", "IDENTIFIER*!*PrevVarVal*!*MENU_ITEM_PATH")
		    F.Data.DataTable.AddColumn("dtTemp", "VarName","String", V.Local.sTempValue)
		    F.Data.DataTable.Merge("dtTemp", "dtInitVal", False, 2)
		    F.Data.DataTable.Close("dtTemp")
		    F.Data.DataTable.RemoveColumn("dtPermissions", "PrevVarVal")
		F.Intrinsic.Control.Next(V.Local.iCnt)
		F.Data.DataView.Close("dtPermissions", "dvPermission")
		
		F.Data.DataTable.AddExpressionColumn("dtInitVal","Key","String","VarName+MENU_ITEM_PATH")
		
		F.Data.DataTable.SaveToXML("dtInitVal",0,True,V.Local.sXMLPath)
		
		F.Intrinsic.Control.End		

#End Region ' 33714
	
	'USM - Link Security
	F.Intrinsic.Control.Case(33716)
#Region "33716"
		F.Intrinsic.String.Left(V.Passed.UserInfo-cboLinkType,2,V.Local.sLinkType)
		F.Intrinsic.String.LPad(V.Local.sLinkType,"0",5,V.Local.sLinkType)

		'V.Passed.UserInfo-txtID
		F.Data.DataTable.Create("dtInitVal",True)
		F.Data.DataTable.AddColumn("dtInitVal","IDENTIFIER","String")
		F.Data.DataTable.AddColumn("dtInitVal","VarName","String")
		F.Data.DataTable.AddColumn("dtInitVal","PrevVarVal","String")
		F.Data.DataTable.AddColumn("dtInitVal","MENU_ITEM_PATH","String")
		
		V.Local.sScreen.Set("U_LINK_SEC")
		
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sXMLPath)
		
		F.Intrinsic.String.Build("Select SECURITY_ID as IDENTIFIER,LINK_TYPE,Cast(PERMISSION as LongVarChar) as PERMISSION from LINK_SECURITY where SECURITY_ID = '{0}' and SECURITY_TYPE = 'U' and LINK_TYPE = '{1}'",V.Passed.UserInfo-txtID,V.Local.sLinkType,V.Local.sSQL)
		F.ODBC.Connection!conts.OpenCompanyConnection
				
		F.Data.DataTable.CreateFromSQL("dtLinkSec","conts",V.Local.sSQL)
		F.Data.DataTable.AddColumn("dtLinkSec","MENU_ITEM_PATH","String","System Support > File > User Security Maintenance > Link Security")
		
		F.Data.Dictionary.Create("dictLnkType")
		F.Data.Dictionary.AddItem("dictLnkType","00000","00-All")
		F.Data.Dictionary.AddItem("dictLnkType","00010","10-Vendor Master")
		F.Data.Dictionary.AddItem("dictLnkType","00011","11-AP Invoice")
		F.Data.Dictionary.AddItem("dictLnkType","00012","12_Contact")
		F.Data.Dictionary.AddItem("dictLnkType","00014","14-AR Cash Check/Ref Number")
		F.Data.Dictionary.AddItem("dictLnkType","00015","15-Customer Master")
		F.Data.Dictionary.AddItem("dictLnkType","00017","17-Ship-To")
		F.Data.Dictionary.AddItem("dictLnkType","00018","18-Prospect")
		
		F.Data.Dictionary.Create("dictPermCode")
		F.Data.Dictionary.AddItem("dictPermCode","10","View Link")
		F.Data.Dictionary.AddItem("dictPermCode","11","View Link/View Comment")
		F.Data.Dictionary.AddItem("dictPermCode","12","View Link/Print Comment")
		F.Data.Dictionary.AddItem("dictPermCode","14","View Link/Save Comment")
		F.Data.Dictionary.AddItem("dictPermCode","20","Print Link")
		F.Data.Dictionary.AddItem("dictPermCode","21","Print Link/View Comment")
		F.Data.Dictionary.AddItem("dictPermCode","22","Print Link/Print Comment")
		F.Data.Dictionary.AddItem("dictPermCode","24","Print Link/Save Comment")
		F.Data.Dictionary.AddItem("dictPermCode","30","Email Link")
		F.Data.Dictionary.AddItem("dictPermCode","31","Email Link/View Comment")
		F.Data.Dictionary.AddItem("dictPermCode","32","Email Link/Print Comment")
		F.Data.Dictionary.AddItem("dictPermCode","34","Email Link/Save Comment")
		F.Data.Dictionary.AddItem("dictPermCode","40","Create/Edit Link")
		F.Data.Dictionary.AddItem("dictPermCode","41","Create/Edit Link/View Comment")
		F.Data.Dictionary.AddItem("dictPermCode","42","Create/Edit Link/Print Comment")
		F.Data.Dictionary.AddItem("dictPermCode","44","Create/Edit Link/Save Comment")
		F.Data.Dictionary.AddItem("dictPermCode","50","Delete Link")
		F.Data.Dictionary.AddItem("dictPermCode","51","Delete Link/View Comment")
		F.Data.Dictionary.AddItem("dictPermCode","52","Delete Link/Print Comment")
		F.Data.Dictionary.AddItem("dictPermCode","54","Delete Link/Save Comment")
		
		F.Data.DataTable.FillFromDictionary("dtLinkSec","dictLnkType","LINK_TYPE")
		F.Data.Dictionary.Close("dictLnkType")
		
		F.Data.DataTable.FillFromDictionary("dtLinkSec","dictPermCode","PERMISSION")
		F.Data.Dictionary.Close("dictPermCode")
		
		F.Data.DataTable.AddExpressionColumn("dtLinkSec","TYPE_PERMISSION","String","LINK_TYPE+'>>'+PERMISSION")
		
		V.Local.sValues.Set("TYPE_PERMISSION")

		F.Intrinsic.String.Split(V.Local.sValues, "*!*", V.Local.sValues)
		F.Data.DataView.Create("dtLinkSec", "dvLinkSec", 22)
		F.Intrinsic.Control.For(V.Local.iCnt, 0, V.Local.sValues.UBound, 1)
		    'get the current value
		    V.Local.sTempValue.Set(V.Local.sValues(V.Local.iCnt))
		    F.Intrinsic.String.Build("Convert([{0}],'System.String')",V.Local.sTempValue,V.Local.sExpression)
		    F.Data.DataTable.AddExpressionColumn("dtLinkSec", "PrevVarVal", "String", V.Local.sExpression)
		    'make a seperate datatable with just that data
		    F.Data.DataView.ToDataTableDistinct("dtLinkSec", "dvLinkSec", "dtTemp", "IDENTIFIER*!*PrevVarVal*!*MENU_ITEM_PATH")
		    F.Data.DataTable.AddColumn("dtTemp", "VarName","String", V.Local.sTempValue)
		    F.Data.DataTable.Merge("dtTemp", "dtInitVal", False, 2)
		    F.Data.DataTable.Close("dtTemp")
		    F.Data.DataTable.RemoveColumn("dtLinkSec", "PrevVarVal")
		F.Intrinsic.Control.Next(V.Local.iCnt)
		
		F.ODBC.Connection!conts.Close
		
		F.Data.DataView.Close("dtLinkSec","dvLinkSec")
		
		F.Data.DataTable.Close("dtLinkSec")
		
		F.Data.DataTable.AddExpressionColumn("dtInitVal","KEY","String","IDENTIFIER+VARNAME")
		
		F.Data.DataTable.SaveToXML("dtInitVal",0,True,V.Local.sXMLPath)
		
		F.Data.DataTable.Close("dtInitVal")
		
		F.Intrinsic.Control.End

#End Region ' 33716
	
	'USM - VMS Security
	F.Intrinsic.Control.Case(33720)
#Region "33720"
		F.Intrinsic.String.Left(V.Passed.UserInfo-cboLinkTypeVMS,2,V.Local.sLinkType.Long)
		F.Intrinsic.String.Left(V.Passed.UserInfo-cboFileTypes,1,V.Local.sFileType.Long)

		F.Data.DataTable.Create("dtInitVal",True)
		F.Data.DataTable.AddColumn("dtInitVal","IDENTIFIER","String")
		F.Data.DataTable.AddColumn("dtInitVal","VarName","String")
		F.Data.DataTable.AddColumn("dtInitVal","PrevVarVal","String")
		F.Data.DataTable.AddColumn("dtInitVal","MENU_ITEM_PATH","String")
		
		V.Local.sScreen.Set("U_VMS_SEC")
		
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sXMLPath)
		
		F.Intrinsic.String.Build("Select Cast(A.SECURITY_ID as LongVarChar)+'-'+B.GS_USER as IDENTIFIER,Cast(A.LINK_TYPE as LongVarChar) as LINK_TYPE,Cast(A.TID as LongVarChar) as FILE_TYPE,Cast(A.PERMISSION as LongVarChar) as PERMISSION from VMS_SECURITY A left join GLOBALCOMMON.USER_INFORMATION B on A.SECURITY_ID = B.USER_ID where B.GS_USER = '{0}' and A.SECURITY_TYPE = '0' and A.LINK_TYPE = '{1}' and A.TID = '{2}'",V.Passed.UserInfo-txtID,V.Local.sLinkType,V.Local.sFileType,V.Local.sSQL)
		F.ODBC.Connection!conts.OpenCompanyConnection
				
		F.Data.DataTable.CreateFromSQL("dtLinkSec","conts",V.Local.sSQL)
		F.Data.DataTable.AddColumn("dtLinkSec","MENU_ITEM_PATH","String","System Support > File > User Security Maintenance > VMS")
		
		F.Data.Dictionary.Create("dictLnkType")
		F.Data.Dictionary.AddItem("dictLnkType","0","00-All")
		F.Data.Dictionary.AddItem("dictLnkType","10","10-Vendor Master")
		F.Data.Dictionary.AddItem("dictLnkType","11","11-AP Invoice")
		F.Data.Dictionary.AddItem("dictLnkType","12","12_Contact")
		F.Data.Dictionary.AddItem("dictLnkType","14","14-AR Cash Check/Ref Number")
		F.Data.Dictionary.AddItem("dictLnkType","15","15-Customer Master")
		F.Data.Dictionary.AddItem("dictLnkType","17","17-Ship-To")
		F.Data.Dictionary.AddItem("dictLnkType","18","18-Prospect")

		F.Data.DataTable.FillFromDictionary("dtLinkSec","dictLnkType","LINK_TYPE")
		F.Data.Dictionary.Close("dictLnkType")
		
		F.Data.Dictionary.Create("dictPerms")
		F.Data.Dictionary.AddItem("dictPerms","0","No Permissions")
		F.Data.Dictionary.AddItem("dictPerms","2","Open View Only Copy")
		F.Data.Dictionary.AddItem("dictPerms","4","See Previous Versions")
		F.Data.Dictionary.AddItem("dictPerms","6","See Prev / View Only")
		F.Data.Dictionary.AddItem("dictPerms","8","Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","10","Check In/Out / View Only")
		F.Data.Dictionary.AddItem("dictPerms","12","See Prev / Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","14","See Prev / Check In/Out / View Only")
		F.Data.Dictionary.AddItem("dictPerms","16","Add to VMS")
		F.Data.Dictionary.AddItem("dictPerms","18","Add to VMS / View Only")
		F.Data.Dictionary.AddItem("dictPerms","20","Add to VMS / See Prev")
		F.Data.Dictionary.AddItem("dictPerms","22","Add to VMS/ See Prev / View Only")
		F.Data.Dictionary.AddItem("dictPerms","24","Add to VMS / Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","26","Add to VMS / Check In/Out / View Only")
		F.Data.Dictionary.AddItem("dictPerms","28","Add to VMS / Check In/Out / See Prev")
		F.Data.Dictionary.AddItem("dictPerms","30","Add to VMS / Check In/Out / See Prev / View Only")
		F.Data.Dictionary.AddItem("dictPerms","32","Remove File")
		F.Data.Dictionary.AddItem("dictPerms","34","Remove File / View Only")
		F.Data.Dictionary.AddItem("dictPerms","36","Remove File / See Prev")
		F.Data.Dictionary.AddItem("dictPerms","38","Remove File / See Prev / View Only")
		F.Data.Dictionary.AddItem("dictPerms","40","Remove File / Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","42","Remove File / Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","44","Remove File / Check In/Out / See Prev")
		F.Data.Dictionary.AddItem("dictPerms","46","Remove File / Check In/Out / See Prev / View Only")
		F.Data.Dictionary.AddItem("dictPerms","48","Remove File / Add to VMS")
		F.Data.Dictionary.AddItem("dictPerms","50","Remove File / Add to VMS / View Only")
		F.Data.Dictionary.AddItem("dictPerms","52","Remove File / Add to VMS / See Prev")
		F.Data.Dictionary.AddItem("dictPerms","54","Remove File / Add to VMS / See Prev / View Only")
		F.Data.Dictionary.AddItem("dictPerms","56","Remove File / Add to VMS / Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","58","Remove File / Add to VMS / Check In/Out / View Only")
		F.Data.Dictionary.AddItem("dictPerms","60","Remove File / Add to VMS / See Prev / Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","62","Remove File / Add to VMS / See Prev / Check In/Out / View Only")
		
		F.Data.DataTable.FillFromDictionary("dtLinkSec","dictPerms","PERMISSION")
		F.Data.Dictionary.Close("dictPerms")
		
		F.Data.Dictionary.CreateFromSQL("dictFileType","conts","Select Cast(TID as LongVarChar) as FILE_TYPE,Cast(TID as LongVarChar)+'-'+EXTENSION+'('+DESCRIPTION+')' from VMS_FILE_TYPE")
		F.Data.Dictionary.AddItem("dictFileType","0","0-All")
				
		F.Data.DataTable.FillFromDictionary("dtLinkSec","dictFileType","FILE_TYPE")
		F.Data.Dictionary.Close("dictFileType")

		F.Data.DataTable.AddExpressionColumn("dtLinkSec","TYPE_PERMISSION","String","LINK_TYPE+' >> '+FILE_TYPE+' >> '+PERMISSION")
		
		V.Local.sValues.Set("TYPE_PERMISSION")

		F.Intrinsic.String.Split(V.Local.sValues, "*!*", V.Local.sValues)
		F.Data.DataView.Create("dtLinkSec", "dvLinkSec", 22)
		F.Intrinsic.Control.For(V.Local.iCnt, 0, V.Local.sValues.UBound, 1)
		    'get the current value
		    V.Local.sTempValue.Set(V.Local.sValues(V.Local.iCnt))
		    F.Intrinsic.String.Build("Convert([{0}],'System.String')",V.Local.sTempValue,V.Local.sExpression)
		    F.Data.DataTable.AddExpressionColumn("dtLinkSec", "PrevVarVal", "String", V.Local.sExpression)
		    'make a seperate datatable with just that data
		    F.Data.DataView.ToDataTableDistinct("dtLinkSec", "dvLinkSec", "dtTemp", "IDENTIFIER*!*PrevVarVal*!*MENU_ITEM_PATH")
		    F.Data.DataTable.AddColumn("dtTemp", "VarName","String", V.Local.sTempValue)
		    F.Data.DataTable.Merge("dtTemp", "dtInitVal", False, 2)
		    F.Data.DataTable.Close("dtTemp")
		    F.Data.DataTable.RemoveColumn("dtLinkSec", "PrevVarVal")
		F.Intrinsic.Control.Next(V.Local.iCnt)
		
		F.Intrinsic.String.Build("Select A.SVAL from GLOBALCOMMON.USER_OPTIONS_COM A left join GLOBALCOMMON.USER_INFORMATION B on A.USER_ID = B.USER_ID where B.GS_USER = '{0}' and A.COMPANY = '{1}' and OPTION_ID = '1000'",V.Passed.UserInfo-txtID,V.Caller.CompanyCode,V.Local.sSQL)
		
		F.ODBC.Connection!conts.ExecuteAndReturn(V.Local.sSQL,V.Local.sSQL)
		
		F.Data.DataTable.AddRow("dtInitVal","IDENTIFIER",V.DataTable.dtInitVal(0).IDENTIFIER!FieldValTrim,"VarName","WORK_DIR","PrevVarVal",V.Local.sSQL.Trim,"MENU_ITEM_PATH","System Support > File > User Security Maintenance > VMS")
		
		F.ODBC.Connection!conts.Close
		
		F.Data.DataView.Close("dtLinkSec","dvLinkSec")
		
		F.Data.DataTable.Close("dtLinkSec")
		
		F.Data.DataTable.AddExpressionColumn("dtInitVal","KEY","String","IDENTIFIER+VARNAME")
		
		F.Data.DataTable.SaveToXML("dtInitVal",0,True,V.Local.sXMLPath)
		
		F.Data.DataTable.Close("dtInitVal")
		
		F.Intrinsic.Control.End

#End Region ' 33720

	'USM - System Groups
	F.Intrinsic.Control.Case(33724)
#Region "33724"
		F.Data.DataTable.Create("dtInitVal",True)
		F.Data.DataTable.AddColumn("dtInitVal","IDENTIFIER","String")
		F.Data.DataTable.AddColumn("dtInitVal","VarName","String")
		F.Data.DataTable.AddColumn("dtInitVal","PrevVarVal","String")
		F.Data.DataTable.AddColumn("dtInitVal","MENU_ITEM_PATH","String")
		
		V.Local.sScreen.Set("U_SYS_GRP")
		
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sXMLPath)
		
		F.Intrinsic.String.Build("Select Cast(A.USER_ID as LongVarChar)+'-'+C.GS_USER+'-'+B.GS_GROUP as IDENTIFIER from MENU_SECURITY_ASSOC A left join USER_GROUPS B on A.GROUP_ID = B.GROUP_ID left join USER_INFORMATION C on A.USER_ID = C.USER_ID where C.GS_USER = '{0}'",V.Passed.UserInfo-txtID,V.Local.sSQL)
		F.ODBC.Connection!comm.OpenCommonConnection
				
		F.Data.DataTable.CreateFromSQL("dtLinkSec","comm",V.Local.sSQL)
		F.Data.DataTable.AddColumn("dtLinkSec","MENU_ITEM_PATH","String","System Support > File > User Security Maintenance > System Groups")
		
		V.Local.sValues.Set("IDENTIFIER")

		F.Intrinsic.String.Split(V.Local.sValues, "*!*", V.Local.sValues)
		F.Data.DataView.Create("dtLinkSec", "dvLinkSec", 22)
		F.Intrinsic.Control.For(V.Local.iCnt, 0, V.Local.sValues.UBound, 1)
		    'get the current value
		    V.Local.sTempValue.Set(V.Local.sValues(V.Local.iCnt))
		    F.Intrinsic.String.Build("Convert([{0}],'System.String')",V.Local.sTempValue,V.Local.sExpression)
		    F.Data.DataTable.AddExpressionColumn("dtLinkSec", "PrevVarVal", "String", V.Local.sExpression)
		    'make a seperate datatable with just that data
		    F.Data.DataView.ToDataTableDistinct("dtLinkSec", "dvLinkSec", "dtTemp", "IDENTIFIER*!*PrevVarVal*!*MENU_ITEM_PATH")
		    F.Data.DataTable.AddColumn("dtTemp", "VarName","String", V.Local.sTempValue)
		    F.Data.DataTable.Merge("dtTemp", "dtInitVal", False, 2)
		    F.Data.DataTable.Close("dtTemp")
		    F.Data.DataTable.RemoveColumn("dtLinkSec", "PrevVarVal")
		F.Intrinsic.Control.Next(V.Local.iCnt)
		
		F.ODBC.Connection!comm.Close
		
		F.Data.DataView.Close("dtLinkSec","dvLinkSec")
		
		F.Data.DataTable.Close("dtLinkSec")
		
		F.Data.DataTable.AddExpressionColumn("dtInitVal","KEY","String","IDENTIFIER+VARNAME")
		
		F.Data.DataTable.SaveToXML("dtInitVal",0,True,V.Local.sXMLPath)
		
		F.Data.DataTable.Close("dtInitVal")
		
		F.Intrinsic.Control.End

#End Region ' 33724

	'USM - Options Populate
	F.Intrinsic.Control.Case(34110)
#Region "34110"
		F.Intrinsic.String.Build("Select USER_ID from USER_INFORMATION where GS_USER = '{0}'",V.Passed.000021,V.Local.sSQL)
		
		F.ODBC.Connection!comm.OpenCommonConnection
			F.ODBC.Connection!comm.ExecuteAndReturn(V.Local.sSQL,V.Local.iUserId)
		F.ODBC.Connection!comm.Close
		
		V.Local.sScreen.Set(V.Passed.SYS050)
		
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sXMLPath)
		
		F.Intrinsic.String.Build("Select Cast('{0}' as LongVarChar)+'-'+ID as IDENTIFIER,Cast(OPTION_ID as LongVarChar)+Cast(SEQ as LongVarChar) as VarName,'Boolean = '+Cast(F_BOOLEAN as LongVarChar)+'  |  Flag = '+Cast(ASCII_FLAG as LongVarChar)+'  |  Text = '+RTRIM(TEXT) as PrevVarVal from USER_OPTIONS where ID = '{1}' order by VarName",V.Local.iUserId,V.Passed.000021,V.Local.sSQL)
		
		F.ODBC.Connection!conts.OpenCompanyConnection
				
		F.Data.DataTable.CreateFromSQL("dtInitVal","conts",V.Local.sSQL)
		F.Data.DataTable.AddColumn("dtInitVal","MENU_ITEM_PATH","String","System Support > File > User Security Maintenance > Options")
		
		F.ODBC.Connection!conts.Close
		
		F.Data.Dictionary.Create("dictVarName")
		F.Data.Dictionary.AddItem("dictVarName","0000010000","User Name")
		F.Data.Dictionary.AddItem("dictVarName","0000020000","Quote Approver")
		F.Data.Dictionary.AddItem("dictVarName","0000030000","Ability to Lock Project Budgets")
		F.Data.Dictionary.AddItem("dictVarName","0000040000","Update Batch")
		F.Data.Dictionary.AddItem("dictVarName","0000050000","Access Batches")
		F.Data.Dictionary.AddItem("dictVarName","0000060000","Payroll Drilldown")
		F.Data.Dictionary.AddItem("dictVarName","0000080000","Show Onhand Qty on Supply & Demand Screen")
		F.Data.Dictionary.AddItem("dictVarName","0000090000","Set Salesperson to User Id on Order Header")
		F.Data.Dictionary.AddItem("dictVarName","0000100000","Show Onhand Qty on Order Lines Screen")
		F.Data.Dictionary.AddItem("dictVarName","0000110000","Show Onhand Qty on MRP Screen")
		F.Data.Dictionary.AddItem("dictVarName","0000120000","Ability to View Credit Cards")
		F.Data.Dictionary.AddItem("dictVarName","0000130000","WO # Prefix")
		F.Data.Dictionary.AddItem("dictVarName","0000140000","Area")
		F.Data.Dictionary.AddItem("dictVarName","0000140001","Loc")
		F.Data.Dictionary.AddItem("dictVarName","0000150000","Use Short Form for Order Entry")
		F.Data.Dictionary.AddItem("dictVarName","0000160000","Shipping Locn/Allow Shipping Override")
		F.Data.Dictionary.AddItem("dictVarName","0000170000","Ability to View Allocations")
		F.Data.Dictionary.AddItem("dictVarName","0000180000","Ability to Override Allocations")
		F.Data.Dictionary.AddItem("dictVarName","0000200000","ACH Payment Access")
		F.Data.Dictionary.AddItem("dictVarName","0000210000","ACH Payment Approver")
		F.Data.Dictionary.AddItem("dictVarName","0000270000","")
		F.Data.Dictionary.AddItem("dictVarName","0000280000","Employee Added")
		F.Data.Dictionary.AddItem("dictVarName","0000300000","Bank Reconciliation")
		F.Data.Dictionary.AddItem("dictVarName","0000310000","AR/GL Update")
		F.Data.Dictionary.AddItem("dictVarName","0000320000","AR Access Batches")
		F.Data.Dictionary.AddItem("dictVarName","0000330000","AP/GL Update")
		F.Data.Dictionary.AddItem("dictVarName","0000340000","AP Access Batches")
		F.Data.Dictionary.AddItem("dictVarName","0000350000","Ability to View Social Security Numbers")
		F.Data.Dictionary.AddItem("dictVarName","0000360000","Ability to View Bank Account Numbers")
		F.Data.Dictionary.AddItem("dictVarName","0000370000","Ability to View Federal ID Numbers")

		F.Data.DataTable.FillFromDictionary("dtInitVal","dictVarName","VarName")
		F.Data.Dictionary.Close("dictVarName")
		
		F.Data.DataTable.AddExpressionColumn("dtInitVal","KEY","String","IDENTIFIER+VARNAME")
	
		F.Data.DataTable.SaveToXML("dtInitVal",0,True,V.Local.sXMLPath)
		
		F.Data.DataTable.Close("dtInitVal")
		
		F.Intrinsic.Control.End

#End Region ' 34110

	'USM - New Terminal
	F.Intrinsic.Control.Case(33732)
#Region "33732"
		F.Intrinsic.Control.If(V.Passed.UserInfo-txtID.Trim,=,"")
			F.Intrinsic.Control.End
		F.Intrinsic.Control.EndIf
		
		F.Intrinsic.String.Build("Select USER_ID from USER_INFORMATION where GS_USER = '{0}'",V.Passed.UserInfo-txtID,V.Local.sSQL)
		
		F.ODBC.Connection!comm.OpenCommonConnection
			F.ODBC.Connection!comm.ExecuteAndReturn(V.Local.sSQL,V.Local.iUserId)
		F.ODBC.Connection!comm.Close
		
		F.Intrinsic.Control.If(V.Local.iUserId,=,0)
			F.Intrinsic.Control.End
		F.Intrinsic.Control.EndIf
				
		F.Global.Registry.AddValue(V.Local.iUserId,V.Caller.CompanyCode,"GCG_6325_SYS_AUDIT",6325,33732,False,"",False,V.Passed.UserInfo-txtTerminal,0.00,"1/1/1900","12:00:00 AM")

#End Region ' 33732

	'USM - Pre Delete.  Post delete hook does not have information.
	F.Intrinsic.Control.Case(33730)
#Region "33730"
		F.Intrinsic.Control.If(V.Passed.UserInfo-txtID.Trim,=,"")
			F.Intrinsic.Control.End
		F.Intrinsic.Control.EndIf
		
		F.Intrinsic.String.Build("Select USER_ID from USER_INFORMATION where GS_USER = '{0}'",V.Passed.UserInfo-txtID,V.Local.sSQL)
		
		F.ODBC.Connection!comm.OpenCommonConnection
			F.ODBC.Connection!comm.ExecuteAndReturn(V.Local.sSQL,V.Local.iUserId)
		F.ODBC.Connection!comm.Close		
		
		F.Data.DataTable.Create("dtAudit")
		F.Data.DataTable.AddColumn("dtAudit","Identifier","String")
		F.Data.DataTable.AddColumn("dtAudit","VarName","String")
		F.Data.DataTable.AddColumn("dtAudit","PrevVarVal","String")
		F.Data.DataTable.AddColumn("dtAudit","NewVarVal","String")
		F.Data.DataTable.AddColumn("dtAudit","MENU_ITEM_PATH","String")
		F.Data.DataTable.AddColumn("dtAudit","CHG_PGM","String")
		F.Data.Datatable.AddColumn("dtAudit","SCREEN","String")
		F.Data.DataTable.AddColumn("dtAudit","CHG_USER","String")
		F.Data.DataTable.AddColumn("dtAudit","CHG_DATE","String")
		F.Data.DataTable.AddColumn("dtAudit","CHG_TIME","String")
		
		F.Intrinsic.String.Build("{0}-{1}",V.Local.iUserId,V.Passed.UserInfo-txtID,V.Local.sIdentifier)
		
		F.Data.DataTable.AddRow("dtAudit","Identifier",V.Local.sIdentifier,"Varname","User Account","PrevVarVal","","NewVarVal","User Deleted","MENU_ITEM_PATH","System Support > File > User Security Maintenance","CHG_PGM","USMMAIN","SCREEN","F_USERINFO","CHG_USER",V.Caller.User,"CHG_DATE",V.Local.sChgDate,"CHG_TIME",V.Local.sChgTime)
		
		F.ODBC.Connection!conts.OpenCompanyConnection
			F.Data.DataTable.SaveToDB("dtAudit","conts","GCG_6325_SYS_AUDIT","",128,"IDENTIFIER@!@IDENTIFIER*!*VarName@!@FIELD_NAME*!*PrevVarVal@!@OLD_VALUE*!*NewVarVal@!@NEW_VALUE*!*CHG_PGM@!@CHG_PGM*!*SCREEN@!@SCREEN*!*MENU_ITEM_PATH@!@MENU_REF*!*CHG_USER@!@CHG_USER*!*CHG_DATE@!@CHG_DATE*!*CHG_TIME@!@CHG_TIME")
		F.ODBC.Connection!conts.Close
		
		F.Data.DataTable.Close("dtAudit")

#End Region ' 33730

F.Intrinsic.Control.EndSelect

F.Intrinsic.Control.Catch
	F.Intrinsic.Control.CallSub(Error,"SubRoutine",V.Ambient.CurrentSubroutine,"eNumber",V.Ambient.ErrorNumber,"eDescription",V.Ambient.ErrorDescription)
F.Intrinsic.Control.EndTry
Program.Sub.USM_IN.End

Program.Sub.USM_OUT.Start
F.Intrinsic.Control.Try
V.Local.sSQL.Declare
V.Local.iCnt.Declare
V.Local.sUniqueID.Declare
V.Local.sExpression.Declare
V.Local.sValues.Declare
V.Local.sTempValue.Declare
V.Local.sScreen.Declare
V.Local.sXMLPath.Declare
V.Local.sChgDate.Declare
V.Local.sChgTime.Declare
V.Local.bDelChk.Declare(Boolean, False)
V.Local.sIdentifier.Declare
V.Local.sLinkType.Declare
V.Local.sFileType.Declare
V.Local.iTerminal.Declare
V.Local.iUserId.Declare
V.Local.sDocCont.Declare
V.Local.sVarName.Declare

F.Intrinsic.String.Format(V.Ambient.Date,"MM/DD/YYYY",V.Local.sChgDate)
F.Intrinsic.String.Format(V.Ambient.Time,"ttttt",V.Local.sChgTime)

F.Intrinsic.Control.SelectCase(V.Caller.Hook)
	'USM - Main Screen
	F.Intrinsic.Control.Case(33709)
#Region "33709"
		F.Global.General.FireHook(33715)
		
		F.Data.DataTable.Create("dtNewVal",True)
		F.Data.DataTable.AddColumn("dtNewVal","IDENTIFIER","String")
		F.Data.DataTable.AddColumn("dtNewVal","VarName","String")
		F.Data.DataTable.AddColumn("dtNewVal","NewVarVal","String")
		F.Data.DataTable.AddColumn("dtNewVal","MENU_ITEM_PATH","String")
		
		F.Intrinsic.String.Build("Select Cast(A.USER_ID as LongVarChar)+'-'+A.GS_USER as Identifier,A.FIRST_NAME,A.MIDDLE_NAME,A.LAST_NAME,A.EMAIL,A.GS_LANGUAGE_CODE1,A.GS_LANGUAGE_CODE2,A.GS_TERMINAL,A.ENABLED,A.COMPANY,A.COMPANY_SPECIFIC,Cast(A.MENU_TYPE as LongVarChar) as MENU_TYPE,A.AUTO_TRACE,B.GS_CYCLE_START,B.GS_PASSWORD_CYCLE,B.GS_EXPIRATION_DATE,B.GS_EDIT_MENU,Cast(B.USE_WINDOW_LOGON as LongVarChar) as USE_WINDOW_LOGON,B.WINDOW_USER,B.WINDOW_DOMAIN,B.WINDOW_PASSWORD,B.GS_IM,B.GS_CROSS_COMP,B.GS_FORCE_PASS,B.QUERY_BUILDER,C.PASSWORD_HASH from USER_INFORMATION A left join USER_SECURITY B on A.USER_ID = B.USER_ID left join USER_SECURITY_PASS C on A.USER_ID = C.USER_ID where A.GS_USER = '{0}'",V.Passed.UserInfo-txtID.UCase,V.Local.sSQL)
		F.ODBC.Connection!comm.OpenCommonConnection
				
		F.Data.DataTable.CreateFromSQL("dtPermissions","comm",V.Local.sSQL)
		F.Data.DataTable.AddColumn("dtPermissions","MENU_ITEM_PATH","String","System Support > File > User Security Maintenance")
		
		F.ODBC.Connection!comm.Close
		
		F.Data.Dictionary.Create("dictLanguage")
		F.Data.Dictionary.AddItem("dictLanguage","0","000-English")
		F.Data.Dictionary.AddItem("dictLanguage","100","100-Spanish")
		F.Data.Dictionary.AddItem("dictLanguage","200","200-French Canadian")
		F.Data.Dictionary.AddItem("dictLanguage","800","800-Simple Chinese")
		F.Data.Dictionary.AddItem("dictLanguage","899","899-Test Language")
		F.Data.Dictionary.AddItem("dictLanguage","900","900-Bosnian")
		F.Data.Dictionary.AddItem("dictLanguage","901","901-Polish")
		
		F.Data.DataTable.FillFromDictionary("dtPermissions","dictLanguage","GS_LANGUAGE_CODE1")
		
		F.Data.DataTable.FillFromDictionary("dtPermissions","dictLanguage","GS_LANGUAGE_CODE2")
		F.Data.Dictionary.Close("dictLanguage")
		
		F.Data.Dictionary.Create("dictMenuType")
		F.Data.Dictionary.AddItem("dictMenuType","0","Standard")
		F.Data.Dictionary.AddItem("dictMenuType","3","Online Update")
		F.Data.Dictionary.AddItem("dictMenuType","4","Administrator")
		F.Data.Dictionary.AddItem("dictMenuType","5","WirePoll")
		F.Data.Dictionary.AddItem("dictMenuType","6","Polltask")
		F.Data.Dictionary.AddItem("dictMenuType","200","App WCF Client")
		F.Data.Dictionary.AddItem("dictMenuType","250","Data Exporter")
		
		F.Data.DataTable.FillFromDictionary("dtPermissions","dictMenuType","MENU_TYPE")
		F.Data.Dictionary.Close("dictMenuType")
		
		F.Data.Dictionary.Create("dictWindowsLogon")
		F.Data.Dictionary.AddItem("dictWindowsLogon","0","0-Disabled")
		F.Data.Dictionary.AddItem("dictWindowsLogon","1","1-No Password Authentication")
		F.Data.Dictionary.AddItem("dictWindowsLogon","2","2-Validate Windows Password")
		F.Data.Dictionary.AddItem("dictWindowsLogon","3","3-Validate Windows and GSS Password")
		F.Data.Dictionary.AddItem("dictWindowsLogon","4","4-Validate Windows Password (with Username)")
		
		F.Data.DataTable.FillFromDictionary("dtPermissions","dictWindowsLogon","USE_WINDOW_LOGON")
		F.Data.Dictionary.Close("dictWindowsLogon")
		
		V.Local.sValues.Set("FIRST_NAME*!*MIDDLE_NAME*!*LAST_NAME*!*EMAIL*!*GS_LANGUAGE_CODE1*!*GS_LANGUAGE_CODE2*!*GS_TERMINAL*!*ENABLED*!*COMPANY*!*COMPANY_SPECIFIC*!*MENU_TYPE*!*AUTO_TRACE*!*GS_CYCLE_START*!*GS_PASSWORD_CYCLE*!*GS_EXPIRATION_DATE*!*GS_EDIT_MENU*!*USE_WINDOW_LOGON*!*WINDOW_USER*!*WINDOW_DOMAIN*!*WINDOW_PASSWORD*!*GS_IM*!*GS_CROSS_COMP*!*GS_FORCE_PASS*!*QUERY_BUILDER*!*PASSWORD_HASH")

		F.Intrinsic.String.Split(V.Local.sValues, "*!*", V.Local.sValues)
		F.Data.DataView.Create("dtPermissions", "dvPermission", 22)
		F.Intrinsic.Control.For(V.Local.iCnt, 0, V.Local.sValues.UBound, 1)
		    'get the current value
		    V.Local.sTempValue.Set(V.Local.sValues(V.Local.iCnt))
		    F.Intrinsic.String.Build("Convert([{0}],'System.String')",V.Local.sTempValue,V.Local.sExpression)
		    F.Data.DataTable.AddExpressionColumn("dtPermissions", "NewVarVal", "String", V.Local.sExpression)
		    'make a seperate datatable with just that data
		    F.Data.DataView.ToDataTableDistinct("dtPermissions", "dvPermission", "dtTemp", "IDENTIFIER*!*NewVarVal*!*MENU_ITEM_PATH")
		    F.Data.DataTable.AddColumn("dtTemp", "VarName","String", V.Local.sTempValue)
		    F.Data.DataTable.Merge("dtTemp", "dtNewVal", False, 2)
		    F.Data.DataTable.Close("dtTemp")
		    F.Data.DataTable.RemoveColumn("dtPermissions", "NewVarVal")
		F.Intrinsic.Control.Next(V.Local.iCnt)
		
		F.Data.DataView.Close("dtPermissions","dvPermission")
		
		F.Data.DataTable.Close("dtPermissions")
		
		F.ODBC.Connection!conts.OpenCompanyConnection
			F.Intrinsic.String.Build("Select B.GRP_NAME,A.PERMISSION from ATG_DOC_SEC A left join ATG_DOC_GRP B on A.GRP_ID = B.GRP_ID where A.SEC_TYPE = 'U' and A.USR_GRP = '{0}';",V.Passed.UserInfo-txtID,V.Local.sSQL)
			F.ODBC.Connection!conts.ExecuteAndReturn(V.Local.sSQL,V.Local.sSQL)
		F.ODBC.Connection!conts.Close
		
		F.Intrinsic.Control.If(V.Local.sSQL.Trim,<>,"")
			F.Intrinsic.String.Split(V.Local.sSQL,"#$#",V.Local.sSQL)
			F.Intrinsic.Control.For(V.Local.iCnt,V.Local.sSQL.LBound,V.Local.sSQL.UBound,1)
				F.Intrinsic.String.Split(V.Local.sSQL(V.Local.iCnt),"*!*",V.Local.sDocCont)
				F.Intrinsic.String.Build("GRP_NAME_{0}",V.Local.iCnt,V.Local.sVarName)
				F.Intrinsic.String.Build("{0}-DCG-{1}",V.DataTable.dtNewVal(0).IDENTIFIER!FieldValTrim,V.Local.sDocCont(0),V.Local.sUniqueID)
				
				F.Data.DataTable.AddRow("dtNewVal","IDENTIFIER",V.Local.sUniqueID,"VarName",V.Local.sVarName,"NewVarVal",V.Local.sDocCont(0),"MENU_ITEM_PATH","System Support > File > User Security Maintenance > Doc Ctrl Grps")
				F.Intrinsic.String.Build("GRP_PERM_{0}",V.Local.iCnt,V.Local.sVarName)
				F.Data.DataTable.AddRow("dtNewVal","IDENTIFIER",V.Local.sUniqueID,"VarName",V.Local.sVarName,"NewVarVal",V.Local.sDocCont(1),"MENU_ITEM_PATH","System Support > File > User Security Maintenance > Doc Ctrl Grps")
			F.Intrinsic.Control.Next(V.Local.iCnt)
		F.Intrinsic.Control.EndIf
		
		F.Data.DataTable.AddExpressionColumn("dtNewVal","KEY","String","IDENTIFIER+VARNAME")
		F.Data.DataTable.AddColumn("dtNewVal","PrevVarVal","String")
		
		V.Local.sScreen.Set("F_USERINFO")
		
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sXMLPath)
		F.Data.DataTable.CreateFromXML("dtPrevVal",V.Local.sXMLPath,True)
				
		F.Intrinsic.Control.If(V.DataTable.dtPrevVal.RowCount,>,V.DataTable.dtNewVal.RowCount)
			'All permissions were removed
			F.Data.DataTable.Clone("dtPrevVal","dtPassed",True)
			F.Data.DataTable.Merge("dtPrevVal","dtPassed",True,2)
			F.Data.DataTable.AddColumn("dtPassed","NewVarVal","String","User Deleted")
		F.Intrinsic.Control.ElseIf(V.DataTable.dtPrevVal.RowCount,<,V.DataTable.dtNewVal.RowCount)
			'New link permissions were added
			F.Data.DataTable.Clone("dtNewVal","dtPassed",True)
			F.Data.DataTable.Merge("dtNewVal","dtPassed",True,2)
			'F.Data.DataTable.SetValueFormat("dtPassed",-1,"NewVarVal","PrevVarVal","")
			'F.Data.DataTable.SetValue("dtPassed",-1,"PrevVarVal","User Added")
			F.Data.Dictionary.CreateFromDataTable("dictChgVal","dtPrevVal","KEY","PrevVarVal")
			F.Data.Dictionary.SetDefaultReturn("dictChgVal","Added")
			F.Data.DataTable.FillFromDictionary("dtPassed","dictChgVal","KEY","PrevVarVal")
		F.Intrinsic.Control.Else
			'Permissions were changed
			F.Data.DataTable.Clone("dtNewVal","dtPassed",True)
			F.Data.DataTable.Merge("dtNewVal","dtPassed",True,2)
			F.Data.Dictionary.CreateFromDataTable("dictChgVal","dtPrevVal","KEY","PrevVarVal")
			F.Data.Dictionary.SetDefaultReturn("dictChgVal","Added")
			F.Data.DataTable.FillFromDictionary("dtPassed","dictChgVal","KEY","PrevVarVal")
		F.Intrinsic.Control.EndIf
		
		F.Data.DataTable.Close("dtPrevVal")
		F.Data.DataTable.Close("dtNewVal")
		
		F.Data.DataTable.AddExpressionColumn("dtPassed","Changed","Boolean","IIf([NewVarVal]<>[PrevVarVal],True,False)")
		
		F.Data.DataView.Create("dtPassed","dvChangedVal",22,"Changed = 'True'","")
		
		F.Data.DataView.ToDataTable("dtPassed","dvChangedVal","dtAudit")
		F.Data.DataTable.AddColumn("dtAudit","CHG_PGM","String","USMMAIN")
		F.Data.Datatable.AddColumn("dtAudit","SCREEN","String",V.Local.sScreen)
		F.Data.DataTable.AddColumn("dtAudit","CHG_USER","String",V.Caller.User)
		F.Data.DataTable.AddColumn("dtAudit","CHG_DATE","String",V.Local.sChgDate)
		F.Data.DataTable.AddColumn("dtAudit","CHG_TIME","String",V.Local.sChgTime)
		
		F.Data.DataView.Close("dtPassed","dvChangedVal")
		F.Data.DataTable.Close("dtPassed")
		
		F.Data.Datatable.RemoveColumn("dtAudit","Key")
		F.Data.Datatable.RemoveColumn("dtAudit","Changed")
		
		F.Intrinsic.Control.For(V.Local.iCnt,0,V.DataTable.dtAudit.RowCount--,1)
			F.Intrinsic.Control.If(V.DataTable.dtAudit(V.Local.iCnt).VarName!FieldValTrim,=,"PASSWORD_HASH")
				F.Data.DataTable.SetValue("dtAudit",V.Local.iCnt,"PrevVarVal","Protected","NewVarVal","Password was changed")
			F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.Next(V.Local.iCnt)

		F.ODBC.Connection!conts.OpenCompanyConnection

		F.Data.DataTable.SaveToDB("dtAudit","conts","GCG_6325_SYS_AUDIT","",128,"IDENTIFIER@!@IDENTIFIER*!*VarName@!@FIELD_NAME*!*PrevVarVal@!@OLD_VALUE*!*NewVarVal@!@NEW_VALUE*!*CHG_PGM@!@CHG_PGM*!*SCREEN@!@SCREEN*!*MENU_ITEM_PATH@!@MENU_REF*!*CHG_USER@!@CHG_USER*!*CHG_DATE@!@CHG_DATE*!*CHG_TIME@!@CHG_TIME")
		
		F.Data.DataTable.Close("dtAudit")
		
		F.ODBC.Connection!conts.Close
		
		F.Intrinsic.File.DeleteFile(V.Local.sXMLPath)
		
		F.Intrinsic.Control.End

#End Region ' 33709
	
	'USM - Permissions
	F.Intrinsic.Control.Case(33715)
#Region "33715"

		F.Data.DataTable.Create("dtNewVal",True)
		F.Data.DataTable.AddColumn("dtNewVal","IDENTIFIER","String")
		F.Data.DataTable.AddColumn("dtNewVal","VarName","String")
		F.Data.DataTable.AddColumn("dtNewVal","NewVarVal","String")
		F.Data.DataTable.AddColumn("dtNewVal","MENU_ITEM_PATH","String")
		
		F.ODBC.Connection!conts.OpenCompanyConnection
		F.Intrinsic.String.Build("Select CONVERT(MS.ACCESS_ID, SQL_CHAR)+'-'+UI.GS_USER as IDENTIFIER,MS.ENABLED,MS.RESTRICTED_ACCESS,MS.LEVEL_ID,MS.LEVEL_SEQ from MENU_SECURITY MS left join GLOBALCOMMON.USER_INFORMATION UI on UI.USER_ID = MS.ACCESS_ID where UI.GS_USER = '{0}' and LEVEL_TYPE = '2' order by LEVEL_ID,LEVEL_SEQ;",V.Passed.UserInfo-txtID,V.Local.sSQL)		
		F.Data.DataTable.CreateFromSQL("dtPermissions","conts",V.Local.sSQL)
		F.Data.DataTable.AddExpressionColumn("dtPermissions","NEWKEY","String","LEVEL_ID+'-'+LEVEL_SEQ")
		F.Data.DataTable.AddColumn("dtPermissions","MENU_ITEM_PATH","String")
		
		F.Data.DataTable.CreateFromSQL("dtMenuSelections","conts","Select MSEL.SELECTION_ID,MM.MODULE_ID,MH.HEADER_ID,MSEL.SEQUENCE,MM.MODULE_TITLE,MH.HEADER_TITLE,MSEL.TITLE from MENU_SELECTIONS MSEL left join MENU_HEADERS MH on MSEL.HEADER_ID = MH.HEADER_ID left join MENU_MODULE MM on MH.MODULE_ID = MM.MODULE_ID order by MM.MODULE_ID,MSEL.SELECTION_ID,MSEL.SEQUENCE")

		F.Data.DataTable.AddExpressionColumn("dtMenuSelections","KEY","String","SELECTION_ID+'-'+MODULE_ID+'-'+HEADER_ID")
		F.Data.DataTable.AddColumn("dtMenuSelections","H_TITLE","String")
		F.Data.DataTable.AddExpressionColumn("dtMenuSelections","MENU_PATH","String","IIF(SEQUENCE = 0,MODULE_TITLE+' > '+HEADER_TITLE+' > '+TITLE,MODULE_TITLE+' > '+HEADER_TITLE+' > '+H_TITLE+' > '+TITLE)")
		
		F.Data.DataView.Create("dtMenuSelections","dvMenuHeader",22,"SEQUENCE = 0","")
		F.Data.DataView.ToDataTable("dtMenuSelections","dvMenuHeader","dtMHeader")
		
		F.Data.DataView.Close("dtMenuSelections","dvMenuHeader")
		
		F.Data.Dictionary.CreateFromDataTable("dictMHeader","dtMHeader","KEY","TITLE")
		F.Data.Dictionary.SetDefaultReturn("dictMHeader","")
		F.Data.DataTable.Close("dtMHeader")
		
		F.Data.DataTable.FillFromDictionary("dtMenuSelections","dictMHeader","KEY","H_TITLE")
		F.Data.Dictionary.Close("dictMHeader")
		
		F.Data.Datatable.AddExpressionColumn("dtMenuSelections","NEWKEY","String","SELECTION_ID+'-'+SEQUENCE")
		
		F.Data.Dictionary.CreateFromDataTable("dictFullMenuPath","dtMenuSelections","NEWKEY","MENU_PATH")
		F.Data.DataTable.Close("dtMenuSelections")
		F.Data.Dictionary.SetDefaultReturn("dictFullMenuPath","")
		
		F.Data.DataTable.FillFromDictionary("dtPermissions","dictFullMenuPath","NEWKEY","MENU_ITEM_PATH")

		V.Local.sValues.Set("ENABLED*!*RESTRICTED_ACCESS")

		F.Intrinsic.String.Split(V.Local.sValues, "*!*", V.Local.sValues)
		F.Data.DataView.Create("dtPermissions", "dvPermission", 22)
		F.Intrinsic.Control.For(V.Local.iCnt, 0, V.Local.sValues.UBound, 1)
		    'get the current value
		    V.Local.sTempValue.Set(V.Local.sValues(V.Local.iCnt))
		    F.Intrinsic.String.Build("Convert([{0}],'System.String')",V.Local.sTempValue,V.Local.sExpression)
		    F.Data.DataTable.AddExpressionColumn("dtPermissions","NewVarVal","String",V.Local.sExpression)
		    'make a seperate datatable with just that data
		    F.Data.DataView.ToDataTableDistinct("dtPermissions","dvPermission","dtTemp","IDENTIFIER*!*NewVarVal*!*MENU_ITEM_PATH")
		    F.Data.DataTable.AddColumn("dtTemp", "VarName","String", V.Local.sTempValue)
		    F.Data.DataTable.Merge("dtTemp", "dtNewVal", False, 2)
		    F.Data.DataTable.Close("dtTemp")
		    F.Data.DataTable.RemoveColumn("dtPermissions","NewVarVal")
		F.Intrinsic.Control.Next(V.Local.iCnt)
		F.Data.DataView.Close("dtPermissions", "dvPermission")
		
		F.Data.DataTable.AddExpressionColumn("dtNewVal","Key","String","VarName+MENU_ITEM_PATH")
		F.Data.DataTable.AddColumn("dtNewVal","PrevVarVal","String")
		
		V.Local.sScreen.Set("USER_PERMISSIONS")
				
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sXMLPath)
		
		F.Data.DataTable.CreateFromXML("dtPrevVal",V.Local.sXMLPath,True)
		
		F.Intrinsic.Control.If(V.DataTable.dtPrevVal.RowCount,>,V.DataTable.dtNewVal.RowCount)
			'Variables all match. This could potentially mean that records were deleted.
			F.Data.DataTable.Clone("dtPrevVal","dtPassed",True)
			F.Data.DataTable.Merge("dtPrevVal","dtPassed",True,2)
			F.Data.DataTable.AddColumn("dtPassed","NewVarVal","String")
			F.Data.Dictionary.CreateFromDataTable("dictChgVal","dtNewVal","KEY","NewVarVal")
			F.Data.Dictionary.SetDefaultReturn("dictChgVal","Deleted")
			F.Data.DataTable.FillFromDictionary("dtPassed","dictChgVal","KEY","NewVarVal")
			V.Local.bDelChk.Set(True)
		F.Intrinsic.Control.ElseIf(V.DataTable.dtPrevVal.RowCount,<=,V.DataTable.dtNewVal.RowCount)
			'This could potentially mean that records were added.
			F.Data.DataTable.Clone("dtNewVal","dtPassed",True)
			F.Data.DataTable.Merge("dtNewVal","dtPassed",True,2)
			F.Data.Dictionary.CreateFromDataTable("dictChgVal","dtPrevVal","KEY","PrevVarVal")
			F.Data.Dictionary.SetDefaultReturn("dictChgVal","Added")
			F.Data.DataTable.FillFromDictionary("dtPassed","dictChgVal","KEY","PrevVarVal")
		F.Intrinsic.Control.EndIf
		
		F.Data.DataTable.AddExpressionColumn("dtPassed","Changed","Boolean","IIf(NewVarVal<>PrevVarVal,True,False)")
		
		F.Data.DataView.Create("dtPassed","dvChangedVal",22,"Changed = 'True'","")
		
		F.Intrinsic.Control.If(V.DataView.dtPassed!dvChangedVal.RowCount,=,0)
			F.ODBC.Connection!conts.Close
			F.Intrinsic.Control.End
		F.Intrinsic.Control.EndIf

		F.Data.DataView.ToDataTable("dtPassed","dvChangedVal","dtAudit")
		F.Data.DataTable.AddColumn("dtAudit","CHG_PGM","String","USMPERMS")
		F.Data.Datatable.AddColumn("dtAudit","SCREEN","String",V.Local.sScreen)
		F.Data.DataTable.AddColumn("dtAudit","CHG_USER","String",V.Caller.User)
		F.Data.DataTable.AddColumn("dtAudit","CHG_DATE","String",V.Local.sChgDate)
		F.Data.DataTable.AddColumn("dtAudit","CHG_TIME","String",V.Local.sChgTime)
		
		F.Data.Datatable.RemoveColumn("dtAudit","Key")
		F.Data.Datatable.RemoveColumn("dtAudit","Changed")

		F.Data.DataTable.SaveToDB("dtAudit","conts","GCG_6325_SYS_AUDIT","",128,"IDENTIFIER@!@IDENTIFIER*!*VarName@!@FIELD_NAME*!*PrevVarVal@!@OLD_VALUE*!*NewVarVal@!@NEW_VALUE*!*CHG_PGM@!@CHG_PGM*!*SCREEN@!@SCREEN*!*MENU_ITEM_PATH@!@MENU_REF*!*CHG_USER@!@CHG_USER*!*CHG_DATE@!@CHG_DATE*!*CHG_TIME@!@CHG_TIME")
		
		F.ODBC.Connection!conts.Close

		F.Data.DataTable.Close("dtAudit")
		
		F.Intrinsic.File.DeleteFile(V.Local.sXMLPath)
		
		F.Intrinsic.Control.End
		
#End Region ' 33715

	'USM - Link Security
	F.Intrinsic.Control.Case(33717)
#Region "33717"
		F.Intrinsic.String.Left(V.Passed.UserInfo-cboLinkType,2,V.Local.sLinkType)
		F.Intrinsic.String.LPad(V.Local.sLinkType,"0",5,V.Local.sLinkType)
		
		F.Data.DataTable.Create("dtNewVal",True)
		F.Data.DataTable.AddColumn("dtNewVal","IDENTIFIER","String")
		F.Data.DataTable.AddColumn("dtNewVal","VarName","String")
		F.Data.DataTable.AddColumn("dtNewVal","NewVarVal","String")
		F.Data.DataTable.AddColumn("dtNewVal","MENU_ITEM_PATH","String")

		F.ODBC.Connection!conts.OpenCompanyConnection
		F.Intrinsic.String.Build("Select SECURITY_ID as IDENTIFIER,LINK_TYPE,Cast(PERMISSION as LongVarChar) as PERMISSION from LINK_SECURITY where SECURITY_ID = '{0}' and SECURITY_TYPE = 'U' and LINK_TYPE = '{1}'",V.Passed.UserInfo-txtID,V.Local.sLinkType,V.Local.sSQL)		
		F.Data.DataTable.CreateFromSQL("dtPermissions","conts",V.Local.sSQL)
		
		F.Data.DataTable.AddColumn("dtPermissions","MENU_ITEM_PATH","String","System Support > File > User Security Maintenance > Link Security")
		
		F.Data.Dictionary.Create("dictLnkType")
		F.Data.Dictionary.AddItem("dictLnkType","00000","00-All")
		F.Data.Dictionary.AddItem("dictLnkType","00010","10-Vendor Master")
		F.Data.Dictionary.AddItem("dictLnkType","00011","11-AP Invoice")
		F.Data.Dictionary.AddItem("dictLnkType","00012","12_Contact")
		F.Data.Dictionary.AddItem("dictLnkType","00014","14-AR Cash Check/Ref Number")
		F.Data.Dictionary.AddItem("dictLnkType","00015","15-Customer Master")
		F.Data.Dictionary.AddItem("dictLnkType","00017","17-Ship-To")
		F.Data.Dictionary.AddItem("dictLnkType","00018","18-Prospect")
		
		F.Data.Dictionary.Create("dictPermCode")
		F.Data.Dictionary.AddItem("dictPermCode","10","View Link")
		F.Data.Dictionary.AddItem("dictPermCode","11","View Link/View Comment")
		F.Data.Dictionary.AddItem("dictPermCode","12","View Link/Print Comment")
		F.Data.Dictionary.AddItem("dictPermCode","14","View Link/Save Comment")
		F.Data.Dictionary.AddItem("dictPermCode","20","Print Link")
		F.Data.Dictionary.AddItem("dictPermCode","21","Print Link/View Comment")
		F.Data.Dictionary.AddItem("dictPermCode","22","Print Link/Print Comment")
		F.Data.Dictionary.AddItem("dictPermCode","24","Print Link/Save Comment")
		F.Data.Dictionary.AddItem("dictPermCode","30","Email Link")
		F.Data.Dictionary.AddItem("dictPermCode","31","Email Link/View Comment")
		F.Data.Dictionary.AddItem("dictPermCode","32","Email Link/Print Comment")
		F.Data.Dictionary.AddItem("dictPermCode","34","Email Link/Save Comment")
		F.Data.Dictionary.AddItem("dictPermCode","40","Create/Edit Link")
		F.Data.Dictionary.AddItem("dictPermCode","41","Create/Edit Link/View Comment")
		F.Data.Dictionary.AddItem("dictPermCode","42","Create/Edit Link/Print Comment")
		F.Data.Dictionary.AddItem("dictPermCode","44","Create/Edit Link/Save Comment")
		F.Data.Dictionary.AddItem("dictPermCode","50","Delete Link")
		F.Data.Dictionary.AddItem("dictPermCode","51","Delete Link/View Comment")
		F.Data.Dictionary.AddItem("dictPermCode","52","Delete Link/Print Comment")
		F.Data.Dictionary.AddItem("dictPermCode","54","Delete Link/Save Comment")
		
		F.Data.DataTable.FillFromDictionary("dtPermissions","dictLnkType","LINK_TYPE")
		F.Data.Dictionary.Close("dictLnkType")
		
		F.Data.DataTable.FillFromDictionary("dtPermissions","dictPermCode","PERMISSION")
		F.Data.Dictionary.Close("dictPermCode")
		
		F.Data.DataTable.AddExpressionColumn("dtPermissions","TYPE_PERMISSION","String","LINK_TYPE+'>>'+PERMISSION")
		
		V.Local.sValues.Set("TYPE_PERMISSION")

		F.Intrinsic.String.Split(V.Local.sValues, "*!*", V.Local.sValues)
		F.Data.DataView.Create("dtPermissions", "dvPermission", 22)
		F.Intrinsic.Control.For(V.Local.iCnt, 0, V.Local.sValues.UBound, 1)
		    'get the current value
		    V.Local.sTempValue.Set(V.Local.sValues(V.Local.iCnt))
		    F.Intrinsic.String.Build("Convert([{0}],'System.String')",V.Local.sTempValue,V.Local.sExpression)
		    F.Data.DataTable.AddExpressionColumn("dtPermissions", "NewVarVal", "String", V.Local.sExpression)
		    'make a seperate datatable with just that data
		    F.Data.DataView.ToDataTableDistinct("dtPermissions", "dvPermission", "dtTemp", "IDENTIFIER*!*NewVarVal*!*MENU_ITEM_PATH")
		    F.Data.DataTable.AddColumn("dtTemp", "VarName","String", V.Local.sTempValue)
		    F.Data.DataTable.Merge("dtTemp", "dtNewVal", False, 2)
		    F.Data.DataTable.Close("dtTemp")
		    F.Data.DataTable.RemoveColumn("dtPermissions", "NewVarVal")
		F.Intrinsic.Control.Next(V.Local.iCnt)
		
		F.Data.DataView.Close("dtPermissions","dvPermission")
		
		F.Data.DataTable.Close("dtPermissions")
		
		F.Data.DataTable.AddExpressionColumn("dtNewVal","KEY","String","IDENTIFIER+VARNAME")
		F.Data.DataTable.AddColumn("dtNewVal","PrevVarVal","String")
		
		V.Local.sScreen.Set("U_LINK_SEC")
		
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sXMLPath)
		F.Data.DataTable.CreateFromXML("dtPrevVal",V.Local.sXMLPath,True)
				
		F.Intrinsic.Control.If(V.DataTable.dtPrevVal.RowCount,>,V.DataTable.dtNewVal.RowCount)
			'All permissions were removed
			F.Data.DataTable.Clone("dtPrevVal","dtPassed",True)
			F.Data.DataTable.Merge("dtPrevVal","dtPassed",True,2)
			F.Data.DataTable.AddColumn("dtPassed","NewVarVal","String","Permissions Deleted")
		F.Intrinsic.Control.ElseIf(V.DataTable.dtPrevVal.RowCount,<,V.DataTable.dtNewVal.RowCount)
			'New link permissions were added
			F.Data.DataTable.Clone("dtNewVal","dtPassed",True)
			F.Data.DataTable.Merge("dtNewVal","dtPassed",True,2)
			'F.Data.DataTable.SetValueFormat("dtPassed",-1,"NewVarVal","PrevVarVal","")
			F.Data.DataTable.SetValue("dtPassed",-1,"PrevVarVal","Permissions Added")
		F.Intrinsic.Control.Else
			'Permissions were changed
			F.Data.DataTable.Clone("dtNewVal","dtPassed",True)
			F.Data.DataTable.Merge("dtNewVal","dtPassed",True,2)
			F.Data.Dictionary.CreateFromDataTable("dictChgVal","dtPrevVal","KEY","PrevVarVal")
			F.Data.Dictionary.SetDefaultReturn("dictChgVal","Added")
			F.Data.DataTable.FillFromDictionary("dtPassed","dictChgVal","KEY","PrevVarVal")
		F.Intrinsic.Control.EndIf
		
		F.Data.DataTable.Close("dtPrevVal")
		F.Data.DataTable.Close("dtNewVal")
		
		F.Data.DataTable.AddExpressionColumn("dtPassed","Changed","Boolean","IIf([NewVarVal]<>[PrevVarVal],True,False)")
		
		F.Data.DataView.Create("dtPassed","dvChangedVal",22,"Changed = 'True'","")
		
		F.Data.DataView.ToDataTable("dtPassed","dvChangedVal","dtAudit")
		F.Data.DataTable.AddColumn("dtAudit","CHG_PGM","String","USMLNKS")
		F.Data.Datatable.AddColumn("dtAudit","SCREEN","String",V.Local.sScreen)
		F.Data.DataTable.AddColumn("dtAudit","CHG_USER","String",V.Caller.User)
		F.Data.DataTable.AddColumn("dtAudit","CHG_DATE","String",V.Local.sChgDate)
		F.Data.DataTable.AddColumn("dtAudit","CHG_TIME","String",V.Local.sChgTime)
		
		F.Data.Datatable.RemoveColumn("dtAudit","Key")
		F.Data.Datatable.RemoveColumn("dtAudit","Changed")

		F.Data.DataTable.SaveToDB("dtAudit","conts","GCG_6325_SYS_AUDIT","",128,"IDENTIFIER@!@IDENTIFIER*!*VarName@!@FIELD_NAME*!*PrevVarVal@!@OLD_VALUE*!*NewVarVal@!@NEW_VALUE*!*CHG_PGM@!@CHG_PGM*!*SCREEN@!@SCREEN*!*MENU_ITEM_PATH@!@MENU_REF*!*CHG_USER@!@CHG_USER*!*CHG_DATE@!@CHG_DATE*!*CHG_TIME@!@CHG_TIME")
		
		F.Data.DataView.Close("dtPassed","dvChangedVal")
		F.Data.DataTable.Close("dtPassed")
		
		F.Data.DataTable.Close("dtAudit")
		
		F.ODBC.Connection!conts.Close
		
		F.Intrinsic.File.DeleteFile(V.Local.sXMLPath)
		
		F.Intrinsic.Control.End
#End Region ' 33717

	'USM - VMS Security
	F.Intrinsic.Control.Case(33721)
#Region "33721"
		F.Intrinsic.String.Left(V.Passed.UserInfo-cboLinkTypeVMS,2,V.Local.sLinkType.Long)
		F.Intrinsic.String.Left(V.Passed.UserInfo-cboFileTypes,1,V.Local.sFileType.Long)
		
		F.Intrinsic.Control.If(V.Local.sLinkType.Trim,=,"","OR",V.Local.sFileType.Trim,=,"")
			F.Intrinsic.Control.End
		F.Intrinsic.Control.EndIf
		
		F.Data.DataTable.Create("dtNewVal",True)
		F.Data.DataTable.AddColumn("dtNewVal","IDENTIFIER","String")
		F.Data.DataTable.AddColumn("dtNewVal","VarName","String")
		F.Data.DataTable.AddColumn("dtNewVal","NewVarVal","String")
		F.Data.DataTable.AddColumn("dtNewVal","MENU_ITEM_PATH","String")

		F.ODBC.Connection!conts.OpenCompanyConnection
		F.Intrinsic.String.Build("Select Cast(A.SECURITY_ID as LongVarChar)+'-'+B.GS_USER as IDENTIFIER,Cast(A.LINK_TYPE as LongVarChar) as LINK_TYPE,Cast(A.TID as LongVarChar) as FILE_TYPE,Cast(A.PERMISSION as LongVarChar) as PERMISSION from VMS_SECURITY A left join GLOBALCOMMON.USER_INFORMATION B on A.SECURITY_ID = B.USER_ID where B.GS_USER = '{0}' and A.SECURITY_TYPE = '0' and A.LINK_TYPE = '{1}' and A.TID = '{2}'",V.Passed.UserInfo-txtID,V.Local.sLinkType,V.Local.sFileType,V.Local.sSQL)		
		F.Data.DataTable.CreateFromSQL("dtPermissions","conts",V.Local.sSQL)
		
		F.Data.DataTable.AddColumn("dtPermissions","MENU_ITEM_PATH","String","System Support > File > User Security Maintenance > VMS")
		
		F.Data.Dictionary.Create("dictLnkType")
		F.Data.Dictionary.AddItem("dictLnkType","0","00-All")
		F.Data.Dictionary.AddItem("dictLnkType","10","10-Vendor Master")
		F.Data.Dictionary.AddItem("dictLnkType","11","11-AP Invoice")
		F.Data.Dictionary.AddItem("dictLnkType","12","12_Contact")
		F.Data.Dictionary.AddItem("dictLnkType","14","14-AR Cash Check/Ref Number")
		F.Data.Dictionary.AddItem("dictLnkType","15","15-Customer Master")
		F.Data.Dictionary.AddItem("dictLnkType","17","17-Ship-To")
		F.Data.Dictionary.AddItem("dictLnkType","18","18-Prospect")
		
		F.Data.DataTable.FillFromDictionary("dtPermissions","dictLnkType","LINK_TYPE")
		F.Data.Dictionary.Close("dictLnkType")
		
		F.Data.Dictionary.Create("dictPerms")
		F.Data.Dictionary.AddItem("dictPerms","0","No Permissions")
		F.Data.Dictionary.AddItem("dictPerms","2","Open View Only Copy")
		F.Data.Dictionary.AddItem("dictPerms","4","See Previous Versions")
		F.Data.Dictionary.AddItem("dictPerms","6","See Prev / View Only")
		F.Data.Dictionary.AddItem("dictPerms","8","Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","10","Check In/Out / View Only")
		F.Data.Dictionary.AddItem("dictPerms","12","See Prev / Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","14","See Prev / Check In/Out / View Only")
		F.Data.Dictionary.AddItem("dictPerms","16","Add to VMS")
		F.Data.Dictionary.AddItem("dictPerms","18","Add to VMS / View Only")
		F.Data.Dictionary.AddItem("dictPerms","20","Add to VMS / See Prev")
		F.Data.Dictionary.AddItem("dictPerms","22","Add to VMS/ See Prev / View Only")
		F.Data.Dictionary.AddItem("dictPerms","24","Add to VMS / Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","26","Add to VMS / Check In/Out / View Only")
		F.Data.Dictionary.AddItem("dictPerms","28","Add to VMS / Check In/Out / See Prev")
		F.Data.Dictionary.AddItem("dictPerms","30","Add to VMS / Check In/Out / See Prev / View Only")
		F.Data.Dictionary.AddItem("dictPerms","32","Remove File")
		F.Data.Dictionary.AddItem("dictPerms","34","Remove File / View Only")
		F.Data.Dictionary.AddItem("dictPerms","36","Remove File / See Prev")
		F.Data.Dictionary.AddItem("dictPerms","38","Remove File / See Prev / View Only")
		F.Data.Dictionary.AddItem("dictPerms","40","Remove File / Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","42","Remove File / Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","44","Remove File / Check In/Out / See Prev")
		F.Data.Dictionary.AddItem("dictPerms","46","Remove File / Check In/Out / See Prev / View Only")
		F.Data.Dictionary.AddItem("dictPerms","48","Remove File / Add to VMS")
		F.Data.Dictionary.AddItem("dictPerms","50","Remove File / Add to VMS / View Only")
		F.Data.Dictionary.AddItem("dictPerms","52","Remove File / Add to VMS / See Prev")
		F.Data.Dictionary.AddItem("dictPerms","54","Remove File / Add to VMS / See Prev / View Only")
		F.Data.Dictionary.AddItem("dictPerms","56","Remove File / Add to VMS / Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","58","Remove File / Add to VMS / Check In/Out / View Only")
		F.Data.Dictionary.AddItem("dictPerms","60","Remove File / Add to VMS / See Prev / Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","62","Remove File / Add to VMS / See Prev / Check In/Out / View Only")
		
		F.Data.DataTable.FillFromDictionary("dtPermissions","dictPerms","PERMISSION")
		F.Data.Dictionary.Close("dictPerms")
		
		F.Data.Dictionary.CreateFromSQL("dictFileType","conts","Select Cast(TID as LongVarChar) as FILE_TYPE,Cast(TID as LongVarChar)+'-'+EXTENSION+'('+DESCRIPTION+')' from VMS_FILE_TYPE")
		F.Data.Dictionary.AddItem("dictFileType","0","0-All")
				
		F.Data.DataTable.FillFromDictionary("dtPermissions","dictFileType","FILE_TYPE")
		F.Data.Dictionary.Close("dictFileType")
		
		F.Data.DataTable.AddExpressionColumn("dtPermissions","TYPE_PERMISSION","String","LINK_TYPE+' >> '+FILE_TYPE+' >> '+PERMISSION")
		
		V.Local.sValues.Set("TYPE_PERMISSION")

		F.Intrinsic.String.Split(V.Local.sValues, "*!*", V.Local.sValues)
		F.Data.DataView.Create("dtPermissions", "dvPermission", 22)
		F.Intrinsic.Control.For(V.Local.iCnt, 0, V.Local.sValues.UBound, 1)
		    'get the current value
		    V.Local.sTempValue.Set(V.Local.sValues(V.Local.iCnt))
		    F.Intrinsic.String.Build("Convert([{0}],'System.String')",V.Local.sTempValue,V.Local.sExpression)
		    F.Data.DataTable.AddExpressionColumn("dtPermissions", "NewVarVal", "String", V.Local.sExpression)
		    'make a seperate datatable with just that data
		    F.Data.DataView.ToDataTableDistinct("dtPermissions", "dvPermission", "dtTemp", "IDENTIFIER*!*NewVarVal*!*MENU_ITEM_PATH")
		    F.Data.DataTable.AddColumn("dtTemp", "VarName","String", V.Local.sTempValue)
		    F.Data.DataTable.Merge("dtTemp", "dtNewVal", False, 2)
		    F.Data.DataTable.Close("dtTemp")
		    F.Data.DataTable.RemoveColumn("dtPermissions", "NewVarVal")
		F.Intrinsic.Control.Next(V.Local.iCnt)
		
		F.Data.DataTable.AddExpressionColumn("dtNewVal","KEY","String","IDENTIFIER+VARNAME")
		F.Data.DataTable.AddColumn("dtNewVal","PrevVarVal","String")
		
		F.Intrinsic.String.Build("Select A.SVAL from GLOBALCOMMON.USER_OPTIONS_COM A left join GLOBALCOMMON.USER_INFORMATION B on A.USER_ID = B.USER_ID where B.GS_USER = '{0}' and A.COMPANY = '{1}' and OPTION_ID = '1000'",V.Passed.UserInfo-txtID,V.Caller.CompanyCode,V.Local.sSQL)
		
		F.ODBC.Connection!conts.ExecuteAndReturn(V.Local.sSQL,V.Local.sSQL)
		
		F.Data.DataTable.AddRow("dtNewVal","IDENTIFIER",V.DataTable.dtNewVal(0).IDENTIFIER!FieldValTrim,"VarName","WORK_DIR","NewVarVal",V.Local.sSQL.Trim,"MENU_ITEM_PATH","System Support > File > User Security Maintenance > VMS")
		
		F.Data.DataView.Close("dtPermissions","dvPermission")
		
		F.Data.DataTable.Close("dtPermissions")
		
		V.Local.sScreen.Set("U_VMS_SEC")
		
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sXMLPath)
		F.Data.DataTable.CreateFromXML("dtPrevVal",V.Local.sXMLPath,True)
				
		F.Intrinsic.Control.If(V.DataTable.dtPrevVal.RowCount,>,V.DataTable.dtNewVal.RowCount)
			'All permissions were removed
			F.Data.DataTable.Clone("dtPrevVal","dtPassed",True)
			F.Data.DataTable.Merge("dtPrevVal","dtPassed",True,2)
			F.Data.DataTable.AddColumn("dtPassed","NewVarVal","String","Permissions Deleted")
		F.Intrinsic.Control.ElseIf(V.DataTable.dtPrevVal.RowCount,<,V.DataTable.dtNewVal.RowCount)
			'New link permissions were added
			F.Data.DataTable.Clone("dtNewVal","dtPassed",True)
			F.Data.DataTable.Merge("dtNewVal","dtPassed",True,2)
			'F.Data.DataTable.SetValueFormat("dtPassed",-1,"NewVarVal","PrevVarVal","")
			F.Data.DataTable.SetValue("dtPassed",-1,"PrevVarVal","Permissions Added")
		F.Intrinsic.Control.Else
			'Permissions were changed
			F.Data.DataTable.Clone("dtNewVal","dtPassed",True)
			F.Data.DataTable.Merge("dtNewVal","dtPassed",True,2)
			F.Data.Dictionary.CreateFromDataTable("dictChgVal","dtPrevVal","KEY","PrevVarVal")
			F.Data.Dictionary.SetDefaultReturn("dictChgVal","Added")
			F.Data.DataTable.FillFromDictionary("dtPassed","dictChgVal","KEY","PrevVarVal")
		F.Intrinsic.Control.EndIf
		
		F.Data.DataTable.Close("dtPrevVal")
		F.Data.DataTable.Close("dtNewVal")
		
		F.Data.DataTable.AddExpressionColumn("dtPassed","Changed","Boolean","IIf([NewVarVal]<>[PrevVarVal],True,False)")
		
		F.Data.DataView.Create("dtPassed","dvChangedVal",22,"Changed = 'True'","")
		
		F.Data.DataView.ToDataTable("dtPassed","dvChangedVal","dtAudit")
		F.Data.DataTable.AddColumn("dtAudit","CHG_PGM","String","USMVMS")
		F.Data.Datatable.AddColumn("dtAudit","SCREEN","String",V.Local.sScreen)
		F.Data.DataTable.AddColumn("dtAudit","CHG_USER","String",V.Caller.User)
		F.Data.DataTable.AddColumn("dtAudit","CHG_DATE","String",V.Local.sChgDate)
		F.Data.DataTable.AddColumn("dtAudit","CHG_TIME","String",V.Local.sChgTime)
		
		F.Data.Datatable.RemoveColumn("dtAudit","Key")
		F.Data.Datatable.RemoveColumn("dtAudit","Changed")

		F.Data.DataTable.SaveToDB("dtAudit","conts","GCG_6325_SYS_AUDIT","",128,"IDENTIFIER@!@IDENTIFIER*!*VarName@!@FIELD_NAME*!*PrevVarVal@!@OLD_VALUE*!*NewVarVal@!@NEW_VALUE*!*CHG_PGM@!@CHG_PGM*!*SCREEN@!@SCREEN*!*MENU_ITEM_PATH@!@MENU_REF*!*CHG_USER@!@CHG_USER*!*CHG_DATE@!@CHG_DATE*!*CHG_TIME@!@CHG_TIME")
		
		F.Data.DataView.Close("dtPassed","dvChangedVal")
		F.Data.DataTable.Close("dtPassed")
		
		F.Data.DataTable.Close("dtAudit")
		
		F.ODBC.Connection!conts.Close
		
		F.Intrinsic.File.DeleteFile(V.Local.sXMLPath)
		
		F.Intrinsic.Control.End	

#End Region ' 33721
	
	'System Support > File > User Security by Menu Item - Permissions Added
	F.Intrinsic.Control.Case(56761)
#Region "56761"
		F.ODBC.Connection!comm.OpenCommonConnection
		F.Intrinsic.String.Build("Select Convert(USER_ID,SQL_CHAR)+'-'+GS_USER from USER_INFORMATION where USER_ID = '{0}'",V.Passed.USERID,V.Local.sSQL)
		F.ODBC.Connection!comm.ExecuteAndReturn(V.Local.sSQL,V.Local.sIdentifier)
		F.ODBC.Connection!comm.Close
		
		F.Data.DataTable.Create("dtAudit")
		F.Data.DataTable.AddColumn("dtAudit","Identifier","String")
		F.Data.DataTable.AddColumn("dtAudit","VarName","String")
		F.Data.DataTable.AddColumn("dtAudit","PrevVarVal","String")
		F.Data.DataTable.AddColumn("dtAudit","NewVarVal","String")
		F.Data.DataTable.AddColumn("dtAudit","MENU_ITEM_PATH","String")
		F.Data.DataTable.AddColumn("dtAudit","CHG_PGM","String")
		F.Data.Datatable.AddColumn("dtAudit","SCREEN","String")
		F.Data.DataTable.AddColumn("dtAudit","CHG_USER","String")
		F.Data.DataTable.AddColumn("dtAudit","CHG_DATE","String")
		F.Data.DataTable.AddColumn("dtAudit","CHG_TIME","String")
		
		F.Intrinsic.String.Build("ENABLED - {0}",V.Passed.MENUPATH,V.Local.sValues)
		
		F.Data.DataTable.AddRow("dtAudit","Identifier",V.Local.sIdentifier,"Varname",V.Local.sValues,"PrevVarVal","False","NewVarVal","True","MENU_ITEM_PATH","System Support > File > User Security by Menu Item","CHG_PGM","USBMIDB","SCREEN","USR_SEC_BY_MENU_ITM","CHG_USER",V.Caller.User,"CHG_DATE",V.Local.sChgDate,"CHG_TIME",V.Local.sChgTime)
		
		F.ODBC.Connection!conts.OpenCompanyConnection
		F.Data.DataTable.SaveToDB("dtAudit","conts","GCG_6325_SYS_AUDIT","",128,"IDENTIFIER@!@IDENTIFIER*!*VarName@!@FIELD_NAME*!*PrevVarVal@!@OLD_VALUE*!*NewVarVal@!@NEW_VALUE*!*CHG_PGM@!@CHG_PGM*!*SCREEN@!@SCREEN*!*MENU_ITEM_PATH@!@MENU_REF*!*CHG_USER@!@CHG_USER*!*CHG_DATE@!@CHG_DATE*!*CHG_TIME@!@CHG_TIME")
		F.ODBC.Connection!conts.Close
		F.Data.DataTable.Close("dtAudit")
		F.Intrinsic.Control.End
#End Region ' 56761

	'System Support > File > User Security by Menu Item - Permissions Removed
	F.Intrinsic.Control.Case(56763)
#Region "56763"
		F.ODBC.Connection!comm.OpenCommonConnection
		F.Intrinsic.String.Build("Select Convert(USER_ID,SQL_CHAR)+'-'+GS_USER from USER_INFORMATION where USER_ID = '{0}'",V.Passed.USERID,V.Local.sSQL)
		F.ODBC.Connection!comm.ExecuteAndReturn(V.Local.sSQL,V.Local.sIdentifier)
		F.ODBC.Connection!comm.Close
		
		F.Data.DataTable.Create("dtAudit")
		F.Data.DataTable.AddColumn("dtAudit","Identifier","String")
		F.Data.DataTable.AddColumn("dtAudit","VarName","String")
		F.Data.DataTable.AddColumn("dtAudit","PrevVarVal","String")
		F.Data.DataTable.AddColumn("dtAudit","NewVarVal","String")
		F.Data.DataTable.AddColumn("dtAudit","MENU_ITEM_PATH","String")
		F.Data.DataTable.AddColumn("dtAudit","CHG_PGM","String")
		F.Data.Datatable.AddColumn("dtAudit","SCREEN","String")
		F.Data.DataTable.AddColumn("dtAudit","CHG_USER","String")
		F.Data.DataTable.AddColumn("dtAudit","CHG_DATE","String")
		F.Data.DataTable.AddColumn("dtAudit","CHG_TIME","String")
		
		F.Intrinsic.String.Build("ENABLED - {0}",V.Passed.MENUPATH,V.Local.sValues)
		
		F.Data.DataTable.AddRow("dtAudit","Identifier",V.Local.sIdentifier,"Varname",V.Local.sValues,"PrevVarVal","True","NewVarVal","False","MENU_ITEM_PATH","System Support > File > User Security by Menu Item","CHG_PGM","USBMIDB","SCREEN","USR_SEC_BY_MENU_ITM","CHG_USER",V.Caller.User,"CHG_DATE",V.Local.sChgDate,"CHG_TIME",V.Local.sChgTime)
		
		F.ODBC.Connection!conts.OpenCompanyConnection
		F.Data.DataTable.SaveToDB("dtAudit","conts","GCG_6325_SYS_AUDIT","",128,"IDENTIFIER@!@IDENTIFIER*!*VarName@!@FIELD_NAME*!*PrevVarVal@!@OLD_VALUE*!*NewVarVal@!@NEW_VALUE*!*CHG_PGM@!@CHG_PGM*!*SCREEN@!@SCREEN*!*MENU_ITEM_PATH@!@MENU_REF*!*CHG_USER@!@CHG_USER*!*CHG_DATE@!@CHG_DATE*!*CHG_TIME@!@CHG_TIME")
		F.ODBC.Connection!conts.Close
		F.Data.DataTable.Close("dtAudit")
		F.Intrinsic.Control.End
		
#End Region ' 56763

	'USM - System Groups
	F.Intrinsic.Control.Case(33725)
#Region "33725"
		F.Data.DataTable.Create("dtNewVal",True)
		F.Data.DataTable.AddColumn("dtNewVal","IDENTIFIER","String")
		F.Data.DataTable.AddColumn("dtNewVal","VarName","String")
		F.Data.DataTable.AddColumn("dtNewVal","NewVarVal","String")
		F.Data.DataTable.AddColumn("dtNewVal","MENU_ITEM_PATH","String")

		F.Intrinsic.String.Build("Select Cast(A.USER_ID as LongVarChar)+'-'+C.GS_USER+'-'+B.GS_GROUP as IDENTIFIER from MENU_SECURITY_ASSOC A left join USER_GROUPS B on A.GROUP_ID = B.GROUP_ID left join USER_INFORMATION C on A.USER_ID = C.USER_ID where C.GS_USER = '{0}'",V.Passed.UserInfo-txtID,V.Local.sSQL)
		F.ODBC.Connection!comm.OpenCommonConnection
				
		F.Data.DataTable.CreateFromSQL("dtPermissions","comm",V.Local.sSQL)
		F.Data.DataTable.AddColumn("dtPermissions","MENU_ITEM_PATH","String","System Support > File > User Security Maintenance > System Groups")
		
		V.Local.sValues.Set("IDENTIFIER")

		F.Intrinsic.String.Split(V.Local.sValues, "*!*", V.Local.sValues)
		F.Data.DataView.Create("dtPermissions", "dvPermission", 22)
		F.Intrinsic.Control.For(V.Local.iCnt, 0, V.Local.sValues.UBound, 1)
		    'get the current value
		    V.Local.sTempValue.Set(V.Local.sValues(V.Local.iCnt))
		    F.Intrinsic.String.Build("Convert([{0}],'System.String')",V.Local.sTempValue,V.Local.sExpression)
		    F.Data.DataTable.AddExpressionColumn("dtPermissions", "NewVarVal", "String", V.Local.sExpression)
		    'make a seperate datatable with just that data
		    F.Data.DataView.ToDataTableDistinct("dtPermissions", "dvPermission", "dtTemp", "IDENTIFIER*!*NewVarVal*!*MENU_ITEM_PATH")
		    F.Data.DataTable.AddColumn("dtTemp", "VarName","String", V.Local.sTempValue)
		    F.Data.DataTable.Merge("dtTemp", "dtNewVal", False, 2)
		    F.Data.DataTable.Close("dtTemp")
		    F.Data.DataTable.RemoveColumn("dtPermissions", "NewVarVal")
		F.Intrinsic.Control.Next(V.Local.iCnt)
		
		F.Data.DataTable.AddExpressionColumn("dtNewVal","KEY","String","IDENTIFIER+VARNAME")
		F.Data.DataTable.AddColumn("dtNewVal","PrevVarVal","String")
		
		F.Data.DataView.Close("dtPermissions","dvPermission")
		
		F.Data.DataTable.Close("dtPermissions")
		
		V.Local.sScreen.Set("U_SYS_GRP")
		
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sXMLPath)
		F.Data.DataTable.CreateFromXML("dtPrevVal",V.Local.sXMLPath,True)
				
		F.Intrinsic.Control.If(V.DataTable.dtPrevVal.RowCount,>,V.DataTable.dtNewVal.RowCount)
			'Group Member removed
			F.Data.DataTable.Clone("dtPrevVal","dtPassed",True)
			F.Data.DataTable.Merge("dtPrevVal","dtPassed",True,2)
			F.Data.Dictionary.CreateFromDataTable("dictNewVarVal","dtNewVal","Key","NewVarVal")
			F.Data.Dictionary.SetDefaultReturn("dictNewVarVal","System Group Removed")
			F.Data.DataTable.AddColumn("dtPassed","NewVarVal","String")
			F.Data.DataTable.FillFromDictionary("dtPassed","dictNewVarVal","Key","NewVarVal")
			F.Data.Dictionary.Close("dictNewVarVal")
		F.Intrinsic.Control.ElseIf(V.DataTable.dtPrevVal.RowCount,<,V.DataTable.dtNewVal.RowCount)
			'Group Member added
			F.Data.DataTable.Clone("dtNewVal","dtPassed",True)
			F.Data.DataTable.Merge("dtNewVal","dtPassed",True,2)
			'F.Data.DataTable.SetValueFormat("dtPassed",-1,"NewVarVal","PrevVarVal","")
			F.Data.Dictionary.CreateFromDataTable("dictPrevVarVal","dtPrevVal","Key","PrevVarVal")
			F.Data.Dictionary.SetDefaultReturn("dictPrevVarVal","System Group Added")
			F.Data.DataTable.FillFromDictionary("dtPassed","dictPrevVarVal","Key","PrevVarVal")
			F.Data.Dictionary.Close("dictPrevVarVal")
		F.Intrinsic.Control.Else
			F.Intrinsic.File.DeleteFile(V.Local.sXMLPath)
			F.Intrinsic.Control.End
		F.Intrinsic.Control.EndIf
		
		F.Data.DataTable.Close("dtPrevVal")
		F.Data.DataTable.Close("dtNewVal")
		
		F.Data.DataTable.AddExpressionColumn("dtPassed","Changed","Boolean","IIf([NewVarVal]<>[PrevVarVal],True,False)")
		
		F.Data.DataView.Create("dtPassed","dvChangedVal",22,"Changed = 'True'","")
		
		F.Data.DataView.ToDataTable("dtPassed","dvChangedVal","dtAudit")
		F.Data.DataTable.AddColumn("dtAudit","CHG_PGM","String","GSMMEM")
		F.Data.Datatable.AddColumn("dtAudit","SCREEN","String",V.Local.sScreen)
		F.Data.DataTable.AddColumn("dtAudit","CHG_USER","String",V.Caller.User)
		F.Data.DataTable.AddColumn("dtAudit","CHG_DATE","String",V.Local.sChgDate)
		F.Data.DataTable.AddColumn("dtAudit","CHG_TIME","String",V.Local.sChgTime)
		
		F.Data.Datatable.RemoveColumn("dtAudit","Key")
		F.Data.Datatable.RemoveColumn("dtAudit","Changed")

		F.ODBC.Connection!conts.OpenCompanyConnection
		F.Data.DataTable.SaveToDB("dtAudit","conts","GCG_6325_SYS_AUDIT","",128,"IDENTIFIER@!@IDENTIFIER*!*VarName@!@FIELD_NAME*!*PrevVarVal@!@OLD_VALUE*!*NewVarVal@!@NEW_VALUE*!*CHG_PGM@!@CHG_PGM*!*SCREEN@!@SCREEN*!*MENU_ITEM_PATH@!@MENU_REF*!*CHG_USER@!@CHG_USER*!*CHG_DATE@!@CHG_DATE*!*CHG_TIME@!@CHG_TIME")
		
		F.Data.DataView.Close("dtPassed","dvChangedVal")
		F.Data.DataTable.Close("dtPassed")
		
		F.Data.DataTable.Close("dtAudit")
		
		F.ODBC.Connection!conts.Close
		
		F.Intrinsic.File.DeleteFile(V.Local.sXMLPath)
		
		F.Intrinsic.Control.End	


#End Region ' 33725

	'USM - Options - Save
	F.Intrinsic.Control.Case(34130)
#Region "34130"
		F.Intrinsic.String.Build("Select USER_ID from USER_INFORMATION where GS_USER = '{0}'",V.Passed.000021,V.Local.sSQL)
		
		F.ODBC.Connection!comm.OpenCommonConnection
			F.ODBC.Connection!comm.ExecuteAndReturn(V.Local.sSQL,V.Local.iUserId)
		F.ODBC.Connection!comm.Close
		
		F.Intrinsic.String.Build("Select Cast('{0}' as LongVarChar)+'-'+ID as IDENTIFIER,Cast(OPTION_ID as LongVarChar)+Cast(SEQ as LongVarChar) as VarName,'Boolean = '+Cast(F_BOOLEAN as LongVarChar)+'  |  Flag = '+Cast(ASCII_FLAG as LongVarChar)+'  |  Text = '+RTRIM(TEXT) as PrevVarVal from USER_OPTIONS where ID = '{1}' order by VarName",V.Local.iUserId,V.Passed.000021,V.Local.sSQL)
		F.ODBC.Connection!conts.OpenCompanyConnection
				
		F.Data.DataTable.CreateFromSQL("dtNewVal","conts",V.Local.sSQL,True)
		F.Data.DataTable.AddColumn("dtNewVal","MENU_ITEM_PATH","String","System Support > File > User Security Maintenance > Options")
		
		F.Data.Dictionary.Create("dictVarName")
		F.Data.Dictionary.AddItem("dictVarName","0000010000","User Name")
		F.Data.Dictionary.AddItem("dictVarName","0000020000","Quote Approver")
		F.Data.Dictionary.AddItem("dictVarName","0000030000","Ability to Lock Project Budgets")
		F.Data.Dictionary.AddItem("dictVarName","0000040000","Update Batch")
		F.Data.Dictionary.AddItem("dictVarName","0000050000","Access Batches")
		F.Data.Dictionary.AddItem("dictVarName","0000060000","Payroll Drilldown")
		F.Data.Dictionary.AddItem("dictVarName","0000080000","Show Onhand Qty on Supply & Demand Screen")
		F.Data.Dictionary.AddItem("dictVarName","0000090000","Set Salesperson to User Id on Order Header")
		F.Data.Dictionary.AddItem("dictVarName","0000100000","Show Onhand Qty on Order Lines Screen")
		F.Data.Dictionary.AddItem("dictVarName","0000110000","Show Onhand Qty on MRP Screen")
		F.Data.Dictionary.AddItem("dictVarName","0000120000","Ability to View Credit Cards")
		F.Data.Dictionary.AddItem("dictVarName","0000130000","WO # Prefix")
		F.Data.Dictionary.AddItem("dictVarName","0000140000","Area")
		F.Data.Dictionary.AddItem("dictVarName","0000140001","Loc")
		F.Data.Dictionary.AddItem("dictVarName","0000150000","Use Short Form for Order Entry")
		F.Data.Dictionary.AddItem("dictVarName","0000160000","Shipping Locn/Allow Shipping Override")
		F.Data.Dictionary.AddItem("dictVarName","0000170000","Ability to View Allocations")
		F.Data.Dictionary.AddItem("dictVarName","0000180000","Ability to Override Allocations")
		F.Data.Dictionary.AddItem("dictVarName","0000200000","ACH Payment Access")
		F.Data.Dictionary.AddItem("dictVarName","0000210000","ACH Payment Approver")
		F.Data.Dictionary.AddItem("dictVarName","0000270000","")
		F.Data.Dictionary.AddItem("dictVarName","0000280000","Employee Added")
		F.Data.Dictionary.AddItem("dictVarName","0000300000","Bank Reconciliation")
		F.Data.Dictionary.AddItem("dictVarName","0000310000","AR/GL Update")
		F.Data.Dictionary.AddItem("dictVarName","0000320000","AR Access Batches")
		F.Data.Dictionary.AddItem("dictVarName","0000330000","AP/GL Update")
		F.Data.Dictionary.AddItem("dictVarName","0000340000","AP Access Batches")
		F.Data.Dictionary.AddItem("dictVarName","0000350000","Ability to View Social Security Numbers")
		F.Data.Dictionary.AddItem("dictVarName","0000360000","Ability to View Bank Account Numbers")
		F.Data.Dictionary.AddItem("dictVarName","0000370000","Ability to View Federal ID Numbers")

		F.Data.DataTable.FillFromDictionary("dtNewVal","dictVarName","VarName")
		F.Data.Dictionary.Close("dictVarName")
		
		F.Data.DataTable.AddExpressionColumn("dtNewVal","KEY","String","IDENTIFIER+VARNAME")
		
		V.Local.sScreen.Set(V.Passed.SYS050)
		
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sXMLPath)
		
		F.Data.DataTable.CreateFromXML("dtPrevVal",V.Local.sXMLPath,True)

		F.Intrinsic.Control.If(V.DataTable.dtPrevVal.RowCount,>,V.DataTable.dtNewVal.RowCount)
			'Permissions were removed
			F.Data.DataTable.Clone("dtPrevVal","dtPassed",True)
			F.Data.DataTable.Merge("dtPrevVal","dtPassed",True,2)
			F.Data.Dictionary.CreateFromDataTable("dictNewVarVal","dtNewVal","Key","NewVarVal")
			F.Data.Dictionary.SetDefaultReturn("dictNewVarVal","")
			F.Data.DataTable.AddColumn("dtPassed","NewVarVal","String")
			F.Data.DataTable.FillFromDictionary("dtPassed","dictNewVarVal","Key","NewVarVal")
			F.Data.Dictionary.Close("dictNewVarVal")
		F.Intrinsic.Control.ElseIf(V.DataTable.dtPrevVal.RowCount,<,V.DataTable.dtNewVal.RowCount)
			'Permissions were added
			F.Data.DataTable.Clone("dtNewVal","dtPassed",True)
			F.Data.DataTable.Merge("dtNewVal","dtPassed",True,2)
			F.Data.DataTable.AddColumn("dtPassed","NewVarVal","String")
			F.Data.DataTable.SetValueFormat("dtPassed",-1,"PrevVarVal","NewVarVal","")
			F.Data.Dictionary.CreateFromDataTable("dictPrevVarVal","dtPrevVal","Key","PrevVarVal")
			F.Data.Dictionary.SetDefaultReturn("dictPrevVarVal","")
			F.Data.DataTable.FillFromDictionary("dtPassed","dictPrevVarVal","Key","PrevVarVal")
			F.Data.Dictionary.Close("dictPrevVarVal")
		F.Intrinsic.Control.Else
			'Permissions were changed
			F.Data.DataTable.Clone("dtNewVal","dtPassed",True)
			F.Data.DataTable.Merge("dtNewVal","dtPassed",True,2)
			F.Data.Dictionary.CreateFromDataTable("dictChgVal","dtPrevVal","KEY","PrevVarVal")
			F.Data.Dictionary.SetDefaultReturn("dictChgVal","Added")
			F.Data.DataTable.AddColumn("dtPassed","NewVarVal","String")
			F.Data.DataTable.SetValueFormat("dtPassed",-1,"PrevVarVal","NewVarVal","")
			F.Data.DataTable.FillFromDictionary("dtPassed","dictChgVal","KEY","PrevVarVal")
		F.Intrinsic.Control.EndIf
		
		F.Data.DataTable.Close("dtPrevVal")
		F.Data.DataTable.Close("dtNewVal")
		
		F.Data.DataTable.AddExpressionColumn("dtPassed","Changed","Boolean","IIf([NewVarVal]<>[PrevVarVal],True,False)")
		
		F.Data.DataView.Create("dtPassed","dvChangedVal",22,"Changed = 'True'","")
		
		F.Data.DataView.ToDataTable("dtPassed","dvChangedVal","dtAudit")
		F.Data.DataTable.AddColumn("dtAudit","CHG_PGM","String","USMOPT")
		F.Data.Datatable.AddColumn("dtAudit","SCREEN","String",V.Local.sScreen)
		F.Data.DataTable.AddColumn("dtAudit","CHG_USER","String",V.Caller.User)
		F.Data.DataTable.AddColumn("dtAudit","CHG_DATE","String",V.Local.sChgDate)
		F.Data.DataTable.AddColumn("dtAudit","CHG_TIME","String",V.Local.sChgTime)

		F.Data.Datatable.RemoveColumn("dtAudit","Key")
		F.Data.Datatable.RemoveColumn("dtAudit","Changed")

		F.Data.DataTable.SaveToDB("dtAudit","conts","GCG_6325_SYS_AUDIT","",128,"IDENTIFIER@!@IDENTIFIER*!*VarName@!@FIELD_NAME*!*PrevVarVal@!@OLD_VALUE*!*NewVarVal@!@NEW_VALUE*!*CHG_PGM@!@CHG_PGM*!*SCREEN@!@SCREEN*!*MENU_ITEM_PATH@!@MENU_REF*!*CHG_USER@!@CHG_USER*!*CHG_DATE@!@CHG_DATE*!*CHG_TIME@!@CHG_TIME")
		
		F.Data.DataView.Close("dtPassed","dvChangedVal")
		F.Data.DataTable.Close("dtPassed")
		
		F.Data.DataTable.Close("dtAudit")
		
		F.ODBC.Connection!conts.Close
		
		F.Intrinsic.File.DeleteFile(V.Local.sXMLPath)
		
		F.Intrinsic.Control.End	

#End Region ' 34130

	'USM - Options - Exit
	F.Intrinsic.Control.Case(34105)
#Region "34105"
		V.Local.sScreen.Set(V.Passed.SYS050)		
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sXMLPath)
		F.Intrinsic.File.Exists(V.Local.sXMLPath,V.Local.bDelChk)
		F.Intrinsic.Control.If(V.Local.bDelChk)
			F.Intrinsic.File.DeleteFile(V.Local.sXMLPath)
		F.Intrinsic.Control.EndIf		
#End Region ' 34105

	'USM - New Terminal
	F.Intrinsic.Control.Case(33733)
#Region "33733"
		F.Intrinsic.Control.If(V.Passed.UserInfo-txtID.Trim,=,"")
			F.Intrinsic.Control.End
		F.Intrinsic.Control.EndIf

		F.Intrinsic.String.Build("Select USER_ID from USER_INFORMATION where GS_USER = '{0}'",V.Passed.UserInfo-txtID,V.Local.sSQL)
		
		F.ODBC.Connection!comm.OpenCommonConnection
			F.ODBC.Connection!comm.ExecuteAndReturn(V.Local.sSQL,V.Local.iUserId)
		F.ODBC.Connection!comm.Close
		
		F.Intrinsic.Control.If(V.Local.iUserId,=,0)
			F.Intrinsic.Control.End
		F.Intrinsic.Control.EndIf

		F.Global.Registry.ReadValue(V.Local.iUserId,V.Caller.CompanyCode,"GCG_6325_SYS_AUDIT","6325",33732,1,"",V.Local.iTerminal)
		
		F.Intrinsic.Control.If(V.Passed.UserInfo-txtTerminal,<>,V.Local.iTerminal)
			F.Data.DataTable.Create("dtAudit")
			F.Data.DataTable.AddColumn("dtAudit","Identifier","String")
			F.Data.DataTable.AddColumn("dtAudit","VarName","String")
			F.Data.DataTable.AddColumn("dtAudit","PrevVarVal","String")
			F.Data.DataTable.AddColumn("dtAudit","NewVarVal","String")
			F.Data.DataTable.AddColumn("dtAudit","MENU_ITEM_PATH","String")
			F.Data.DataTable.AddColumn("dtAudit","CHG_PGM","String")
			F.Data.Datatable.AddColumn("dtAudit","SCREEN","String")
			F.Data.DataTable.AddColumn("dtAudit","CHG_USER","String")
			F.Data.DataTable.AddColumn("dtAudit","CHG_DATE","String")
			F.Data.DataTable.AddColumn("dtAudit","CHG_TIME","String")
			
			F.Intrinsic.String.Build("{0}-{1}",V.Local.iUserId,V.Passed.UserInfo-txtID,V.Local.sIdentifier)
			
			F.Data.DataTable.AddRow("dtAudit","Identifier",V.Local.sIdentifier,"Varname","Terminal","PrevVarVal",V.Local.iTerminal,"NewVarVal",V.Passed.UserInfo-txtTerminal,"MENU_ITEM_PATH","System Support > File > User Security Maintenance > New [Terminal]","CHG_PGM","USMMAIN","SCREEN","F_USERINFO","CHG_USER",V.Caller.User,"CHG_DATE",V.Local.sChgDate,"CHG_TIME",V.Local.sChgTime)
			
			F.ODBC.Connection!conts.OpenCompanyConnection
				F.Data.DataTable.SaveToDB("dtAudit","conts","GCG_6325_SYS_AUDIT","",128,"IDENTIFIER@!@IDENTIFIER*!*VarName@!@FIELD_NAME*!*PrevVarVal@!@OLD_VALUE*!*NewVarVal@!@NEW_VALUE*!*CHG_PGM@!@CHG_PGM*!*SCREEN@!@SCREEN*!*MENU_ITEM_PATH@!@MENU_REF*!*CHG_USER@!@CHG_USER*!*CHG_DATE@!@CHG_DATE*!*CHG_TIME@!@CHG_TIME")
			F.ODBC.Connection!conts.Close
			
			F.Data.DataTable.Close("dtAudit")
			
			F.Intrinsic.String.Build("Delete GS_REGISTRY where USER_ID = '{0}' and REG_ID = '6325' and SEQ = '33732'",V.Local.iUserId,V.Local.sSQL)
			
			F.ODBC.Connection!comm.OpenCommonConnection
				F.ODBC.Connection!comm.Execute(V.Local.sSQL)
			F.ODBC.Connection!comm.Close
			
			F.Intrinsic.Control.End
		F.Intrinsic.Control.EndIf

#End Region ' 33733

F.Intrinsic.Control.EndSelect

F.Intrinsic.Control.Catch
	F.Intrinsic.Control.CallSub(Error,"SubRoutine",V.Ambient.CurrentSubroutine,"eNumber",V.Ambient.ErrorNumber,"eDescription",V.Ambient.ErrorDescription)
F.Intrinsic.Control.EndTry
Program.Sub.USM_OUT.End

Program.Sub.GSM_IN.Start
F.Intrinsic.Control.Try
V.Local.sSQL.Declare
V.Local.iCnt.Declare
V.Local.sUniqueID.Declare
V.Local.sExpression.Declare
V.Local.sValues.Declare
V.Local.sTempValue.Declare
V.Local.sScreen.Declare
V.Local.sXMLPath.Declare
V.Local.sLinkType.Declare
V.Local.sFileType.Declare
V.Local.sDocCont.Declare
V.Local.sVarName.Declare

F.Intrinsic.Control.SelectCase(V.Caller.Hook)
	'GSM - Permissions
	F.Intrinsic.Control.Case(33712)
#Region "33712"
		F.Data.DataTable.Create("dtInitVal",True)
			F.Data.DataTable.AddColumn("dtInitVal","IDENTIFIER","String")
			F.Data.DataTable.AddColumn("dtInitVal","VarName","String")
			F.Data.DataTable.AddColumn("dtInitVal","PrevVarVal","String")
			F.Data.DataTable.AddColumn("dtInitVal","MENU_ITEM_PATH","String")
			
			V.Local.sScreen.Set("GROUP_PERMISSIONS")
			
			F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sXMLPath)
			
			F.ODBC.Connection!conts.OpenCompanyConnection
			F.Intrinsic.String.Build("Select CONVERT(MS.ACCESS_ID, SQL_CHAR)+'-'+UI.GS_GROUP as IDENTIFIER,MS.ENABLED,MS.RESTRICTED_ACCESS,MS.LEVEL_ID,MS.LEVEL_SEQ from GLOBALCOMMON.MENU_SECURITY MS left join GLOBALCOMMON.USER_GROUPS UI on UI.GROUP_ID = MS.ACCESS_ID where UI.GS_GROUP = '{0}' and MS.COMPANY = '{1}' and MS.LEVEL_TYPE = '2' order by LEVEL_ID,LEVEL_SEQ;",V.Passed.Group-txtID,V.Caller.CompanyCode,V.Local.sSQL)		
			F.Data.DataTable.CreateFromSQL("dtPermissions","conts",V.Local.sSQL)
			F.Data.DataTable.AddExpressionColumn("dtPermissions","NEWKEY","String","LEVEL_ID+'-'+LEVEL_SEQ")
			F.Data.DataTable.AddColumn("dtPermissions","MENU_ITEM_PATH","String")
			
			F.Data.DataTable.CreateFromSQL("dtMenuSelections","conts","Select MSEL.SELECTION_ID,MM.MODULE_ID,MH.HEADER_ID,MSEL.SEQUENCE,MM.MODULE_TITLE,MH.HEADER_TITLE,MSEL.TITLE from MENU_SELECTIONS MSEL left join MENU_HEADERS MH on MSEL.HEADER_ID = MH.HEADER_ID left join MENU_MODULE MM on MH.MODULE_ID = MM.MODULE_ID order by MM.MODULE_ID,MSEL.SELECTION_ID,MSEL.SEQUENCE")
	
			F.Data.DataTable.AddExpressionColumn("dtMenuSelections","KEY","String","SELECTION_ID+'-'+MODULE_ID+'-'+HEADER_ID")
			F.Data.DataTable.AddColumn("dtMenuSelections","H_TITLE","String")
			F.Data.DataTable.AddExpressionColumn("dtMenuSelections","MENU_PATH","String","IIF(SEQUENCE = 0,MODULE_TITLE+' > '+HEADER_TITLE+' > '+TITLE,MODULE_TITLE+' > '+HEADER_TITLE+' > '+H_TITLE+' > '+TITLE)")
			
			F.Data.DataView.Create("dtMenuSelections","dvMenuHeader",22,"SEQUENCE = 0","")
			F.Data.DataView.ToDataTable("dtMenuSelections","dvMenuHeader","dtMHeader")
			
			F.Data.DataView.Close("dtMenuSelections","dvMenuHeader")
			
			F.Data.Dictionary.CreateFromDataTable("dictMHeader","dtMHeader","KEY","TITLE")
			F.Data.Dictionary.SetDefaultReturn("dictMHeader","")
			F.Data.DataTable.Close("dtMHeader")
			
			F.Data.DataTable.FillFromDictionary("dtMenuSelections","dictMHeader","KEY","H_TITLE")
			F.Data.Dictionary.Close("dictMHeader")
			
			F.Data.Datatable.AddExpressionColumn("dtMenuSelections","NEWKEY","String","SELECTION_ID+'-'+SEQUENCE")
			
			F.Data.Dictionary.CreateFromDataTable("dictFullMenuPath","dtMenuSelections","NEWKEY","MENU_PATH")
			F.Data.DataTable.Close("dtMenuSelections")
			F.Data.Dictionary.SetDefaultReturn("dictFullMenuPath","")
			
			F.Data.DataTable.FillFromDictionary("dtPermissions","dictFullMenuPath","NEWKEY","MENU_ITEM_PATH")
			
			F.ODBC.Connection!conts.Close
			V.Local.sValues.Set("ENABLED*!*RESTRICTED_ACCESS")
	
			F.Intrinsic.String.Split(V.Local.sValues, "*!*", V.Local.sValues)
			F.Data.DataView.Create("dtPermissions", "dvPermission", 22)
			F.Intrinsic.Control.For(V.Local.iCnt, 0, V.Local.sValues.UBound, 1)
			    'get the current value
			    V.Local.sTempValue.Set(V.Local.sValues(V.Local.iCnt))
			    F.Intrinsic.String.Build("Convert([{0}],'System.String')",V.Local.sTempValue,V.Local.sExpression)
			    F.Data.DataTable.AddExpressionColumn("dtPermissions", "PrevVarVal", "String", V.Local.sExpression)
			    'make a seperate datatable with just that data
			    F.Data.DataView.ToDataTableDistinct("dtPermissions", "dvPermission", "dtTemp", "IDENTIFIER*!*PrevVarVal*!*MENU_ITEM_PATH")
			    F.Data.DataTable.AddColumn("dtTemp", "VarName","String", V.Local.sTempValue)
			    F.Data.DataTable.Merge("dtTemp", "dtInitVal", False, 2)
			    F.Data.DataTable.Close("dtTemp")
			    F.Data.DataTable.RemoveColumn("dtPermissions", "PrevVarVal")
			F.Intrinsic.Control.Next(V.Local.iCnt)
			F.Data.DataView.Close("dtPermissions", "dvPermission")
			
			F.Data.DataTable.AddExpressionColumn("dtInitVal","Key","String","VarName+MENU_ITEM_PATH")
			
			F.Data.DataTable.SaveToXML("dtInitVal",0,True,V.Local.sXMLPath)
			
			F.Intrinsic.Control.End	
#End Region ' 33712
	
	'GSM - Link Security
	F.Intrinsic.Control.Case(33718)
#Region "33718"
		F.Intrinsic.String.Left(V.Passed.Group-cboLinkType,2,V.Local.sLinkType)
		F.Intrinsic.String.LPad(V.Local.sLinkType,"0",5,V.Local.sLinkType)

		'V.Passed.UserInfo-txtID
		F.Data.DataTable.Create("dtInitVal",True)
		F.Data.DataTable.AddColumn("dtInitVal","IDENTIFIER","String")
		F.Data.DataTable.AddColumn("dtInitVal","VarName","String")
		F.Data.DataTable.AddColumn("dtInitVal","PrevVarVal","String")
		F.Data.DataTable.AddColumn("dtInitVal","MENU_ITEM_PATH","String")
		
		V.Local.sScreen.Set("G_LINK_SEC")
		
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sXMLPath)
		
		F.Intrinsic.String.Build("Select SECURITY_ID as IDENTIFIER,LINK_TYPE,Cast(PERMISSION as LongVarChar) as PERMISSION from LINK_SECURITY where SECURITY_ID = '{0}' and SECURITY_TYPE = 'G' and LINK_TYPE = '{1}'",V.Passed.Group-txtID,V.Local.sLinkType,V.Local.sSQL)
		F.ODBC.Connection!conts.OpenCompanyConnection
				
		F.Data.DataTable.CreateFromSQL("dtLinkSec","conts",V.Local.sSQL)
		F.Data.DataTable.AddColumn("dtLinkSec","MENU_ITEM_PATH","String","System Support > File > Group Security Maintenance > Link Security")
		
		F.Data.Dictionary.Create("dictLnkType")
		F.Data.Dictionary.AddItem("dictLnkType","00000","00-All")
		F.Data.Dictionary.AddItem("dictLnkType","00010","10-Vendor Master")
		F.Data.Dictionary.AddItem("dictLnkType","00011","11-AP Invoice")
		F.Data.Dictionary.AddItem("dictLnkType","00012","12_Contact")
		F.Data.Dictionary.AddItem("dictLnkType","00014","14-AR Cash Check/Ref Number")
		F.Data.Dictionary.AddItem("dictLnkType","00015","15-Customer Master")
		F.Data.Dictionary.AddItem("dictLnkType","00017","17-Ship-To")
		F.Data.Dictionary.AddItem("dictLnkType","00018","18-Prospect")
		
		F.Data.Dictionary.Create("dictPermCode")
		F.Data.Dictionary.AddItem("dictPermCode","10","View Link")
		F.Data.Dictionary.AddItem("dictPermCode","11","View Link/View Comment")
		F.Data.Dictionary.AddItem("dictPermCode","12","View Link/Print Comment")
		F.Data.Dictionary.AddItem("dictPermCode","14","View Link/Save Comment")
		F.Data.Dictionary.AddItem("dictPermCode","20","Print Link")
		F.Data.Dictionary.AddItem("dictPermCode","21","Print Link/View Comment")
		F.Data.Dictionary.AddItem("dictPermCode","22","Print Link/Print Comment")
		F.Data.Dictionary.AddItem("dictPermCode","24","Print Link/Save Comment")
		F.Data.Dictionary.AddItem("dictPermCode","30","Email Link")
		F.Data.Dictionary.AddItem("dictPermCode","31","Email Link/View Comment")
		F.Data.Dictionary.AddItem("dictPermCode","32","Email Link/Print Comment")
		F.Data.Dictionary.AddItem("dictPermCode","34","Email Link/Save Comment")
		F.Data.Dictionary.AddItem("dictPermCode","40","Create/Edit Link")
		F.Data.Dictionary.AddItem("dictPermCode","41","Create/Edit Link/View Comment")
		F.Data.Dictionary.AddItem("dictPermCode","42","Create/Edit Link/Print Comment")
		F.Data.Dictionary.AddItem("dictPermCode","44","Create/Edit Link/Save Comment")
		F.Data.Dictionary.AddItem("dictPermCode","50","Delete Link")
		F.Data.Dictionary.AddItem("dictPermCode","51","Delete Link/View Comment")
		F.Data.Dictionary.AddItem("dictPermCode","52","Delete Link/Print Comment")
		F.Data.Dictionary.AddItem("dictPermCode","54","Delete Link/Save Comment")
		
		F.Data.DataTable.FillFromDictionary("dtLinkSec","dictLnkType","LINK_TYPE")
		F.Data.Dictionary.Close("dictLnkType")
		
		F.Data.DataTable.FillFromDictionary("dtLinkSec","dictPermCode","PERMISSION")
		F.Data.Dictionary.Close("dictPermCode")
		
		F.Data.DataTable.AddExpressionColumn("dtLinkSec","TYPE_PERMISSION","String","LINK_TYPE+'>>'+PERMISSION")
		
		V.Local.sValues.Set("TYPE_PERMISSION")

		F.Intrinsic.String.Split(V.Local.sValues, "*!*", V.Local.sValues)
		F.Data.DataView.Create("dtLinkSec", "dvLinkSec", 22)
		F.Intrinsic.Control.For(V.Local.iCnt, 0, V.Local.sValues.UBound, 1)
		    'get the current value
		    V.Local.sTempValue.Set(V.Local.sValues(V.Local.iCnt))
		    F.Intrinsic.String.Build("Convert([{0}],'System.String')",V.Local.sTempValue,V.Local.sExpression)
		    F.Data.DataTable.AddExpressionColumn("dtLinkSec", "PrevVarVal", "String", V.Local.sExpression)
		    'make a seperate datatable with just that data
		    F.Data.DataView.ToDataTableDistinct("dtLinkSec", "dvLinkSec", "dtTemp", "IDENTIFIER*!*PrevVarVal*!*MENU_ITEM_PATH")
		    F.Data.DataTable.AddColumn("dtTemp", "VarName","String", V.Local.sTempValue)
		    F.Data.DataTable.Merge("dtTemp", "dtInitVal", False, 2)
		    F.Data.DataTable.Close("dtTemp")
		    F.Data.DataTable.RemoveColumn("dtLinkSec", "PrevVarVal")
		F.Intrinsic.Control.Next(V.Local.iCnt)
		
		F.ODBC.Connection!conts.Close
		
		F.Data.DataView.Close("dtLinkSec","dvLinkSec")
		
		F.Data.DataTable.Close("dtLinkSec")
		
		F.Data.DataTable.AddExpressionColumn("dtInitVal","KEY","String","IDENTIFIER+VARNAME")
	
		F.Data.DataTable.SaveToXML("dtInitVal",0,True,V.Local.sXMLPath)
		
		F.Data.DataTable.Close("dtInitVal")
		
		F.Intrinsic.Control.End	

#End Region ' 33718

	'GSM - VMS Security
	F.Intrinsic.Control.Case(33722)
#Region "33722"
		F.Intrinsic.String.Left(V.Passed.Group-cboLinkTypeVMS,2,V.Local.sLinkType.Long)
		F.Intrinsic.String.Left(V.Passed.Group-cboFileTypes,1,V.Local.sFileType.Long)
		
		'V.Passed.UserInfo-txtID
		F.Data.DataTable.Create("dtInitVal",True)
		F.Data.DataTable.AddColumn("dtInitVal","IDENTIFIER","String")
		F.Data.DataTable.AddColumn("dtInitVal","VarName","String")
		F.Data.DataTable.AddColumn("dtInitVal","PrevVarVal","String")
		F.Data.DataTable.AddColumn("dtInitVal","MENU_ITEM_PATH","String")
		
		V.Local.sScreen.Set("G_VMS_SEC")
		
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sXMLPath)
		
		F.Intrinsic.String.Build("Select Cast(A.SECURITY_ID as LongVarChar)+'-'+B.GS_GROUP as IDENTIFIER,Cast(A.LINK_TYPE as LongVarChar) as LINK_TYPE,Cast(A.TID as LongVarChar) as FILE_TYPE,Cast(A.PERMISSION as LongVarChar) as PERMISSION from VMS_SECURITY A left join GLOBALCOMMON.USER_GROUPS B on A.SECURITY_ID = B.GROUP_ID where B.GS_GROUP = '{0}' and A.SECURITY_TYPE = '1' and A.LINK_TYPE = '{1}' and A.TID = '{2}'",V.Passed.Group-txtID,V.Local.sLinkType,V.Local.sFileType,V.Local.sSQL)
		F.ODBC.Connection!conts.OpenCompanyConnection
				
		F.Data.DataTable.CreateFromSQL("dtLinkSec","conts",V.Local.sSQL)
		F.Data.DataTable.AddColumn("dtLinkSec","MENU_ITEM_PATH","String","System Support > File > Group Security Maintenance > VMS")
		
		F.Data.Dictionary.Create("dictLnkType")
		F.Data.Dictionary.AddItem("dictLnkType","0","00-All")
		F.Data.Dictionary.AddItem("dictLnkType","10","10-Vendor Master")
		F.Data.Dictionary.AddItem("dictLnkType","11","11-AP Invoice")
		F.Data.Dictionary.AddItem("dictLnkType","12","12_Contact")
		F.Data.Dictionary.AddItem("dictLnkType","14","14-AR Cash Check/Ref Number")
		F.Data.Dictionary.AddItem("dictLnkType","15","15-Customer Master")
		F.Data.Dictionary.AddItem("dictLnkType","17","17-Ship-To")
		F.Data.Dictionary.AddItem("dictLnkType","18","18-Prospect")

		F.Data.DataTable.FillFromDictionary("dtLinkSec","dictLnkType","LINK_TYPE")
		F.Data.Dictionary.Close("dictLnkType")
		
		F.Data.Dictionary.Create("dictPerms")
		F.Data.Dictionary.AddItem("dictPerms","0","No Permissions")
		F.Data.Dictionary.AddItem("dictPerms","2","Open View Only Copy")
		F.Data.Dictionary.AddItem("dictPerms","4","See Previous Versions")
		F.Data.Dictionary.AddItem("dictPerms","6","See Prev / View Only")
		F.Data.Dictionary.AddItem("dictPerms","8","Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","10","Check In/Out / View Only")
		F.Data.Dictionary.AddItem("dictPerms","12","See Prev / Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","14","See Prev / Check In/Out / View Only")
		F.Data.Dictionary.AddItem("dictPerms","16","Add to VMS")
		F.Data.Dictionary.AddItem("dictPerms","18","Add to VMS / View Only")
		F.Data.Dictionary.AddItem("dictPerms","20","Add to VMS / See Prev")
		F.Data.Dictionary.AddItem("dictPerms","22","Add to VMS/ See Prev / View Only")
		F.Data.Dictionary.AddItem("dictPerms","24","Add to VMS / Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","26","Add to VMS / Check In/Out / View Only")
		F.Data.Dictionary.AddItem("dictPerms","28","Add to VMS / Check In/Out / See Prev")
		F.Data.Dictionary.AddItem("dictPerms","30","Add to VMS / Check In/Out / See Prev / View Only")
		F.Data.Dictionary.AddItem("dictPerms","32","Remove File")
		F.Data.Dictionary.AddItem("dictPerms","34","Remove File / View Only")
		F.Data.Dictionary.AddItem("dictPerms","36","Remove File / See Prev")
		F.Data.Dictionary.AddItem("dictPerms","38","Remove File / See Prev / View Only")
		F.Data.Dictionary.AddItem("dictPerms","40","Remove File / Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","42","Remove File / Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","44","Remove File / Check In/Out / See Prev")
		F.Data.Dictionary.AddItem("dictPerms","46","Remove File / Check In/Out / See Prev / View Only")
		F.Data.Dictionary.AddItem("dictPerms","48","Remove File / Add to VMS")
		F.Data.Dictionary.AddItem("dictPerms","50","Remove File / Add to VMS / View Only")
		F.Data.Dictionary.AddItem("dictPerms","52","Remove File / Add to VMS / See Prev")
		F.Data.Dictionary.AddItem("dictPerms","54","Remove File / Add to VMS / See Prev / View Only")
		F.Data.Dictionary.AddItem("dictPerms","56","Remove File / Add to VMS / Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","58","Remove File / Add to VMS / Check In/Out / View Only")
		F.Data.Dictionary.AddItem("dictPerms","60","Remove File / Add to VMS / See Prev / Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","62","Remove File / Add to VMS / See Prev / Check In/Out / View Only")
		
		F.Data.DataTable.FillFromDictionary("dtLinkSec","dictPerms","PERMISSION")
		F.Data.Dictionary.Close("dictPerms")
		
		F.Data.Dictionary.CreateFromSQL("dictFileType","conts","Select Cast(TID as LongVarChar) as FILE_TYPE,Cast(TID as LongVarChar)+'-'+EXTENSION+'('+DESCRIPTION+')' from VMS_FILE_TYPE")
		F.Data.Dictionary.AddItem("dictFileType","0","0-All")
				
		F.Data.DataTable.FillFromDictionary("dtLinkSec","dictFileType","FILE_TYPE")
		F.Data.Dictionary.Close("dictFileType")

		F.Data.DataTable.AddExpressionColumn("dtLinkSec","TYPE_PERMISSION","String","LINK_TYPE+' >> '+FILE_TYPE+' >> '+PERMISSION")
		
		V.Local.sValues.Set("TYPE_PERMISSION")

		F.Intrinsic.String.Split(V.Local.sValues, "*!*", V.Local.sValues)
		F.Data.DataView.Create("dtLinkSec", "dvLinkSec", 22)
		F.Intrinsic.Control.For(V.Local.iCnt, 0, V.Local.sValues.UBound, 1)
		    'get the current value
		    V.Local.sTempValue.Set(V.Local.sValues(V.Local.iCnt))
		    F.Intrinsic.String.Build("Convert([{0}],'System.String')",V.Local.sTempValue,V.Local.sExpression)
		    F.Data.DataTable.AddExpressionColumn("dtLinkSec", "PrevVarVal", "String", V.Local.sExpression)
		    'make a seperate datatable with just that data
		    F.Data.DataView.ToDataTableDistinct("dtLinkSec", "dvLinkSec", "dtTemp", "IDENTIFIER*!*PrevVarVal*!*MENU_ITEM_PATH")
		    F.Data.DataTable.AddColumn("dtTemp", "VarName","String", V.Local.sTempValue)
		    F.Data.DataTable.Merge("dtTemp", "dtInitVal", False, 2)
		    F.Data.DataTable.Close("dtTemp")
		    F.Data.DataTable.RemoveColumn("dtLinkSec", "PrevVarVal")
		F.Intrinsic.Control.Next(V.Local.iCnt)
		
		F.ODBC.Connection!conts.Close
		
		F.Data.DataView.Close("dtLinkSec","dvLinkSec")
		
		F.Data.DataTable.Close("dtLinkSec")
		
		F.Data.DataTable.AddExpressionColumn("dtInitVal","KEY","String","IDENTIFIER+VARNAME")
		
		F.Data.DataTable.SaveToXML("dtInitVal",0,True,V.Local.sXMLPath)
		
		F.Data.DataTable.Close("dtInitVal")
		
		F.Intrinsic.Control.End

#End Region ' 33722

	'GSM - Group Members
	F.Intrinsic.Control.Case(33726)
#Region "33726"
		F.Data.DataTable.Create("dtInitVal",True)
		F.Data.DataTable.AddColumn("dtInitVal","IDENTIFIER","String")
		F.Data.DataTable.AddColumn("dtInitVal","VarName","String")
		F.Data.DataTable.AddColumn("dtInitVal","PrevVarVal","String")
		F.Data.DataTable.AddColumn("dtInitVal","MENU_ITEM_PATH","String")
		
		V.Local.sScreen.Set("G_MEM_SEC")
		
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sXMLPath)
		
		F.Intrinsic.String.Build("Select B.GS_GROUP+'-'+Cast(A.USER_ID as LongVarChar)+'-'+C.GS_USER as IDENTIFIER from MENU_SECURITY_ASSOC A left join USER_GROUPS B on A.GROUP_ID = B.GROUP_ID left join USER_INFORMATION C on A.USER_ID = C.USER_ID where B.GS_GROUP = '{0}' and B.COMPANY = '{1}'",V.Passed.Group-txtID,V.Caller.CompanyCode,V.Local.sSQL)
		F.ODBC.Connection!comm.OpenCommonConnection
				
		F.Data.DataTable.CreateFromSQL("dtGrpMem","comm",V.Local.sSQL)
		F.Data.DataTable.AddColumn("dtGrpMem","MENU_ITEM_PATH","String","System Support > File > Group Security Maintenance > Group Members")
		
		V.Local.sValues.Set("IDENTIFIER")

		F.Intrinsic.String.Split(V.Local.sValues, "*!*", V.Local.sValues)
		F.Data.DataView.Create("dtGrpMem", "dvGrpMem", 22)
		F.Intrinsic.Control.For(V.Local.iCnt, 0, V.Local.sValues.UBound, 1)
		    'get the current value
		    V.Local.sTempValue.Set(V.Local.sValues(V.Local.iCnt))
		    F.Intrinsic.String.Build("Convert([{0}],'System.String')",V.Local.sTempValue,V.Local.sExpression)
		    F.Data.DataTable.AddExpressionColumn("dtGrpMem", "PrevVarVal", "String", V.Local.sExpression)
		    'make a seperate datatable with just that data
		    F.Data.DataView.ToDataTableDistinct("dtGrpMem", "dvGrpMem", "dtTemp", "IDENTIFIER*!*PrevVarVal*!*MENU_ITEM_PATH")
		    F.Data.DataTable.AddColumn("dtTemp", "VarName","String", V.Local.sTempValue)
		    F.Data.DataTable.Merge("dtTemp", "dtInitVal", False, 2)
		    F.Data.DataTable.Close("dtTemp")
		    F.Data.DataTable.RemoveColumn("dtGrpMem", "PrevVarVal")
		F.Intrinsic.Control.Next(V.Local.iCnt)
		
		F.ODBC.Connection!comm.Close
		
		F.Data.DataView.Close("dtGrpMem","dvGrpMem")
		
		F.Data.DataTable.Close("dtGrpMem")
		
		F.Data.DataTable.AddExpressionColumn("dtInitVal","KEY","String","IDENTIFIER+VARNAME")
		
		F.Data.DataTable.SaveToXML("dtInitVal",0,True,V.Local.sXMLPath)
		
		F.Data.DataTable.Close("dtInitVal")
		
		F.Intrinsic.Control.End

#End Region ' 33726

	'GSM - Pre Save
	F.Intrinsic.Control.CaseAny(33710,33728)
#Region "33710"
		F.Data.DataTable.Create("dtInitVal",True)
		F.Data.DataTable.AddColumn("dtInitVal","IDENTIFIER","String")
		F.Data.DataTable.AddColumn("dtInitVal","VarName","String")
		F.Data.DataTable.AddColumn("dtInitVal","PrevVarVal","String")
		F.Data.DataTable.AddColumn("dtInitVal","MENU_ITEM_PATH","String")
		
		V.Local.sScreen.Set("GRP_INFO")
		
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sXMLPath)
		
		F.Intrinsic.String.Build("Select Cast(GROUP_ID as LongVarChar)+'-'+GS_GROUP as IDENTIFIER,DESCRIPTION,ENABLED from USER_GROUPS where GS_GROUP = '{0}' and COMPANY = '{1}'",V.Passed.Group-txtID,V.Caller.CompanyCode,V.Local.sSQL)
		F.ODBC.Connection!comm.OpenCommonConnection
				
		F.Data.DataTable.CreateFromSQL("dtGrpInf","comm",V.Local.sSQL)
		F.Data.DataTable.AddColumn("dtGrpInf","MENU_ITEM_PATH","String","System Support > File > Group Security Maintenance")
		
		V.Local.sValues.Set("IDENTIFIER*!*DESCRIPTION*!*ENABLED")

		F.Intrinsic.String.Split(V.Local.sValues, "*!*", V.Local.sValues)
		F.Data.DataView.Create("dtGrpInf", "dvGrpInf", 22)
		
		F.Intrinsic.Control.For(V.Local.iCnt, 0, V.Local.sValues.UBound, 1)
		    'get the current value
		    V.Local.sTempValue.Set(V.Local.sValues(V.Local.iCnt))
		    F.Intrinsic.String.Build("Convert([{0}],'System.String')",V.Local.sTempValue,V.Local.sExpression)
		    F.Data.DataTable.AddExpressionColumn("dtGrpInf", "PrevVarVal", "String", V.Local.sExpression)
		    'make a seperate datatable with just that data
		    F.Data.DataView.ToDataTableDistinct("dtGrpInf", "dvGrpInf", "dtTemp", "IDENTIFIER*!*PrevVarVal*!*MENU_ITEM_PATH")
		    F.Data.DataTable.AddColumn("dtTemp", "VarName","String", V.Local.sTempValue)
		    F.Data.DataTable.Merge("dtTemp", "dtInitVal", False, 2)
		    F.Data.DataTable.Close("dtTemp")
		    F.Data.DataTable.RemoveColumn("dtGrpInf", "PrevVarVal")
		F.Intrinsic.Control.Next(V.Local.iCnt)
		
		F.ODBC.Connection!comm.Close
		
		F.Data.DataView.Close("dtGrpInf","dvGrpInf")
		
		F.Data.DataTable.Close("dtGrpInf")
		
		F.ODBC.Connection!conts.OpenCompanyConnection
			F.Intrinsic.String.Build("Select B.GRP_NAME,A.PERMISSION from ATG_DOC_SEC A left join ATG_DOC_GRP B on A.GRP_ID = B.GRP_ID where A.SEC_TYPE = 'G' and A.USR_GRP = '{0}';",V.Passed.Group-txtID,V.Local.sSQL)
			F.ODBC.Connection!conts.ExecuteAndReturn(V.Local.sSQL,V.Local.sSQL)
		F.ODBC.Connection!conts.Close
		
		F.Intrinsic.Control.If(V.Local.sSQL.Trim,<>,"")
			F.Intrinsic.String.Split(V.Local.sSQL,"#$#",V.Local.sSQL)
			F.Intrinsic.Control.For(V.Local.iCnt,V.Local.sSQL.LBound,V.Local.sSQL.UBound,1)
				F.Intrinsic.String.Split(V.Local.sSQL(V.Local.iCnt),"*!*",V.Local.sDocCont)
				F.Intrinsic.String.Build("GRP_NAME_{0}",V.Local.iCnt,V.Local.sVarName)
				F.Intrinsic.String.Build("{0}-DCG-{1}",V.DataTable.dtInitVal(0).IDENTIFIER!FieldValTrim,V.Local.sDocCont(0),V.Local.sUniqueID)
				F.Data.DataTable.AddRow("dtInitVal","IDENTIFIER",V.Local.sUniqueID,"VarName",V.Local.sVarName,"PrevVarVal",V.Local.sDocCont(0),"MENU_ITEM_PATH","System Support > File > User Security Maintenance > Doc Cntrl Grps")
				F.Intrinsic.String.Build("GRP_PERM_{0}",V.Local.iCnt,V.Local.sVarName)
				F.Data.DataTable.AddRow("dtInitVal","IDENTIFIER",V.Local.sUniqueID,"VarName",V.Local.sVarName,"PrevVarVal",V.Local.sDocCont(1),"MENU_ITEM_PATH","System Support > File > User Security Maintenance > Doc Cntrl Grps")
			F.Intrinsic.Control.Next(V.Local.iCnt)
		F.Intrinsic.Control.EndIf
		
		F.Data.DataTable.AddExpressionColumn("dtInitVal","KEY","String","IDENTIFIER+VARNAME")
		
		F.Data.DataTable.SaveToXML("dtInitVal",0,True,V.Local.sXMLPath)
		
		F.Data.DataTable.Close("dtInitVal")
		
		F.Intrinsic.Control.End

#End Region ' 33710

F.Intrinsic.Control.EndSelect

F.Intrinsic.Control.Catch
	F.Intrinsic.Control.CallSub(Error,"SubRoutine",V.Ambient.CurrentSubroutine,"eNumber",V.Ambient.ErrorNumber,"eDescription",V.Ambient.ErrorDescription)
F.Intrinsic.Control.EndTry
Program.Sub.GSM_IN.End

Program.Sub.GSM_OUT.Start
F.Intrinsic.Control.Try
V.Local.sSQL.Declare
V.Local.iCnt.Declare
V.Local.sUniqueID.Declare
V.Local.sExpression.Declare
V.Local.sValues.Declare
V.Local.sTempValue.Declare
V.Local.sScreen.Declare
V.Local.sXMLPath.Declare
V.Local.sChgDate.Declare
V.Local.sChgTime.Declare
V.Local.bDelChk.Declare(Boolean, False)
V.Local.sIdentifier.Declare
V.Local.sLinkType.Declare
V.Local.sFileType.Declare
V.Local.sDocCont.Declare
V.Local.sVarName.Declare

F.Intrinsic.String.Format(V.Ambient.Date,"MM/DD/YYYY",V.Local.sChgDate)
F.Intrinsic.String.Format(V.Ambient.Time,"ttttt",V.Local.sChgTime)

F.Intrinsic.Control.SelectCase(V.Caller.Hook)
	'GSM - Group Permissions
	F.Intrinsic.Control.Case(33713)
#Region "33713"
		F.Data.DataTable.Create("dtNewVal",True)
		F.Data.DataTable.AddColumn("dtNewVal","IDENTIFIER","String")
		F.Data.DataTable.AddColumn("dtNewVal","VarName","String")
		F.Data.DataTable.AddColumn("dtNewVal","NewVarVal","String")
		F.Data.DataTable.AddColumn("dtNewVal","MENU_ITEM_PATH","String")
		
		F.ODBC.Connection!conts.OpenCompanyConnection
		F.Intrinsic.String.Build("Select CONVERT(MS.ACCESS_ID, SQL_CHAR)+'-'+UI.GS_GROUP as IDENTIFIER,MS.ENABLED,MS.RESTRICTED_ACCESS,MS.LEVEL_ID,MS.LEVEL_SEQ from GLOBALCOMMON.MENU_SECURITY MS left join GLOBALCOMMON.USER_GROUPS UI on UI.GROUP_ID = MS.ACCESS_ID where UI.GS_GROUP = '{0}' and MS.COMPANY = '{1}' and MS.LEVEL_TYPE = '2' order by LEVEL_ID,LEVEL_SEQ;",V.Passed.Group-txtID,V.Caller.CompanyCode,V.Local.sSQL)		
		F.Data.DataTable.CreateFromSQL("dtPermissions","conts",V.Local.sSQL)
		F.Data.DataTable.AddExpressionColumn("dtPermissions","NEWKEY","String","LEVEL_ID+'-'+LEVEL_SEQ")
		F.Data.DataTable.AddColumn("dtPermissions","MENU_ITEM_PATH","String")
		
		F.Data.DataTable.CreateFromSQL("dtMenuSelections","conts","Select MSEL.SELECTION_ID,MM.MODULE_ID,MH.HEADER_ID,MSEL.SEQUENCE,MM.MODULE_TITLE,MH.HEADER_TITLE,MSEL.TITLE from MENU_SELECTIONS MSEL left join MENU_HEADERS MH on MSEL.HEADER_ID = MH.HEADER_ID left join MENU_MODULE MM on MH.MODULE_ID = MM.MODULE_ID order by MM.MODULE_ID,MSEL.SELECTION_ID,MSEL.SEQUENCE")

		F.Data.DataTable.AddExpressionColumn("dtMenuSelections","KEY","String","SELECTION_ID+'-'+MODULE_ID+'-'+HEADER_ID")
		F.Data.DataTable.AddColumn("dtMenuSelections","H_TITLE","String")
		F.Data.DataTable.AddExpressionColumn("dtMenuSelections","MENU_PATH","String","IIF(SEQUENCE = 0,MODULE_TITLE+' > '+HEADER_TITLE+' > '+TITLE,MODULE_TITLE+' > '+HEADER_TITLE+' > '+H_TITLE+' > '+TITLE)")
		
		F.Data.DataView.Create("dtMenuSelections","dvMenuHeader",22,"SEQUENCE = 0","")
		F.Data.DataView.ToDataTable("dtMenuSelections","dvMenuHeader","dtMHeader")
		
		F.Data.DataView.Close("dtMenuSelections","dvMenuHeader")
		
		F.Data.Dictionary.CreateFromDataTable("dictMHeader","dtMHeader","KEY","TITLE")
		F.Data.Dictionary.SetDefaultReturn("dictMHeader","")
		F.Data.DataTable.Close("dtMHeader")
		
		F.Data.DataTable.FillFromDictionary("dtMenuSelections","dictMHeader","KEY","H_TITLE")
		F.Data.Dictionary.Close("dictMHeader")
		
		F.Data.Datatable.AddExpressionColumn("dtMenuSelections","NEWKEY","String","SELECTION_ID+'-'+SEQUENCE")
		
		F.Data.Dictionary.CreateFromDataTable("dictFullMenuPath","dtMenuSelections","NEWKEY","MENU_PATH")
		F.Data.DataTable.Close("dtMenuSelections")
		F.Data.Dictionary.SetDefaultReturn("dictFullMenuPath","")
		
		F.Data.DataTable.FillFromDictionary("dtPermissions","dictFullMenuPath","NEWKEY","MENU_ITEM_PATH")

		V.Local.sValues.Set("ENABLED*!*RESTRICTED_ACCESS")

		F.Intrinsic.String.Split(V.Local.sValues, "*!*", V.Local.sValues)
		F.Data.DataView.Create("dtPermissions", "dvPermission", 22)
		F.Intrinsic.Control.For(V.Local.iCnt, 0, V.Local.sValues.UBound, 1)
		    'get the current value
		    V.Local.sTempValue.Set(V.Local.sValues(V.Local.iCnt))
		    F.Intrinsic.String.Build("Convert([{0}],'System.String')",V.Local.sTempValue,V.Local.sExpression)
		    F.Data.DataTable.AddExpressionColumn("dtPermissions","NewVarVal","String",V.Local.sExpression)
		    'make a seperate datatable with just that data
		    F.Data.DataView.ToDataTableDistinct("dtPermissions","dvPermission","dtTemp","IDENTIFIER*!*NewVarVal*!*MENU_ITEM_PATH")
		    F.Data.DataTable.AddColumn("dtTemp", "VarName","String", V.Local.sTempValue)
		    F.Data.DataTable.Merge("dtTemp", "dtNewVal", False, 2)
		    F.Data.DataTable.Close("dtTemp")
		    F.Data.DataTable.RemoveColumn("dtPermissions","NewVarVal")
		F.Intrinsic.Control.Next(V.Local.iCnt)
		F.Data.DataView.Close("dtPermissions", "dvPermission")
		
		F.Data.DataTable.AddExpressionColumn("dtNewVal","Key","String","VarName+MENU_ITEM_PATH")
		F.Data.DataTable.AddColumn("dtNewVal","PrevVarVal","String")
		
		V.Local.sScreen.Set("GROUP_PERMISSIONS")
				
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sXMLPath)
		
		F.Data.DataTable.CreateFromXML("dtPrevVal",V.Local.sXMLPath,True)
		
		F.Intrinsic.Control.If(V.DataTable.dtPrevVal.RowCount,>,V.DataTable.dtNewVal.RowCount)
			'Variables all match. This could potentially mean that records were deleted.
			F.Data.DataTable.Clone("dtPrevVal","dtPassed",True)
			F.Data.DataTable.Merge("dtPrevVal","dtPassed",True,2)
			F.Data.DataTable.AddColumn("dtPassed","NewVarVal","String")
			F.Data.Dictionary.CreateFromDataTable("dictChgVal","dtNewVal","KEY","NewVarVal")
			F.Data.Dictionary.SetDefaultReturn("dictChgVal","Deleted")
			F.Data.DataTable.FillFromDictionary("dtPassed","dictChgVal","KEY","NewVarVal")
			V.Local.bDelChk.Set(True)
		F.Intrinsic.Control.ElseIf(V.DataTable.dtPrevVal.RowCount,<=,V.DataTable.dtNewVal.RowCount)
			'This could potentially mean that records were added.
			F.Data.DataTable.Clone("dtNewVal","dtPassed",True)
			F.Data.DataTable.Merge("dtNewVal","dtPassed",True,2)
			F.Data.Dictionary.CreateFromDataTable("dictChgVal","dtPrevVal","KEY","PrevVarVal")
			F.Data.Dictionary.SetDefaultReturn("dictChgVal","Added")
			F.Data.DataTable.FillFromDictionary("dtPassed","dictChgVal","KEY","PrevVarVal")
		F.Intrinsic.Control.EndIf
		
		F.Data.DataTable.AddExpressionColumn("dtPassed","Changed","Boolean","IIf(NewVarVal<>PrevVarVal,True,False)")
		
		F.Data.DataView.Create("dtPassed","dvChangedVal",22,"Changed = 'True'","")
		
		F.Intrinsic.Control.If(V.DataView.dtPassed!dvChangedVal.RowCount,=,0)
			F.ODBC.Connection!conts.Close
			F.Intrinsic.Control.End
		F.Intrinsic.Control.EndIf

		F.Data.DataView.ToDataTable("dtPassed","dvChangedVal","dtAudit")
		F.Data.DataTable.AddColumn("dtAudit","CHG_PGM","String","GSMPERMS")
		F.Data.Datatable.AddColumn("dtAudit","SCREEN","String",V.Local.sScreen)
		F.Data.DataTable.AddColumn("dtAudit","CHG_USER","String",V.Caller.User)
		F.Data.DataTable.AddColumn("dtAudit","CHG_DATE","String",V.Local.sChgDate)
		F.Data.DataTable.AddColumn("dtAudit","CHG_TIME","String",V.Local.sChgTime)
		
		F.Data.Datatable.RemoveColumn("dtAudit","Key")
		F.Data.Datatable.RemoveColumn("dtAudit","Changed")

		F.Data.DataTable.SaveToDB("dtAudit","conts","GCG_6325_SYS_AUDIT","",128,"IDENTIFIER@!@IDENTIFIER*!*VarName@!@FIELD_NAME*!*PrevVarVal@!@OLD_VALUE*!*NewVarVal@!@NEW_VALUE*!*CHG_PGM@!@CHG_PGM*!*SCREEN@!@SCREEN*!*MENU_ITEM_PATH@!@MENU_REF*!*CHG_USER@!@CHG_USER*!*CHG_DATE@!@CHG_DATE*!*CHG_TIME@!@CHG_TIME")
		
		F.ODBC.Connection!conts.Close

		F.Data.DataTable.Close("dtAudit")
		
		F.Intrinsic.File.DeleteFile(V.Local.sXMLPath)
		
		F.Intrinsic.Control.End
		
#End Region ' 33713

	'GSM - Link Security
	F.Intrinsic.Control.Case(33719)
#Region "33719"

		F.Intrinsic.String.Left(V.Passed.Group-cboLinkType,2,V.Local.sLinkType)
		F.Intrinsic.String.LPad(V.Local.sLinkType,"0",5,V.Local.sLinkType)
		
		F.Data.DataTable.Create("dtNewVal",True)
		F.Data.DataTable.AddColumn("dtNewVal","IDENTIFIER","String")
		F.Data.DataTable.AddColumn("dtNewVal","VarName","String")
		F.Data.DataTable.AddColumn("dtNewVal","NewVarVal","String")
		F.Data.DataTable.AddColumn("dtNewVal","MENU_ITEM_PATH","String")

		F.ODBC.Connection!conts.OpenCompanyConnection
		F.Intrinsic.String.Build("Select SECURITY_ID as IDENTIFIER,LINK_TYPE,Cast(PERMISSION as LongVarChar) as PERMISSION from LINK_SECURITY where SECURITY_ID = '{0}' and SECURITY_TYPE = 'G' and LINK_TYPE = '{1}'",V.Passed.Group-txtID,V.Local.sLinkType,V.Local.sSQL)		
		F.Data.DataTable.CreateFromSQL("dtPermissions","conts",V.Local.sSQL)
		
		F.Data.DataTable.AddColumn("dtPermissions","MENU_ITEM_PATH","String","System Support > File > Group Security Maintenance > Link Security")
		
		F.Data.Dictionary.Create("dictLnkType")
		F.Data.Dictionary.AddItem("dictLnkType","00000","00-All")
		F.Data.Dictionary.AddItem("dictLnkType","00010","10-Vendor Master")
		F.Data.Dictionary.AddItem("dictLnkType","00011","11-AP Invoice")
		F.Data.Dictionary.AddItem("dictLnkType","00012","12_Contact")
		F.Data.Dictionary.AddItem("dictLnkType","00014","14-AR Cash Check/Ref Number")
		F.Data.Dictionary.AddItem("dictLnkType","00015","15-Customer Master")
		F.Data.Dictionary.AddItem("dictLnkType","00017","17-Ship-To")
		F.Data.Dictionary.AddItem("dictLnkType","00018","18-Prospect")
		
		F.Data.Dictionary.Create("dictPermCode")
		F.Data.Dictionary.AddItem("dictPermCode","10","View Link")
		F.Data.Dictionary.AddItem("dictPermCode","11","View Link/View Comment")
		F.Data.Dictionary.AddItem("dictPermCode","12","View Link/Print Comment")
		F.Data.Dictionary.AddItem("dictPermCode","14","View Link/Save Comment")
		F.Data.Dictionary.AddItem("dictPermCode","20","Print Link")
		F.Data.Dictionary.AddItem("dictPermCode","21","Print Link/View Comment")
		F.Data.Dictionary.AddItem("dictPermCode","22","Print Link/Print Comment")
		F.Data.Dictionary.AddItem("dictPermCode","24","Print Link/Save Comment")
		F.Data.Dictionary.AddItem("dictPermCode","30","Email Link")
		F.Data.Dictionary.AddItem("dictPermCode","31","Email Link/View Comment")
		F.Data.Dictionary.AddItem("dictPermCode","32","Email Link/Print Comment")
		F.Data.Dictionary.AddItem("dictPermCode","34","Email Link/Save Comment")
		F.Data.Dictionary.AddItem("dictPermCode","40","Create/Edit Link")
		F.Data.Dictionary.AddItem("dictPermCode","41","Create/Edit Link/View Comment")
		F.Data.Dictionary.AddItem("dictPermCode","42","Create/Edit Link/Print Comment")
		F.Data.Dictionary.AddItem("dictPermCode","44","Create/Edit Link/Save Comment")
		F.Data.Dictionary.AddItem("dictPermCode","50","Delete Link")
		F.Data.Dictionary.AddItem("dictPermCode","51","Delete Link/View Comment")
		F.Data.Dictionary.AddItem("dictPermCode","52","Delete Link/Print Comment")
		F.Data.Dictionary.AddItem("dictPermCode","54","Delete Link/Save Comment")
		
		F.Data.DataTable.FillFromDictionary("dtPermissions","dictLnkType","LINK_TYPE")
		F.Data.Dictionary.Close("dictLnkType")
		
		F.Data.DataTable.FillFromDictionary("dtPermissions","dictPermCode","PERMISSION")
		F.Data.Dictionary.Close("dictPermCode")
		
		F.Data.DataTable.AddExpressionColumn("dtPermissions","TYPE_PERMISSION","String","LINK_TYPE+'>>'+PERMISSION")
		
		V.Local.sValues.Set("TYPE_PERMISSION")

		F.Intrinsic.String.Split(V.Local.sValues, "*!*", V.Local.sValues)
		F.Data.DataView.Create("dtPermissions", "dvPermission", 22)
		F.Intrinsic.Control.For(V.Local.iCnt, 0, V.Local.sValues.UBound, 1)
		    'get the current value
		    V.Local.sTempValue.Set(V.Local.sValues(V.Local.iCnt))
		    F.Intrinsic.String.Build("Convert([{0}],'System.String')",V.Local.sTempValue,V.Local.sExpression)
		    F.Data.DataTable.AddExpressionColumn("dtPermissions", "NewVarVal", "String", V.Local.sExpression)
		    'make a seperate datatable with just that data
		    F.Data.DataView.ToDataTableDistinct("dtPermissions", "dvPermission", "dtTemp", "IDENTIFIER*!*NewVarVal*!*MENU_ITEM_PATH")
		    F.Data.DataTable.AddColumn("dtTemp", "VarName","String", V.Local.sTempValue)
		    F.Data.DataTable.Merge("dtTemp", "dtNewVal", False, 2)
		    F.Data.DataTable.Close("dtTemp")
		    F.Data.DataTable.RemoveColumn("dtPermissions", "NewVarVal")
		F.Intrinsic.Control.Next(V.Local.iCnt)
		
		F.Data.DataView.Close("dtPermissions","dvPermission")
		
		F.Data.DataTable.Close("dtPermissions")
		
		F.Data.DataTable.AddExpressionColumn("dtNewVal","KEY","String","IDENTIFIER+VARNAME")
		F.Data.DataTable.AddColumn("dtNewVal","PrevVarVal","String")
		
		V.Local.sScreen.Set("G_LINK_SEC")
		
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sXMLPath)
		F.Data.DataTable.CreateFromXML("dtPrevVal",V.Local.sXMLPath,True)
				
		F.Intrinsic.Control.If(V.DataTable.dtPrevVal.RowCount,>,V.DataTable.dtNewVal.RowCount)
			'All permissions were removed
			F.Data.DataTable.Clone("dtPrevVal","dtPassed",True)
			F.Data.DataTable.Merge("dtPrevVal","dtPassed",True,2)
			F.Data.DataTable.AddColumn("dtPassed","NewVarVal","String","Permissions Deleted")
		F.Intrinsic.Control.ElseIf(V.DataTable.dtPrevVal.RowCount,<,V.DataTable.dtNewVal.RowCount)
			'New link permissions were added
			F.Data.DataTable.Clone("dtNewVal","dtPassed",True)
			F.Data.DataTable.Merge("dtNewVal","dtPassed",True,2)
			'F.Data.DataTable.SetValueFormat("dtPassed",-1,"NewVarVal","PrevVarVal","")
			F.Data.DataTable.SetValue("dtPassed",-1,"PrevVarVal","Permissions Added")
		F.Intrinsic.Control.Else
			'Permissions were changed
			F.Data.DataTable.Clone("dtNewVal","dtPassed",True)
			F.Data.DataTable.Merge("dtNewVal","dtPassed",True,2)
			F.Data.Dictionary.CreateFromDataTable("dictChgVal","dtPrevVal","KEY","PrevVarVal")
			F.Data.Dictionary.SetDefaultReturn("dictChgVal","")
			F.Data.DataTable.FillFromDictionary("dtPassed","dictChgVal","KEY","PrevVarVal")
		F.Intrinsic.Control.EndIf
		
		F.Data.DataTable.Close("dtPrevVal")
		F.Data.DataTable.Close("dtNewVal")
		
		F.Data.DataTable.AddExpressionColumn("dtPassed","Changed","Boolean","IIf([NewVarVal]<>[PrevVarVal],True,False)")
		
		F.Data.DataView.Create("dtPassed","dvChangedVal",22,"Changed = 'True'","")
		
		F.Data.DataView.ToDataTable("dtPassed","dvChangedVal","dtAudit")
		F.Data.DataTable.AddColumn("dtAudit","CHG_PGM","String","USMLNKS")
		F.Data.Datatable.AddColumn("dtAudit","SCREEN","String",V.Local.sScreen)
		F.Data.DataTable.AddColumn("dtAudit","CHG_USER","String",V.Caller.User)
		F.Data.DataTable.AddColumn("dtAudit","CHG_DATE","String",V.Local.sChgDate)
		F.Data.DataTable.AddColumn("dtAudit","CHG_TIME","String",V.Local.sChgTime)
		
		F.Data.Datatable.RemoveColumn("dtAudit","Key")
		F.Data.Datatable.RemoveColumn("dtAudit","Changed")

		F.Data.DataTable.SaveToDB("dtAudit","conts","GCG_6325_SYS_AUDIT","",128,"IDENTIFIER@!@IDENTIFIER*!*VarName@!@FIELD_NAME*!*PrevVarVal@!@OLD_VALUE*!*NewVarVal@!@NEW_VALUE*!*CHG_PGM@!@CHG_PGM*!*SCREEN@!@SCREEN*!*MENU_ITEM_PATH@!@MENU_REF*!*CHG_USER@!@CHG_USER*!*CHG_DATE@!@CHG_DATE*!*CHG_TIME@!@CHG_TIME")
		
		F.Data.DataView.Close("dtPassed","dvChangedVal")
		F.Data.DataTable.Close("dtPassed")
		
		F.Data.DataTable.Close("dtAudit")
		
		F.ODBC.Connection!conts.Close
		
		F.Intrinsic.File.DeleteFile(V.Local.sXMLPath)
		
		F.Intrinsic.Control.End

#End Region ' 33719
	
	'GSM - VMS Security
	F.Intrinsic.Control.Case(33723)
#Region "33723"
		F.Intrinsic.String.Left(V.Passed.Group-cboLinkTypeVMS,2,V.Local.sLinkType.Long)
		F.Intrinsic.String.Left(V.Passed.Group-cboFileTypes,1,V.Local.sFileType.Long)
		
		F.Data.DataTable.Create("dtNewVal",True)
		F.Data.DataTable.AddColumn("dtNewVal","IDENTIFIER","String")
		F.Data.DataTable.AddColumn("dtNewVal","VarName","String")
		F.Data.DataTable.AddColumn("dtNewVal","NewVarVal","String")
		F.Data.DataTable.AddColumn("dtNewVal","MENU_ITEM_PATH","String")

		F.ODBC.Connection!conts.OpenCompanyConnection
		F.Intrinsic.String.Build("Select Cast(A.SECURITY_ID as LongVarChar)+'-'+B.GS_GROUP as IDENTIFIER,Cast(A.LINK_TYPE as LongVarChar) as LINK_TYPE,Cast(A.TID as LongVarChar) as FILE_TYPE,Cast(A.PERMISSION as LongVarChar) as PERMISSION from VMS_SECURITY A left join GLOBALCOMMON.USER_GROUPS B on A.SECURITY_ID = B.GROUP_ID where B.GS_GROUP = '{0}' and A.SECURITY_TYPE = '1' and A.LINK_TYPE = '{1}' and A.TID = '{2}'",V.Passed.Group-txtID,V.Local.sLinkType,V.Local.sFileType,V.Local.sSQL)		
		F.Data.DataTable.CreateFromSQL("dtPermissions","conts",V.Local.sSQL)
		
		F.Data.DataTable.AddColumn("dtPermissions","MENU_ITEM_PATH","String","System Support > File > Group Security Maintenance > VMS")
		
		F.Data.Dictionary.Create("dictLnkType")
		F.Data.Dictionary.AddItem("dictLnkType","0","00-All")
		F.Data.Dictionary.AddItem("dictLnkType","10","10-Vendor Master")
		F.Data.Dictionary.AddItem("dictLnkType","11","11-AP Invoice")
		F.Data.Dictionary.AddItem("dictLnkType","12","12_Contact")
		F.Data.Dictionary.AddItem("dictLnkType","14","14-AR Cash Check/Ref Number")
		F.Data.Dictionary.AddItem("dictLnkType","15","15-Customer Master")
		F.Data.Dictionary.AddItem("dictLnkType","17","17-Ship-To")
		F.Data.Dictionary.AddItem("dictLnkType","18","18-Prospect")
		
		F.Data.DataTable.FillFromDictionary("dtPermissions","dictLnkType","LINK_TYPE")
		F.Data.Dictionary.Close("dictLnkType")
		
		F.Data.Dictionary.Create("dictPerms")
		F.Data.Dictionary.AddItem("dictPerms","0","No Permissions")
		F.Data.Dictionary.AddItem("dictPerms","2","Open View Only Copy")
		F.Data.Dictionary.AddItem("dictPerms","4","See Previous Versions")
		F.Data.Dictionary.AddItem("dictPerms","6","See Prev / View Only")
		F.Data.Dictionary.AddItem("dictPerms","8","Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","10","Check In/Out / View Only")
		F.Data.Dictionary.AddItem("dictPerms","12","See Prev / Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","14","See Prev / Check In/Out / View Only")
		F.Data.Dictionary.AddItem("dictPerms","16","Add to VMS")
		F.Data.Dictionary.AddItem("dictPerms","18","Add to VMS / View Only")
		F.Data.Dictionary.AddItem("dictPerms","20","Add to VMS / See Prev")
		F.Data.Dictionary.AddItem("dictPerms","22","Add to VMS/ See Prev / View Only")
		F.Data.Dictionary.AddItem("dictPerms","24","Add to VMS / Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","26","Add to VMS / Check In/Out / View Only")
		F.Data.Dictionary.AddItem("dictPerms","28","Add to VMS / Check In/Out / See Prev")
		F.Data.Dictionary.AddItem("dictPerms","30","Add to VMS / Check In/Out / See Prev / View Only")
		F.Data.Dictionary.AddItem("dictPerms","32","Remove File")
		F.Data.Dictionary.AddItem("dictPerms","34","Remove File / View Only")
		F.Data.Dictionary.AddItem("dictPerms","36","Remove File / See Prev")
		F.Data.Dictionary.AddItem("dictPerms","38","Remove File / See Prev / View Only")
		F.Data.Dictionary.AddItem("dictPerms","40","Remove File / Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","42","Remove File / Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","44","Remove File / Check In/Out / See Prev")
		F.Data.Dictionary.AddItem("dictPerms","46","Remove File / Check In/Out / See Prev / View Only")
		F.Data.Dictionary.AddItem("dictPerms","48","Remove File / Add to VMS")
		F.Data.Dictionary.AddItem("dictPerms","50","Remove File / Add to VMS / View Only")
		F.Data.Dictionary.AddItem("dictPerms","52","Remove File / Add to VMS / See Prev")
		F.Data.Dictionary.AddItem("dictPerms","54","Remove File / Add to VMS / See Prev / View Only")
		F.Data.Dictionary.AddItem("dictPerms","56","Remove File / Add to VMS / Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","58","Remove File / Add to VMS / Check In/Out / View Only")
		F.Data.Dictionary.AddItem("dictPerms","60","Remove File / Add to VMS / See Prev / Check In/Out")
		F.Data.Dictionary.AddItem("dictPerms","62","Remove File / Add to VMS / See Prev / Check In/Out / View Only")
		
		F.Data.DataTable.FillFromDictionary("dtPermissions","dictPerms","PERMISSION")
		F.Data.Dictionary.Close("dictPerms")
		
		F.Data.Dictionary.CreateFromSQL("dictFileType","conts","Select Cast(TID as LongVarChar) as FILE_TYPE,Cast(TID as LongVarChar)+'-'+EXTENSION+'('+DESCRIPTION+')' from VMS_FILE_TYPE")
		F.Data.Dictionary.AddItem("dictFileType","0","0-All")
				
		F.Data.DataTable.FillFromDictionary("dtPermissions","dictFileType","FILE_TYPE")
		F.Data.Dictionary.Close("dictFileType")
		
		F.Data.DataTable.AddExpressionColumn("dtPermissions","TYPE_PERMISSION","String","LINK_TYPE+' >> '+FILE_TYPE+' >> '+PERMISSION")
		
		V.Local.sValues.Set("TYPE_PERMISSION")

		F.Intrinsic.String.Split(V.Local.sValues, "*!*", V.Local.sValues)
		F.Data.DataView.Create("dtPermissions", "dvPermission", 22)
		F.Intrinsic.Control.For(V.Local.iCnt, 0, V.Local.sValues.UBound, 1)
		    'get the current value
		    V.Local.sTempValue.Set(V.Local.sValues(V.Local.iCnt))
		    F.Intrinsic.String.Build("Convert([{0}],'System.String')",V.Local.sTempValue,V.Local.sExpression)
		    F.Data.DataTable.AddExpressionColumn("dtPermissions", "NewVarVal", "String", V.Local.sExpression)
		    'make a seperate datatable with just that data
		    F.Data.DataView.ToDataTableDistinct("dtPermissions", "dvPermission", "dtTemp", "IDENTIFIER*!*NewVarVal*!*MENU_ITEM_PATH")
		    F.Data.DataTable.AddColumn("dtTemp", "VarName","String", V.Local.sTempValue)
		    F.Data.DataTable.Merge("dtTemp", "dtNewVal", False, 2)
		    F.Data.DataTable.Close("dtTemp")
		    F.Data.DataTable.RemoveColumn("dtPermissions", "NewVarVal")
		F.Intrinsic.Control.Next(V.Local.iCnt)
		
		F.Data.DataTable.AddExpressionColumn("dtNewVal","KEY","String","IDENTIFIER+VARNAME")
		F.Data.DataTable.AddColumn("dtNewVal","PrevVarVal","String")
		
		F.Data.DataView.Close("dtPermissions","dvPermission")
		
		F.Data.DataTable.Close("dtPermissions")
		
		V.Local.sScreen.Set("G_VMS_SEC")
		
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sXMLPath)
		F.Data.DataTable.CreateFromXML("dtPrevVal",V.Local.sXMLPath,True)
				
		F.Intrinsic.Control.If(V.DataTable.dtPrevVal.RowCount,>,V.DataTable.dtNewVal.RowCount)
			'All permissions were removed
			F.Data.DataTable.Clone("dtPrevVal","dtPassed",True)
			F.Data.DataTable.Merge("dtPrevVal","dtPassed",True,2)
			F.Data.DataTable.AddColumn("dtPassed","NewVarVal","String","Permissions Deleted")
		F.Intrinsic.Control.ElseIf(V.DataTable.dtPrevVal.RowCount,<,V.DataTable.dtNewVal.RowCount)
			'New link permissions were added
			F.Data.DataTable.Clone("dtNewVal","dtPassed",True)
			F.Data.DataTable.Merge("dtNewVal","dtPassed",True,2)
			'F.Data.DataTable.SetValueFormat("dtPassed",-1,"NewVarVal","PrevVarVal","")
			F.Data.DataTable.SetValue("dtPassed",-1,"PrevVarVal","Permissions Added")
		F.Intrinsic.Control.Else
			'Permissions were changed
			F.Data.DataTable.Clone("dtNewVal","dtPassed",True)
			F.Data.DataTable.Merge("dtNewVal","dtPassed",True,2)
			F.Data.Dictionary.CreateFromDataTable("dictChgVal","dtPrevVal","KEY","PrevVarVal")
			F.Data.Dictionary.SetDefaultReturn("dictChgVal","Added")
			F.Data.DataTable.FillFromDictionary("dtPassed","dictChgVal","KEY","PrevVarVal")
		F.Intrinsic.Control.EndIf
		
		F.Data.DataTable.Close("dtPrevVal")
		F.Data.DataTable.Close("dtNewVal")
		
		F.Data.DataTable.AddExpressionColumn("dtPassed","Changed","Boolean","IIf([NewVarVal]<>[PrevVarVal],True,False)")
		
		F.Data.DataView.Create("dtPassed","dvChangedVal",22,"Changed = 'True'","")
		
		F.Data.DataView.ToDataTable("dtPassed","dvChangedVal","dtAudit")
		F.Data.DataTable.AddColumn("dtAudit","CHG_PGM","String","GSMVMS")
		F.Data.Datatable.AddColumn("dtAudit","SCREEN","String",V.Local.sScreen)
		F.Data.DataTable.AddColumn("dtAudit","CHG_USER","String",V.Caller.User)
		F.Data.DataTable.AddColumn("dtAudit","CHG_DATE","String",V.Local.sChgDate)
		F.Data.DataTable.AddColumn("dtAudit","CHG_TIME","String",V.Local.sChgTime)
		
		F.Data.Datatable.RemoveColumn("dtAudit","Key")
		F.Data.Datatable.RemoveColumn("dtAudit","Changed")

		F.Data.DataTable.SaveToDB("dtAudit","conts","GCG_6325_SYS_AUDIT","",128,"IDENTIFIER@!@IDENTIFIER*!*VarName@!@FIELD_NAME*!*PrevVarVal@!@OLD_VALUE*!*NewVarVal@!@NEW_VALUE*!*CHG_PGM@!@CHG_PGM*!*SCREEN@!@SCREEN*!*MENU_ITEM_PATH@!@MENU_REF*!*CHG_USER@!@CHG_USER*!*CHG_DATE@!@CHG_DATE*!*CHG_TIME@!@CHG_TIME")
		
		F.Data.DataView.Close("dtPassed","dvChangedVal")
		F.Data.DataTable.Close("dtPassed")
		
		F.Data.DataTable.Close("dtAudit")
		
		F.ODBC.Connection!conts.Close
		
		F.Intrinsic.File.DeleteFile(V.Local.sXMLPath)
		
		F.Intrinsic.Control.End		

#End Region ' 33723

	'GSM - Group Members
	F.Intrinsic.Control.Case(33727)
#Region "33727"
		F.Data.DataTable.Create("dtNewVal",True)
		F.Data.DataTable.AddColumn("dtNewVal","IDENTIFIER","String")
		F.Data.DataTable.AddColumn("dtNewVal","VarName","String")
		F.Data.DataTable.AddColumn("dtNewVal","NewVarVal","String")
		F.Data.DataTable.AddColumn("dtNewVal","MENU_ITEM_PATH","String")

		F.Intrinsic.String.Build("Select B.GS_GROUP+'-'+Cast(A.USER_ID as LongVarChar)+'-'+C.GS_USER as IDENTIFIER from MENU_SECURITY_ASSOC A left join USER_GROUPS B on A.GROUP_ID = B.GROUP_ID left join USER_INFORMATION C on A.USER_ID = C.USER_ID where B.GS_GROUP = '{0}' and B.COMPANY = '{1}'",V.Passed.Group-txtID,V.Caller.CompanyCode,V.Local.sSQL)
		F.ODBC.Connection!comm.OpenCommonConnection
				
		F.Data.DataTable.CreateFromSQL("dtPermissions","comm",V.Local.sSQL)
		F.Data.DataTable.AddColumn("dtPermissions","MENU_ITEM_PATH","String","System Support > File > Group Security Maintenance > Group Members")
		
		V.Local.sValues.Set("IDENTIFIER")

		F.Intrinsic.String.Split(V.Local.sValues, "*!*", V.Local.sValues)
		F.Data.DataView.Create("dtPermissions", "dvPermission", 22)
		F.Intrinsic.Control.For(V.Local.iCnt, 0, V.Local.sValues.UBound, 1)
		    'get the current value
		    V.Local.sTempValue.Set(V.Local.sValues(V.Local.iCnt))
		    F.Intrinsic.String.Build("Convert([{0}],'System.String')",V.Local.sTempValue,V.Local.sExpression)
		    F.Data.DataTable.AddExpressionColumn("dtPermissions", "NewVarVal", "String", V.Local.sExpression)
		    'make a seperate datatable with just that data
		    F.Data.DataView.ToDataTableDistinct("dtPermissions", "dvPermission", "dtTemp", "IDENTIFIER*!*NewVarVal*!*MENU_ITEM_PATH")
		    F.Data.DataTable.AddColumn("dtTemp", "VarName","String", V.Local.sTempValue)
		    F.Data.DataTable.Merge("dtTemp", "dtNewVal", False, 2)
		    F.Data.DataTable.Close("dtTemp")
		    F.Data.DataTable.RemoveColumn("dtPermissions", "NewVarVal")
		F.Intrinsic.Control.Next(V.Local.iCnt)
		
		F.Data.DataTable.AddExpressionColumn("dtNewVal","KEY","String","IDENTIFIER+VARNAME")
		F.Data.DataTable.AddColumn("dtNewVal","PrevVarVal","String")
		
		F.Data.DataView.Close("dtPermissions","dvPermission")
		
		F.Data.DataTable.Close("dtPermissions")
		
		V.Local.sScreen.Set("G_MEM_SEC")
		
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sXMLPath)
		F.Data.DataTable.CreateFromXML("dtPrevVal",V.Local.sXMLPath,True)
				
		F.Intrinsic.Control.If(V.DataTable.dtPrevVal.RowCount,>,V.DataTable.dtNewVal.RowCount)
			'Group Member removed
			F.Data.DataTable.Clone("dtPrevVal","dtPassed",True)
			F.Data.DataTable.Merge("dtPrevVal","dtPassed",True,2)
			F.Data.Dictionary.CreateFromDataTable("dictNewVarVal","dtNewVal","Key","NewVarVal")
			F.Data.Dictionary.SetDefaultReturn("dictNewVarVal","Group Member Removed")
			F.Data.DataTable.AddColumn("dtPassed","NewVarVal","String")
			F.Data.DataTable.FillFromDictionary("dtPassed","dictNewVarVal","Key","NewVarVal")
			F.Data.Dictionary.Close("dictNewVarVal")
		F.Intrinsic.Control.ElseIf(V.DataTable.dtPrevVal.RowCount,<,V.DataTable.dtNewVal.RowCount)
			'Group Member added
			F.Data.DataTable.Clone("dtNewVal","dtPassed",True)
			F.Data.DataTable.Merge("dtNewVal","dtPassed",True,2)
			'F.Data.DataTable.SetValueFormat("dtPassed",-1,"NewVarVal","PrevVarVal","")
			F.Data.Dictionary.CreateFromDataTable("dictPrevVarVal","dtPrevVal","Key","PrevVarVal")
			F.Data.Dictionary.SetDefaultReturn("dictPrevVarVal","Group Member Added")
			F.Data.DataTable.FillFromDictionary("dtPassed","dictPrevVarVal","Key","PrevVarVal")
			F.Data.Dictionary.Close("dictPrevVarVal")
		F.Intrinsic.Control.Else
			F.Intrinsic.File.DeleteFile(V.Local.sXMLPath)
			F.Intrinsic.Control.End
		F.Intrinsic.Control.EndIf
		
		F.Data.DataTable.Close("dtPrevVal")
		F.Data.DataTable.Close("dtNewVal")
		
		F.Data.DataTable.AddExpressionColumn("dtPassed","Changed","Boolean","IIf([NewVarVal]<>[PrevVarVal],True,False)")
		
		F.Data.DataView.Create("dtPassed","dvChangedVal",22,"Changed = 'True'","")
		
		F.Data.DataView.ToDataTable("dtPassed","dvChangedVal","dtAudit")
		F.Data.DataTable.AddColumn("dtAudit","CHG_PGM","String","GSMMEM")
		F.Data.Datatable.AddColumn("dtAudit","SCREEN","String",V.Local.sScreen)
		F.Data.DataTable.AddColumn("dtAudit","CHG_USER","String",V.Caller.User)
		F.Data.DataTable.AddColumn("dtAudit","CHG_DATE","String",V.Local.sChgDate)
		F.Data.DataTable.AddColumn("dtAudit","CHG_TIME","String",V.Local.sChgTime)
		
		F.Data.Datatable.RemoveColumn("dtAudit","Key")
		F.Data.Datatable.RemoveColumn("dtAudit","Changed")

		F.ODBC.Connection!conts.OpenCompanyConnection
		F.Data.DataTable.SaveToDB("dtAudit","conts","GCG_6325_SYS_AUDIT","",128,"IDENTIFIER@!@IDENTIFIER*!*VarName@!@FIELD_NAME*!*PrevVarVal@!@OLD_VALUE*!*NewVarVal@!@NEW_VALUE*!*CHG_PGM@!@CHG_PGM*!*SCREEN@!@SCREEN*!*MENU_ITEM_PATH@!@MENU_REF*!*CHG_USER@!@CHG_USER*!*CHG_DATE@!@CHG_DATE*!*CHG_TIME@!@CHG_TIME")
		
		F.Data.DataView.Close("dtPassed","dvChangedVal")
		F.Data.DataTable.Close("dtPassed")
		
		F.Data.DataTable.Close("dtAudit")
		
		F.ODBC.Connection!conts.Close
		
		F.Intrinsic.File.DeleteFile(V.Local.sXMLPath)
		
		F.Intrinsic.Control.End	

#End Region ' 33727

	'GSM - Post Save
	F.Intrinsic.Control.CaseAny(33711,33729)
#Region "33711"
		F.Data.DataTable.Create("dtNewVal",True)
		F.Data.DataTable.AddColumn("dtNewVal","IDENTIFIER","String")
		F.Data.DataTable.AddColumn("dtNewVal","VarName","String")
		F.Data.DataTable.AddColumn("dtNewVal","NewVarVal","String")
		F.Data.DataTable.AddColumn("dtNewVal","MENU_ITEM_PATH","String")

		F.Intrinsic.String.Build("Select Cast(GROUP_ID as LongVarChar)+'-'+GS_GROUP as IDENTIFIER,DESCRIPTION,ENABLED from USER_GROUPS where GS_GROUP = '{0}' and COMPANY = '{1}'",V.Passed.Group-txtID,V.Caller.CompanyCode,V.Local.sSQL)
		F.ODBC.Connection!comm.OpenCommonConnection
				
		F.Data.DataTable.CreateFromSQL("dtPermissions","comm",V.Local.sSQL)
		F.Data.DataTable.AddColumn("dtPermissions","MENU_ITEM_PATH","String","System Support > File > Group Security Maintenance")
		
		V.Local.sValues.Set("IDENTIFIER*!*DESCRIPTION*!*ENABLED")

		F.Intrinsic.String.Split(V.Local.sValues, "*!*", V.Local.sValues)
		F.Data.DataView.Create("dtPermissions", "dvPermission", 22)
		F.Intrinsic.Control.For(V.Local.iCnt, 0, V.Local.sValues.UBound, 1)
		    'get the current value
		    V.Local.sTempValue.Set(V.Local.sValues(V.Local.iCnt))
		    F.Intrinsic.String.Build("Convert([{0}],'System.String')",V.Local.sTempValue,V.Local.sExpression)
		    F.Data.DataTable.AddExpressionColumn("dtPermissions", "NewVarVal", "String", V.Local.sExpression)
		    'make a seperate datatable with just that data
		    F.Data.DataView.ToDataTableDistinct("dtPermissions", "dvPermission", "dtTemp", "IDENTIFIER*!*NewVarVal*!*MENU_ITEM_PATH")
		    F.Data.DataTable.AddColumn("dtTemp", "VarName","String", V.Local.sTempValue)
		    F.Data.DataTable.Merge("dtTemp", "dtNewVal", False, 2)
		    F.Data.DataTable.Close("dtTemp")
		    F.Data.DataTable.RemoveColumn("dtPermissions", "NewVarVal")
		F.Intrinsic.Control.Next(V.Local.iCnt)
		
		F.ODBC.Connection!conts.OpenCompanyConnection
			F.Intrinsic.String.Build("Select B.GRP_NAME,A.PERMISSION from ATG_DOC_SEC A left join ATG_DOC_GRP B on A.GRP_ID = B.GRP_ID where A.SEC_TYPE = 'G' and A.USR_GRP = '{0}';",V.Passed.Group-txtID,V.Local.sSQL)
			F.ODBC.Connection!conts.ExecuteAndReturn(V.Local.sSQL,V.Local.sSQL)
		F.ODBC.Connection!conts.Close
		
		F.Intrinsic.Control.If(V.Local.sSQL.Trim,<>,"")
			F.Intrinsic.String.Split(V.Local.sSQL,"#$#",V.Local.sSQL)
			F.Intrinsic.Control.For(V.Local.iCnt,V.Local.sSQL.LBound,V.Local.sSQL.UBound,1)
				F.Intrinsic.String.Split(V.Local.sSQL(V.Local.iCnt),"*!*",V.Local.sDocCont)
				F.Intrinsic.String.Build("GRP_NAME_{0}",V.Local.iCnt,V.Local.sVarName)
				F.Intrinsic.String.Build("{0}-DCG-{1}",V.DataTable.dtNewVal(0).IDENTIFIER!FieldValTrim,V.Local.sDocCont(0),V.Local.sUniqueID)
				
				F.Data.DataTable.AddRow("dtNewVal","IDENTIFIER",V.Local.sUniqueID,"VarName",V.Local.sVarName,"NewVarVal",V.Local.sDocCont(0),"MENU_ITEM_PATH","System Support > File > User Security Maintenance > Doc Cntrl Grps")
				F.Intrinsic.String.Build("GRP_PERM_{0}",V.Local.iCnt,V.Local.sVarName)
				F.Data.DataTable.AddRow("dtNewVal","IDENTIFIER",V.Local.sUniqueID,"VarName",V.Local.sVarName,"NewVarVal",V.Local.sDocCont(1),"MENU_ITEM_PATH","System Support > File > User Security Maintenance > Doc Cntrl Grps")
			F.Intrinsic.Control.Next(V.Local.iCnt)
		F.Intrinsic.Control.EndIf
		
		F.Data.DataTable.AddExpressionColumn("dtNewVal","KEY","String","IDENTIFIER+VARNAME")
		F.Data.DataTable.AddColumn("dtNewVal","PrevVarVal","String")
		
		F.Data.DataView.Close("dtPermissions","dvPermission")
		
		F.Data.DataTable.Close("dtPermissions")
		
		V.Local.sScreen.Set("GRP_INFO")
		
		F.Intrinsic.String.Build("{0}{1}_{2}.xml",V.Caller.LocalGSSTempDir,V.Caller.User,V.Local.sScreen.Trim,V.Local.sXMLPath)
		F.Data.DataTable.CreateFromXML("dtPrevVal",V.Local.sXMLPath,True)
				
		F.Intrinsic.Control.If(V.DataTable.dtPrevVal.RowCount,>,V.DataTable.dtNewVal.RowCount)
			F.Data.DataTable.Clone("dtPrevVal","dtPassed",True)
			F.Data.DataTable.Merge("dtPrevVal","dtPassed",True,2)
			F.Data.Dictionary.CreateFromDataTable("dictNewVarVal","dtNewVal","Key","NewVarVal")
			F.Data.Dictionary.SetDefaultReturn("dictNewVarVal","Group Deleted")
			F.Data.DataTable.AddColumn("dtPassed","NewVarVal","String")
			F.Data.DataTable.FillFromDictionary("dtPassed","dictNewVarVal","Key","NewVarVal")
			F.Data.Dictionary.Close("dictNewVarVal")
		F.Intrinsic.Control.ElseIf(V.DataTable.dtPrevVal.RowCount,<=,V.DataTable.dtNewVal.RowCount)
			F.Data.DataTable.Clone("dtNewVal","dtPassed",True)
			F.Data.DataTable.Merge("dtNewVal","dtPassed",True,2)
			F.Data.Dictionary.CreateFromDataTable("dictPrevVarVal","dtPrevVal","Key","PrevVarVal")
			F.Data.Dictionary.SetDefaultReturn("dictPrevVarVal","Group Added")
			F.Data.DataTable.FillFromDictionary("dtPassed","dictPrevVarVal","Key","PrevVarVal")
			F.Data.Dictionary.Close("dictPrevVarVal")
		F.Intrinsic.Control.Else
			F.Intrinsic.File.DeleteFile(V.Local.sXMLPath)
			F.Intrinsic.Control.End
		F.Intrinsic.Control.EndIf
		
		F.Data.DataTable.Close("dtPrevVal")
		F.Data.DataTable.Close("dtNewVal")
		
		F.Data.DataTable.AddExpressionColumn("dtPassed","Changed","Boolean","IIf([NewVarVal]<>[PrevVarVal],True,False)")
		
		F.Data.DataView.Create("dtPassed","dvChangedVal",22,"Changed = 'True'","")
		
		F.Data.DataView.ToDataTable("dtPassed","dvChangedVal","dtAudit")
		F.Data.DataTable.AddColumn("dtAudit","CHG_PGM","String","GSMMEM")
		F.Data.Datatable.AddColumn("dtAudit","SCREEN","String",V.Local.sScreen)
		F.Data.DataTable.AddColumn("dtAudit","CHG_USER","String",V.Caller.User)
		F.Data.DataTable.AddColumn("dtAudit","CHG_DATE","String",V.Local.sChgDate)
		F.Data.DataTable.AddColumn("dtAudit","CHG_TIME","String",V.Local.sChgTime)
		
		F.Data.Datatable.RemoveColumn("dtAudit","Key")
		F.Data.Datatable.RemoveColumn("dtAudit","Changed")

		F.ODBC.Connection!conts.OpenCompanyConnection
		F.Data.DataTable.SaveToDB("dtAudit","conts","GCG_6325_SYS_AUDIT","",128,"IDENTIFIER@!@IDENTIFIER*!*VarName@!@FIELD_NAME*!*PrevVarVal@!@OLD_VALUE*!*NewVarVal@!@NEW_VALUE*!*CHG_PGM@!@CHG_PGM*!*SCREEN@!@SCREEN*!*MENU_ITEM_PATH@!@MENU_REF*!*CHG_USER@!@CHG_USER*!*CHG_DATE@!@CHG_DATE*!*CHG_TIME@!@CHG_TIME")
		
		F.Data.DataView.Close("dtPassed","dvChangedVal")
		F.Data.DataTable.Close("dtPassed")
		
		F.Data.DataTable.Close("dtAudit")
		
		F.ODBC.Connection!conts.Close
		
		F.Intrinsic.File.DeleteFile(V.Local.sXMLPath)
		
		F.Intrinsic.Control.End	

#End Region ' 33711
		
F.Intrinsic.Control.EndSelect

F.Intrinsic.Control.Catch
	F.Intrinsic.Control.CallSub(Error,"SubRoutine",V.Ambient.CurrentSubroutine,"eNumber",V.Ambient.ErrorNumber,"eDescription",V.Ambient.ErrorDescription)
F.Intrinsic.Control.EndTry
Program.Sub.GSM_OUT.End

Program.Sub.ReportData.Start
F.Intrinsic.Control.Try
V.Local.sStart.Declare
V.Local.sEnd.Declare
V.Local.sSQL.Declare

V.Local.sStart.Set(V.Screen.frmMain!dtpStart.Value)
V.Local.sEnd.Set(V.Screen.frmMain!dtpEnd.Value)

F.Intrinsic.Control.If(V.Screen.frmMain!dtpEnd.Value,<,V.Screen.frmMain!dtpStart.Value)
	F.Intrinsic.UI.Msgbox("End date cannot precede Start date","Error")
	F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.If(V.DataTable.dtAuditRpt.Exists)
	F.Data.DataTable.Close("dtAuditRpt")
F.Intrinsic.Control.EndIf

F.ODBC.Connection!conts.OpenCompanyConnection
F.Intrinsic.String.Build("Select * from GCG_6325_SYS_AUDIT where CHG_DATE between '{0}' and '{1}' order by CHG_DATE desc,CHG_TIME desc",V.Local.sStart.PervasiveDate,V.Local.sEnd.PervasiveDate,V.Local.sSQL)

F.Data.DataTable.CreateFromSQL("dtAuditRpt","conts",V.Local.sSQL,True)

F.ODBC.Connection!conts.Close

Gui.frmMain.GsGcAudit.AddGridviewFromDatatable("gvAuditRpt","dtAuditRpt")
Gui.frmMain.GsGcAudit.MainView("gvAuditRpt")

Gui.frmMain.GsGcAudit.SuspendLayout

Gui.frmMain.GsGcAudit.SetGridviewProperty("gvAuditRpt","Editable",False)
Gui.frmMain.GsGcAudit.SetGridviewProperty("gvAuditRpt","ReadOnly",True)

Gui.frmMain.GsGcAudit.SetColumnProperty("gvAuditRpt","IDENTIFIER","HeaderFontBold",True)
Gui.frmMain.GsGcAudit.SetColumnProperty("gvAuditRpt","FIELD_NAME","HeaderFontBold",True)
Gui.frmMain.GsGcAudit.SetColumnProperty("gvAuditRpt","OLD_VALUE","HeaderFontBold",True)
Gui.frmMain.GsGcAudit.SetColumnProperty("gvAuditRpt","NEW_VALUE","HeaderFontBold",True)
Gui.frmMain.GsGcAudit.SetColumnProperty("gvAuditRpt","CHG_PGM","HeaderFontBold",True)
Gui.frmMain.GsGcAudit.SetColumnProperty("gvAuditRpt","SCREEN","HeaderFontBold",True)
Gui.frmMain.GsGcAudit.SetColumnProperty("gvAuditRpt","MENU_REF","HeaderFontBold",True)
Gui.frmMain.GsGcAudit.SetColumnProperty("gvAuditRpt","CHG_USER","HeaderFontBold",True)
Gui.frmMain.GsGcAudit.SetColumnProperty("gvAuditRpt","CHG_DATE","HeaderFontBold",True)
Gui.frmMain.GsGcAudit.SetColumnProperty("gvAuditRpt","CHG_TIME","HeaderFontBold",True)

Gui.frmMain.GsGcAudit.SetColumnProperty("gvAuditRpt","IDENTIFIER","Caption","Identifier")
Gui.frmMain.GsGcAudit.SetColumnProperty("gvAuditRpt","FIELD_NAME","Caption","Field")
Gui.frmMain.GsGcAudit.SetColumnProperty("gvAuditRpt","OLD_VALUE","Caption","Old Value")
Gui.frmMain.GsGcAudit.SetColumnProperty("gvAuditRpt","NEW_VALUE","Caption","New Value")
Gui.frmMain.GsGcAudit.SetColumnProperty("gvAuditRpt","CHG_PGM","Caption","Program")
Gui.frmMain.GsGcAudit.SetColumnProperty("gvAuditRpt","SCREEN","Caption","Screen")
Gui.frmMain.GsGcAudit.SetColumnProperty("gvAuditRpt","MENU_REF","Caption","Menu")
Gui.frmMain.GsGcAudit.SetColumnProperty("gvAuditRpt","CHG_USER","Caption","GSS User")
Gui.frmMain.GsGcAudit.SetColumnProperty("gvAuditRpt","CHG_DATE","Caption","Date Changed")
Gui.frmMain.GsGcAudit.SetColumnProperty("gvAuditRpt","CHG_TIME","Caption","Time Changed")

Gui.frmMain.GsGcAudit.SetColumnProperty("gvAuditRpt","CHG_DATE","DisplayCustomDatetime","d")
Gui.frmMain.GsGcAudit.SetColumnProperty("gvAuditRpt","CHG_TIME","DisplayCustomDatetime","t")

Gui.frmMain.GsGcAudit.ResumeLayout

F.Intrinsic.Control.Catch
	F.Intrinsic.Control.CallSub(Error,"SubRoutine",V.Ambient.CurrentSubroutine,"eNumber",V.Ambient.ErrorNumber,"eDescription",V.Ambient.ErrorDescription)
F.Intrinsic.Control.EndTry
Program.Sub.ReportData.End

Program.Sub.cmdRef_Click.Start
F.Intrinsic.Control.Try

F.Intrinsic.Control.CallSub(ReportData)

F.Intrinsic.Control.Catch
	F.Intrinsic.Control.CallSub(Error,"SubRoutine",V.Ambient.CurrentSubroutine,"eNumber",V.Ambient.ErrorNumber,"eDescription",V.Ambient.ErrorDescription)
F.Intrinsic.Control.EndTry
Program.Sub.cmdRef_Click.End

Program.Sub.cmdCrystal_Click.Start
F.Intrinsic.Control.Try
V.Local.iRunID.Declare
V.Local.iReportId.Declare
V.Local.sReportId.Declare
V.Local.iLog.Declare
V.Local.iRet.Declare
V.Local.sParams.Declare
V.Local.sValues.Declare
V.Local.sStart.Declare
V.Local.sEnd.Declare

V.Local.sStart.Set(V.Screen.frmMain!dtpStart.Value)
V.Local.sEnd.Set(V.Screen.frmMain!dtpEnd.Value)

F.Intrinsic.String.Format(V.Local.sStart,"yyyymmdd",V.Local.sStart)
F.Intrinsic.String.Format(V.Local.sEnd,"yyyymmdd",V.Local.sEnd)

F.Intrinsic.String.Build("StartDt*!*EndDt",,V.Local.sParams)
F.Intrinsic.String.Build("{0}*!*{1}",V.Local.sStart,V.Local.sEnd,V.Local.sValues)

F.Global.BI.GetRunID(V.Local.iRunID)
F.Global.BI.GetIDFromName("GCG_6325_SYS_AUDIT.rpt",V.Local.iReportId)

V.Local.sReportId.Set(V.Local.iReportId)

F.Global.BI.StartLogging(V.Local.iRunID,V.Local.iReportId,0,"GCG_6325_SYS_AUDIT.rpt",V.Local.iRet)
F.Global.BI.StopLogging(V.Local.iLog)

F.Global.BI.RunReportPreProcessor(V.Local.iRunID,V.Local.iLog,V.Local.sParams,V.Local.sValues,V.Local.iReportId,16,TRUE,"",-1,"",-1,"","",V.Local.iRet)

F.Intrinsic.Control.Catch
	F.Intrinsic.Control.CallSub(Error,"SubRoutine",V.Ambient.CurrentSubroutine,"eNumber",V.Ambient.ErrorNumber,"eDescription",V.Ambient.ErrorDescription)
F.Intrinsic.Control.EndTry
Program.Sub.cmdCrystal_Click.End

Program.Sub.cmdPurge_Click.Start
F.Intrinsic.Control.Try
V.Local.sPwdInput.Declare
V.Local.sPwd.Declare
V.Local.iRet.Declare
V.Local.sMsg.Declare
V.Local.sDate.Declare
V.Local.sSQL.Declare

F.Intrinsic.UI.Inputbox("Please enter the password to purge audit data","","",V.Local.sPwdInput)

F.Intrinsic.Control.If(V.Local.sPwdInput,<>,"***CANCEL***")
	F.Global.Registry.ReadValue("6325",V.Caller.CompanyCode,"GCG_6325_AUDIT_MX",6325,1000,6,"",V.Local.sPwd.Trim)
F.Intrinsic.Control.Else
	F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.If(V.Local.sPwdInput.Trim,<>,V.Local.sPwd.Trim)
	F.Intrinsic.UI.Msgbox("Wrong password entered.  Please try again.","Error")
	F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.EndIf

F.Intrinsic.String.Format(V.Screen.frmMain!dtpPurge.Value,"MM/DD/YYYY",V.Local.sDate)

F.Intrinsic.String.Build("Are you sure you want to purge all data prior to {0}?",V.Local.sDate,V.Local.sMsg)

F.Intrinsic.UI.Msgbox(V.Local.sMsg,"Warning!",4,V.Local.iRet)

F.Intrinsic.Control.If(V.Local.iRet,=,7)
	F.Intrinsic.Control.ExitSub
F.Intrinsic.Control.EndIf

F.Intrinsic.String.Build("Delete GCG_6325_SYS_AUDIT where CHG_DATE < '{0}'",V.Local.sDate.PervasiveDate,V.Local.sSQL)

F.ODBC.Connection!conts.OpenCompanyConnection
F.ODBC.Connection!conts.Execute(V.Local.sSQL)
F.ODBC.Connection!conts.Close

F.Intrinsic.Control.ExitSub

F.Intrinsic.Control.Catch
	F.Intrinsic.Control.CallSub(Error,"SubRoutine",V.Ambient.CurrentSubroutine,"eNumber",V.Ambient.ErrorNumber,"eDescription",V.Ambient.ErrorDescription)
F.Intrinsic.Control.EndTry
Program.Sub.cmdPurge_Click.End

Program.Sub.frmMain_UnLoad.Start
F.Intrinsic.Control.End
Program.Sub.frmMain_UnLoad.End

Program.Sub.Error.Start
V.Local.sError.Declare
V.Local.iRet.Declare
V.Local.sSep.Declare

F.Intrinsic.String.Build("-------------------------------------------------------------------------------------",,V.Local.sSep)
F.Intrinsic.String.Build("({5}-{6}){0}{7}{0}Project: {4}{0}{7}{0}Sub: {1}{0}Error: {2}, {3}", V.Ambient.NewLine, V.Args.SubRoutine, V.Args.eNumber, V.Args.eDescription,V.Caller.ScriptFile,V.Ambient.Date, V.Ambient.Time,V.Local.sSep,V.Local.sError)
F.Intrinsic.UI.Msgbox(V.Local.sError,"Error",V.Local.iRet)
Program.Sub.Error.End

Program.Sub.Comments.Start
${$5$}$3.0.0.0$}$1
${$6$}$tsmith$}$20220629105053093$}$xqPbj9atw05FglvzeFsZ9cqXP+qvG6tXFz1Hi6OJjjzBcdvKXorbZ8GXb3CsK95PliBXT7avDPg=
Program.Sub.Comments.End